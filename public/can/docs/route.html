<!DOCTYPE html>  <html> <head>   <title>route.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="can.html">                 can.js               </a>                                           <a class="source" href="construct.html">                 construct.js               </a>                                           <a class="source" href="proxy.html">                 proxy.js               </a>                                           <a class="source" href="super.html">                 super.js               </a>                                           <a class="source" href="control.html">                 control.js               </a>                                           <a class="source" href="plugin.html">                 plugin.js               </a>                                           <a class="source" href="view.html">                 view.js               </a>                                           <a class="source" href="model.html">                 model.js               </a>                                           <a class="source" href="observe.html">                 observe.js               </a>                                           <a class="source" href="attributes.html">                 attributes.js               </a>                                           <a class="source" href="backup.html">                 backup.js               </a>                                           <a class="source" href="compute.html">                 compute.js               </a>                                           <a class="source" href="delegate.html">                 delegate.js               </a>                                           <a class="source" href="setter.html">                 setter.js               </a>                                           <a class="source" href="validations.html">                 validations.js               </a>                                           <a class="source" href="route.html">                 route.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                                           <a class="source" href="each.html">                 each.js               </a>                                           <a class="source" href="can.html">                 can.js               </a>                                           <a class="source" href="deferred.html">                 deferred.js               </a>                                           <a class="source" href="dojo.html">                 dojo.js               </a>                                           <a class="source" href="event.html">                 event.js               </a>                                           <a class="source" href="fixture.html">                 fixture.js               </a>                                           <a class="source" href="fragment.html">                 fragment.js               </a>                                           <a class="source" href="jquery.html">                 jquery.js               </a>                                           <a class="source" href="mootools.html">                 mootools.js               </a>                                           <a class="source" href="object.html">                 object.js               </a>                                           <a class="source" href="extend.html">                 extend.js               </a>                                           <a class="source" href="isplain.html">                 isplain.js               </a>                                           <a class="source" href="string.html">                 string.js               </a>                                           <a class="source" href="deparam.html">                 deparam.js               </a>                                           <a class="source" href="yui.html">                 yui.js               </a>                                           <a class="source" href="zepto.html">                 zepto.js               </a>                                           <a class="source" href="view.html">                 view.js               </a>                                           <a class="source" href="ejs.html">                 ejs.js               </a>                                           <a class="source" href="modifiers.html">                 modifiers.js               </a>                                           <a class="source" href="mustache.html">                 mustache.js               </a>                                           <a class="source" href="render.html">                 render.js               </a>                                           <a class="source" href="scanner.html">                 scanner.js               </a>                                           <a class="source" href="can.construct.proxy.html">                 can.construct.proxy.js               </a>                                           <a class="source" href="can.construct.super.html">                 can.construct.super.js               </a>                                           <a class="source" href="can.control.plugin.html">                 can.control.plugin.js               </a>                                           <a class="source" href="can.control.view.html">                 can.control.view.js               </a>                                           <a class="source" href="can.dojo.html">                 can.dojo.js               </a>                                           <a class="source" href="can.fixture.html">                 can.fixture.js               </a>                                           <a class="source" href="can.jquery-all.html">                 can.jquery-all.js               </a>                                           <a class="source" href="can.jquery.html">                 can.jquery.js               </a>                                           <a class="source" href="can.mootools.html">                 can.mootools.js               </a>                                           <a class="source" href="can.observe.attributes.html">                 can.observe.attributes.js               </a>                                           <a class="source" href="can.observe.backup.html">                 can.observe.backup.js               </a>                                           <a class="source" href="can.observe.delegate.html">                 can.observe.delegate.js               </a>                                           <a class="source" href="can.observe.setter.html">                 can.observe.setter.js               </a>                                           <a class="source" href="can.observe.validations.html">                 can.observe.validations.js               </a>                                           <a class="source" href="can.view.modifiers.html">                 can.view.modifiers.js               </a>                                           <a class="source" href="can.view.mustache.html">                 can.view.mustache.js               </a>                                           <a class="source" href="can.yui.html">                 can.yui.js               </a>                                           <a class="source" href="can.zepto.html">                 can.zepto.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               route.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">* CanJS - 1.1.1 (2012-11-21)</span>
<span class="cm">* http://canjs.us/</span>
<span class="cm">* Copyright (c) 2012 Bitovi</span>
<span class="cm">* Licensed MIT</span>
<span class="cm">*/</span>
<span class="nx">define</span><span class="p">([</span><span class="s1">&#39;can/util.js&#39;</span><span class="p">,</span> <span class="s1">&#39;can/observe&#39;</span><span class="p">,</span> <span class="s1">&#39;can/util/string/deparam&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">can</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>route.js</h2>

<p><code>can.route</code> <br />
<em>Helps manage browser history (and client state) by synchronizing the 
<code>window.location.hash</code> with a <code>can.Observe</code>.</em> <br />
Helper methods used for matching routes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><code>RegExp</code> used to match route variables of the type ':name'.
Any word character or a period is matched.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">matcher</span> <span class="o">=</span> <span class="sr">/\:([\w\.]+)/g</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Regular expression for identifying &amp;key=value lists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">paramsMatcher</span> <span class="o">=</span> <span class="sr">/^(?:&amp;[^=]+=[^&amp;]*)+/</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Converts a JS Object into a list of parameters that can be 
inserted into an html element tag.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">makeProps</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tags</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;className&#39;</span> <span class="o">?</span> <span class="s1">&#39;class&#39;</span> <span class="o">:</span> <span class="nx">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;href&quot;</span> <span class="o">?</span> <span class="nx">val</span> <span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">esc</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">tags</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Checks if a route matches the data provided. If any route variable
is not present in the data, the route does not match. If all route
variables are present in the data, the number of matches is returned 
to allow discerning between general and more specific routes. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">matchesData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>look at default values, if they match ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>mark as matched</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
          <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">onready</span> <span class="o">=</span> <span class="o">!</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">location</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
    <span class="nx">wrapQuote</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">str</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([.?*+\^$\[\]\\(){}|\-])/g</span><span class="p">,</span> <span class="s2">&quot;\\$1&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">each</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
    <span class="nx">extend</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">;</span>

  <span class="nx">can</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaults</span> <span class="o">=</span> <span class="nx">defaults</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Extract the variable names and replace with <code>RegExp</code> that will match
an atual URL with values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">test</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">whole</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">names</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="s2">&quot;\\&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">whole</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>a name without a default value HAS to have a value
a name that has a default value can be empty
The <code>\\</code> is for string-escaping giving single <code>\</code> for <code>RegExp</code> escaping.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="s2">&quot;([^&quot;</span> <span class="o">+</span> <span class="nx">next</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">?</span> <span class="s2">&quot;*&quot;</span> <span class="o">:</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Add route in a form that can be easily figured out.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>A regular expression that will match the route when variable values 
are present; i.e. for <code>:page/:type</code> the <code>RegExp</code> is <code>/([\w\.]*)/([\w\.]*)/</code> which
will match for any value of <code>:page</code> and <code>:type</code> (word chars or period).</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">test</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">test</span> <span class="o">+</span> <span class="s2">&quot;($|&quot;</span> <span class="o">+</span> <span class="nx">wrapQuote</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The original URL, same as the index for this entry in routes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">route</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>An <code>array</code> of all the variable names in this route.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">names</span><span class="o">:</span> <span class="nx">names</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Default values provided for the variables.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">defaults</span><span class="o">:</span> <span class="nx">defaults</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>The number of parts in the URL separated by <code>/</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">length</span><span class="o">:</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">length</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">_querySeparator</span><span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
    <span class="nx">_paramsMatcher</span><span class="o">:</span> <span class="nx">paramsMatcher</span><span class="p">,</span>


    <span class="nx">param</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">_setRoute</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Check if the provided data keys match the names in any routes;
Get the one with the most matches.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">route</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Need to have at least 1 match.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">matches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">matchCount</span><span class="p">,</span> <span class="nx">routeName</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">route</span><span class="p">,</span>
        <span class="nx">propCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>

      <span class="nx">each</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">propCount</span><span class="o">++</span><span class="p">;</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Otherwise find route.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">each</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>best route is the first with all defaults matching</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">matchCount</span> <span class="o">=</span> <span class="nx">matchesData</span><span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">matchCount</span> <span class="o">&gt;</span> <span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">route</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
          <span class="nx">matches</span> <span class="o">=</span> <span class="nx">matchCount</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">matchCount</span> <span class="o">&gt;=</span> <span class="nx">propCount</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>If we have a route name in our <code>can.route</code> data, and it's
just as good as what currently matches, use that</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">routeName</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">matchesData</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">routeName</span><span class="p">],</span> <span class="nx">data</span><span class="p">)</span> <span class="o">===</span> <span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">route</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">routeName</span><span class="p">];</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If this is match...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cpy</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">data</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Create the url by replacing the var names with the provided data.
If the default value is found an empty string is inserted.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">res</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">whole</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="k">return</span> <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
          <span class="p">}),</span>
          <span class="nx">after</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Remove matching default values</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">each</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>The remaining elements of data are added as 
<code>&amp;amp;</code> separated parameters to the url.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">after</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">cpy</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>if we are paraming for setting the hash
we also want to make sure the route value is updated</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">_setRoute</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">route</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">+</span> <span class="p">(</span><span class="nx">after</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span> <span class="o">+</span> <span class="nx">after</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>If no route was found, there is no hash URL, only paramters.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">deparam</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>See if the url matches any routes by testing it against the <code>route.test</code> <code>RegExp</code>.
By comparing the URL length the most specialized route that matches is used.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">route</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">length</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span>
      <span class="p">};</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">temp</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">route</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If a route was matched.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="c1">// Since `RegExp` backreferences are used in `route.test` (parens)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>the parts will contain the full matched string and each variable (back-referenced) value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">parts</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">test</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Start will contain the full matched string; parts contain the variable values.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">start</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>The remainder will be the <code>&amp;amp;key=value</code> list at the end of the URL.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">remainder</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)),</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>If there is a remainder and it contains a <code>&amp;amp;key=value</code> list deparam it.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">obj</span> <span class="o">=</span> <span class="p">(</span><span class="nx">remainder</span> <span class="o">&amp;&amp;</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_paramsMatcher</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">remainder</span><span class="p">))</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span><span class="nx">remainder</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Add the default values for this route.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">obj</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Overwrite each of the default values in <code>obj</code> with those in 
parts if that part is not empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">each</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">part</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">part</span> <span class="o">&amp;&amp;</span> <span class="nx">part</span> <span class="o">!==</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">part</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>If no route was matched, it is parsed as a <code>&amp;amp;key=value</code> list.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_querySeparator</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_paramsMatcher</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">{};</span>
    <span class="p">},</span>

    <span class="nx">data</span><span class="o">:</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">({}),</span>

    <span class="nx">routes</span><span class="o">:</span> <span class="p">{},</span>

    <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">onready</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">onready</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_setup</span><span class="p">();</span>
        <span class="nx">setState</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">curParams</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;&lt;a &quot;</span> <span class="o">+</span> <span class="nx">makeProps</span><span class="p">(</span>
      <span class="nx">extend</span><span class="p">({</span>
        <span class="nx">href</span><span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">merge</span><span class="p">)</span>
      <span class="p">},</span> <span class="nx">props</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">current</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">_setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If the hash changes, update the <code>can.route.data</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="nx">setState</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">_getHash</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/#!?/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">_setHash</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">serialized</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">serialized</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>The functions in the following list applied to <code>can.route</code> (e.g. <code>can.route.attr('...')</code>) will
instead act on the <code>can.route.data</code> observe.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">each</span><span class="p">([</span><span class="s1">&#39;bind&#39;</span><span class="p">,</span> <span class="s1">&#39;unbind&#39;</span><span class="p">,</span> <span class="s1">&#39;delegate&#39;</span><span class="p">,</span> <span class="s1">&#39;undelegate&#39;</span><span class="p">,</span> <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;removeAttr&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="kd">var</span> <span class="c1">// A ~~throttled~~ debounced function called multiple times will only fire once the</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>timer runs down. Each call resets the timer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">timer</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Intermediate storage for <code>can.route.data</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">curParams</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Deparameterizes the portion of the hash of interest and assign the
values to the <code>can.route.data</code> removing existing values no longer in the hash.
setState is called typically by hashchange which fires asynchronously
So it's possible that someone started changing the data before the 
hashchange event fired.  For this reason, it will not set the route data
if the data is changing or the hash already matches the hash that was set.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">setState</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">setState</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_getHash</span><span class="p">();</span>
    <span class="nx">curParams</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span><span class="nx">hash</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>if the hash data is currently changing, or
the hash is what we set it to anyway, do NOT change the hash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">changingData</span> <span class="o">||</span> <span class="nx">hash</span> <span class="o">!==</span> <span class="nx">lastHash</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">curParams</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>The last hash caused by a data change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">lastHash</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Are data changes pending that haven't yet updated the hash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">changingData</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>If the <code>can.route.data</code> changes, update the hash.
Using <code>.serialize()</code> retrieves the raw data contained in the <code>observable</code>.
This function is ~~throttled~~ debounced so it only updates once even if multiple values changed.
This might be able to use batchNum and avoid this.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>indicate that data is changing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">changingData</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
    <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>indicate that the hash is set to look like the data</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">changingData</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">serialized</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>

      <span class="nx">lastHash</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">_setHash</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><code>onready</code> event...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">ready</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>extend route to have a similar property 
that is often checked in mustache to determine
an object's observability</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">canMakeObserve</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">canMakeObserve</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 