<!DOCTYPE html>  <html> <head>   <title>qunit.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="amd.html">                 amd.js               </a>                                           <a class="source" href="construct.html">                 construct.js               </a>                                           <a class="source" href="proxy.html">                 proxy.js               </a>                                           <a class="source" href="super.html">                 super.js               </a>                                           <a class="source" href="control.html">                 control.js               </a>                                           <a class="source" href="plugin.html">                 plugin.js               </a>                                           <a class="source" href="view.html">                 view.js               </a>                                           <a class="source" href="model.html">                 model.js               </a>                                           <a class="source" href="observe.html">                 observe.js               </a>                                           <a class="source" href="attributes.html">                 attributes.js               </a>                                           <a class="source" href="backup.html">                 backup.js               </a>                                           <a class="source" href="compute.html">                 compute.js               </a>                                           <a class="source" href="delegate.html">                 delegate.js               </a>                                           <a class="source" href="setter.html">                 setter.js               </a>                                           <a class="source" href="validations.html">                 validations.js               </a>                                           <a class="source" href="route.html">                 route.js               </a>                                           <a class="source" href="each.html">                 each.js               </a>                                           <a class="source" href="can.html">                 can.js               </a>                                           <a class="source" href="deferred.html">                 deferred.js               </a>                                           <a class="source" href="dojo.html">                 dojo.js               </a>                                           <a class="source" href="event.html">                 event.js               </a>                                           <a class="source" href="fragment.html">                 fragment.js               </a>                                           <a class="source" href="jquery.html">                 jquery.js               </a>                                           <a class="source" href="mootools.html">                 mootools.js               </a>                                           <a class="source" href="object.html">                 object.js               </a>                                           <a class="source" href="extend.html">                 extend.js               </a>                                           <a class="source" href="isplain.html">                 isplain.js               </a>                                           <a class="source" href="string.html">                 string.js               </a>                                           <a class="source" href="deparam.html">                 deparam.js               </a>                                           <a class="source" href="yui.html">                 yui.js               </a>                                           <a class="source" href="zepto.html">                 zepto.js               </a>                                           <a class="source" href="data.html">                 data.js               </a>                                           <a class="source" href="view.html">                 view.js               </a>                                           <a class="source" href="ejs.html">                 ejs.js               </a>                                           <a class="source" href="modifiers.html">                 modifiers.js               </a>                                           <a class="source" href="render.html">                 render.js               </a>                                           <a class="source" href="scanner.html">                 scanner.js               </a>                                           <a class="source" href="can.dojo-1.1.0pre.html">                 can.dojo-1.1.0pre.js               </a>                                           <a class="source" href="can.dojo-1.1.0pre.min.html">                 can.dojo-1.1.0pre.min.js               </a>                                           <a class="source" href="can.jquery-1.1.0pre.html">                 can.jquery-1.1.0pre.js               </a>                                           <a class="source" href="can.jquery-1.1.0pre.min.html">                 can.jquery-1.1.0pre.min.js               </a>                                           <a class="source" href="can.mootools-1.1.0pre.html">                 can.mootools-1.1.0pre.js               </a>                                           <a class="source" href="can.mootools-1.1.0pre.min.html">                 can.mootools-1.1.0pre.min.js               </a>                                           <a class="source" href="can.yui-1.1.0pre.html">                 can.yui-1.1.0pre.js               </a>                                           <a class="source" href="can.yui-1.1.0pre.min.html">                 can.yui-1.1.0pre.min.js               </a>                                           <a class="source" href="can.zepto-1.1.0pre.html">                 can.zepto-1.1.0pre.js               </a>                                           <a class="source" href="can.zepto-1.1.0pre.min.html">                 can.zepto-1.1.0pre.min.js               </a>                                           <a class="source" href="can.construct.proxy-1.1.0pre.html">                 can.construct.proxy-1.1.0pre.js               </a>                                           <a class="source" href="can.construct.super-1.1.0pre.html">                 can.construct.super-1.1.0pre.js               </a>                                           <a class="source" href="can.control.plugin-1.1.0pre.html">                 can.control.plugin-1.1.0pre.js               </a>                                           <a class="source" href="can.control.view-1.1.0pre.html">                 can.control.view-1.1.0pre.js               </a>                                           <a class="source" href="can.fixture-1.1.0pre.html">                 can.fixture-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.attributes-1.1.0pre.html">                 can.observe.attributes-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.backup-1.1.0pre.html">                 can.observe.backup-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.delegate-1.1.0pre.html">                 can.observe.delegate-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.setter-1.1.0pre.html">                 can.observe.setter-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.validations-1.1.0pre.html">                 can.observe.validations-1.1.0pre.js               </a>                                           <a class="source" href="can.view.modifiers-1.1.0pre.html">                 can.view.modifiers-1.1.0pre.js               </a>                                           <a class="source" href="can.view.mustache-1.1.0pre.html">                 can.view.mustache-1.1.0pre.js               </a>                                           <a class="source" href="qunit.html">                 qunit.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               qunit.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">defined</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="o">:</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span>
    <span class="nx">sessionStorage</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">})()</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">testId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">toString</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">,</span>
    <span class="nx">hasOwn</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">Test</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">testName</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">testEnvironmentArg</span><span class="p">,</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">testName</span> <span class="o">=</span> <span class="nx">testName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">expected</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironmentArg</span> <span class="o">=</span> <span class="nx">testEnvironmentArg</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="nx">async</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">};</span>
  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">tests</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;strong&quot;</span><span class="p">);</span>
        <span class="nx">b</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Running &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;running&quot;</span><span class="p">;</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;test-output&quot;</span> <span class="o">+</span> <span class="nx">testId</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">tests</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">module</span> <span class="o">!=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">previousModule</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">previousModule</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;moduleDone&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">previousModule</span><span class="p">,</span>
            <span class="nx">failed</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
            <span class="nx">passed</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">all</span> <span class="o">-</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
            <span class="nx">total</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">all</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">previousModule</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span><span class="p">;</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">all</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">bad</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">};</span>
        <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;moduleStart&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span>
        <span class="p">});</span>
      <span class="p">}</span>

      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({</span>
        <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>
        <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleTestEnvironment</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironmentArg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironmentArg</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;testStart&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span><span class="p">,</span>
        <span class="nx">module</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>allow utility functions to access the current test environment
TODO why??</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">current_testEnvironment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">saveGlobal</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Setup failed on &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">notrycatch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Test &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span> <span class="o">+</span> <span class="s2">&quot; died, exception and test follows&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">);</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Died on test #&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>else next test will carry the responsibility</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">saveGlobal</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Restart the tests if they're blocking</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">start</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">.</span><span class="nx">teardown</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">testEnvironment</span><span class="p">);</span>
        <span class="nx">checkPollution</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Teardown failed on &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">finish</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">expected</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">expected</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Expected &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">expected</span> <span class="o">+</span> <span class="s2">&quot; assertions, but &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; were run&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">good</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">bad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">tests</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">);</span>

      <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">all</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">all</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ol</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;ol&quot;</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">assertion</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">);</span>
          <span class="nx">li</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">assertion</span><span class="p">.</span><span class="nx">result</span> <span class="o">?</span> <span class="s2">&quot;pass&quot;</span> <span class="o">:</span> <span class="s2">&quot;fail&quot;</span><span class="p">;</span>
          <span class="nx">li</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">assertion</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="p">(</span><span class="nx">assertion</span><span class="p">.</span><span class="nx">result</span> <span class="o">?</span> <span class="s2">&quot;okay&quot;</span> <span class="o">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">);</span>
          <span class="nx">ol</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">assertion</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">good</span><span class="o">++</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>store result when possible</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">reorder</span> <span class="o">&amp;&amp;</span> <span class="nx">defined</span><span class="p">.</span><span class="nx">sessionStorage</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">bad</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;qunit-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span><span class="p">,</span> <span class="nx">bad</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;qunit-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">bad</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;strong&quot;</span><span class="p">);</span>
        <span class="nx">b</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; &lt;b class=&#39;counts&#39;&gt;(&lt;b class=&#39;failed&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">bad</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;, &lt;b class=&#39;passed&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">good</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot;)&lt;/b&gt;&quot;</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Rerun&quot;</span><span class="p">;</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">url</span><span class="p">({</span>
          <span class="nx">filter</span><span class="o">:</span> <span class="nx">getText</span><span class="p">([</span><span class="nx">b</span><span class="p">]).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\([^)]+\)$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s*|\s*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">});</span>

        <span class="nx">addEvent</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">,</span>
            <span class="nx">display</span> <span class="o">=</span> <span class="nx">next</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="p">;</span>
          <span class="nx">next</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">display</span> <span class="o">===</span> <span class="s2">&quot;none&quot;</span> <span class="o">?</span> <span class="s2">&quot;block&quot;</span> <span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">addEvent</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;span&quot;</span> <span class="o">||</span> <span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;strong&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">url</span><span class="p">({</span>
              <span class="nx">filter</span><span class="o">:</span> <span class="nx">getText</span><span class="p">([</span><span class="nx">target</span><span class="p">]).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\([^)]+\)$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s*|\s*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>

        <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">bad</span> <span class="o">?</span> <span class="s2">&quot;fail&quot;</span> <span class="o">:</span> <span class="s2">&quot;pass&quot;</span><span class="p">;</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">li</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ol</span><span class="p">);</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="o">++</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">QUnit</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;reset() failed, following Test &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span> <span class="o">+</span> <span class="s2">&quot;, exception and reset fn follows&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">reset</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;testDone&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span><span class="p">,</span>
        <span class="nx">module</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span><span class="p">,</span>
        <span class="nx">failed</span><span class="o">:</span> <span class="nx">bad</span><span class="p">,</span>
        <span class="nx">passed</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">bad</span><span class="p">,</span>
        <span class="nx">total</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">length</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">queue</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">synchronize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">test</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>each of these can by async</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">synchronize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">test</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="nx">synchronize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">test</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="nx">synchronize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">test</span><span class="p">.</span><span class="nx">teardown</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="nx">synchronize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">test</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>defer when previous test run passed, if storage is available</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">bad</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">reorder</span> <span class="o">&amp;&amp;</span> <span class="nx">defined</span><span class="p">.</span><span class="nx">sessionStorage</span> <span class="o">&amp;&amp;</span> <span class="o">+</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;qunit-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">testName</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">bad</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">run</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">synchronize</span><span class="p">(</span><span class="nx">run</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>

  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">QUnit</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>call on start of module test to prepend name to all tests</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">module</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">testEnvironment</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">currentModuleTestEnviroment</span> <span class="o">=</span> <span class="nx">testEnvironment</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">asyncTest</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">testName</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
        <span class="nx">expected</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">testName</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">testName</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;test-name&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">testName</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span>
        <span class="nx">testEnvironmentArg</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
        <span class="nx">expected</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>is 2nd argument a testEnvironment?</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">expected</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">expected</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">testEnvironmentArg</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
        <span class="nx">expected</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;module-name&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;: &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validTest</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">testName</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">testName</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">testEnvironmentArg</span><span class="p">,</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="nx">test</span><span class="p">.</span><span class="nx">module</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span><span class="p">;</span>
      <span class="nx">test</span><span class="p">.</span><span class="nx">moduleTestEnvironment</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">currentModuleTestEnviroment</span><span class="p">;</span>
      <span class="nx">test</span><span class="p">.</span><span class="nx">queue</span><span class="p">();</span>
    <span class="p">},</span>


    <span class="nx">expect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">asserts</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">expected</span> <span class="o">=</span> <span class="nx">asserts</span><span class="p">;</span>
    <span class="p">},</span>


    <span class="nx">ok</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">a</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">a</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">details</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">result</span><span class="o">:</span> <span class="nx">a</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">msg</span>
      <span class="p">};</span>
      <span class="nx">msg</span> <span class="o">=</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
      <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="nx">details</span><span class="p">);</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">result</span><span class="o">:</span> <span class="nx">a</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">msg</span>
      <span class="p">});</span>
    <span class="p">},</span>


    <span class="nx">equal</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">expected</span> <span class="o">==</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">notEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">expected</span> <span class="o">!=</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">deepEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">equiv</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">),</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">notDeepEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">!</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">equiv</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">),</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">strictEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">expected</span> <span class="o">===</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">notStrictEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">expected</span> <span class="o">!==</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">raises</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">expected</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
        <span class="nx">expected</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">block</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">actual</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">actual</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>we don't want to validate thrown error</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>expected is a regexp</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;regexp&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ok</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">actual</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>expected is a constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">actual</span> <span class="k">instanceof</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>expected is a validation function which returns true is validation passed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">expected</span><span class="p">.</span><span class="nx">call</span><span class="p">({},</span> <span class="nx">actual</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">ok</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">-=</span> <span class="nx">count</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>don't start until equal number of stop-calls</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>ignore if start is called more often then stop</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>A slight delay, to avoid any current callbacks</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">defined</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">process</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">13</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">process</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">+=</span> <span class="nx">count</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">testTimeout</span> <span class="o">&amp;&amp;</span> <span class="nx">defined</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Test timed out&quot;</span><span class="p">);</span>
          <span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">},</span> <span class="nx">config</span><span class="p">.</span><span class="nx">testTimeout</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>We want access to the constructor's prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">F</span><span class="p">()</span> <span class="p">{};</span>
    <span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">;</span>
    <span class="nx">QUnit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">F</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Make F QUnit's constructor so that we can add to the prototype later</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">F</span><span class="p">;</span>
  <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Backwards compatibility, deprecated</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equals</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equal</span><span class="p">;</span>
  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">same</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Maintain internal state</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The queue of tests to run</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">queue</span><span class="o">:</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>block until document ready</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">blocking</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>when enabled, show only failing tests
gets persisted through sessionStorage and can be changed in UI via checkbox</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hidepassed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>by default, run previously failed tests first
very useful in combination with "Hide passed tests" checked</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">reorder</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>by default, modify document.title when suite is done</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">altertitle</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

    <span class="nx">urlConfig</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;noglobals&#39;</span><span class="p">,</span> <span class="s1">&#39;notrycatch&#39;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>logging callback queues</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">begin</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">done</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">log</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">testStart</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">testDone</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">moduleStart</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">moduleDone</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Load paramaters</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">location</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">||</span> <span class="p">{</span>
      <span class="nx">search</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">protocol</span><span class="o">:</span> <span class="s2">&quot;file:&quot;</span>
    <span class="p">},</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">),</span>
      <span class="nx">length</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="nx">urlParams</span> <span class="o">=</span> <span class="p">{},</span>
      <span class="nx">current</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">current</span> <span class="o">=</span> <span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">);</span>
        <span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>allow just a key to turn on a flag, e.g., test.html?noglobals</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">urlParams</span><span class="p">[</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">urlParams</span> <span class="o">=</span> <span class="nx">urlParams</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">urlParams</span><span class="p">.</span><span class="nx">filter</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Figure out if we're running the tests from a server or not</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">isLocal</span> <span class="o">=</span> <span class="o">!!</span> <span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">===</span> <span class="s1">&#39;file:&#39;</span><span class="p">);</span>
  <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Expose the API as global variables, unless an 'exports'
object exists, in that case we assume we're in CommonJS</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">require</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">extend</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">);</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">QUnit</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">extend</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">);</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">QUnit</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>define these after exposing globals to keep them in these QUnit namespace only</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">extend</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Initialize the configuration options</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">stats</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">all</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">bad</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="nx">moduleStats</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">all</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">bad</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="nx">started</span><span class="o">:</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">,</span>
        <span class="nx">updateRate</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="nx">blocking</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">autostart</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">autorun</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">filter</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">queue</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">semaphore</span><span class="o">:</span> <span class="mi">0</span>
      <span class="p">});</span>

      <span class="kd">var</span> <span class="nx">tests</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">),</span>
        <span class="nx">banner</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-banner&quot;</span><span class="p">),</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-testresult&quot;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tests</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">banner</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">banner</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">);</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;qunit-testresult&quot;</span><span class="p">;</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;result&quot;</span><span class="p">;</span>
        <span class="nx">tests</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">tests</span><span class="p">);</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Running...&lt;br/&gt;&amp;nbsp;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>


    <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#qunit-fixture&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">fixture</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s1">&#39;qunit-fixture&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">main</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">main</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">fixture</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>


    <span class="nx">triggerEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;MouseEvents&quot;</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">initMouseEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Safe object type checking</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">is</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="nx">type</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">objectType</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;undefined&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>consider: typeof null === object</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;null&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\[object\s(.*)\]$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

      <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;Number&#39;</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s2">&quot;nan&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s2">&quot;number&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="k">case</span> <span class="s1">&#39;String&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;Boolean&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;Array&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;Date&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;RegExp&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;Function&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;object&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">push</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">details</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">result</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span>
        <span class="nx">actual</span><span class="o">:</span> <span class="nx">actual</span><span class="p">,</span>
        <span class="nx">expected</span><span class="o">:</span> <span class="nx">expected</span>
      <span class="p">};</span>

      <span class="nx">message</span> <span class="o">=</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span> <span class="o">?</span> <span class="s2">&quot;okay&quot;</span> <span class="o">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">);</span>
      <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;test-message&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
      <span class="nx">expected</span> <span class="o">=</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">expected</span><span class="p">));</span>
      <span class="nx">actual</span> <span class="o">=</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">actual</span><span class="p">));</span>
      <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">message</span> <span class="o">+</span> <span class="s1">&#39;&lt;table&gt;&lt;tr class=&quot;test-expected&quot;&gt;&lt;th&gt;Expected: &lt;/th&gt;&lt;td&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">expected</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">actual</span> <span class="o">!=</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">output</span> <span class="o">+=</span> <span class="s1">&#39;&lt;tr class=&quot;test-actual&quot;&gt;&lt;th&gt;Result: &lt;/th&gt;&lt;td&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">actual</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">;</span>
        <span class="nx">output</span> <span class="o">+=</span> <span class="s1">&#39;&lt;tr class=&quot;test-diff&quot;&gt;&lt;th&gt;Diff: &lt;/th&gt;&lt;td&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">diff</span><span class="p">(</span><span class="nx">expected</span><span class="p">,</span> <span class="nx">actual</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">sourceFromStacktrace</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">details</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">source</span><span class="p">;</span>
          <span class="nx">output</span> <span class="o">+=</span> <span class="s1">&#39;&lt;tr class=&quot;test-source&quot;&gt;&lt;th&gt;Source: &lt;/th&gt;&lt;td&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">output</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">;</span>

      <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="nx">details</span><span class="p">);</span>

      <span class="nx">config</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">result</span><span class="o">:</span> <span class="o">!!</span> <span class="nx">result</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">output</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">urlParams</span><span class="p">),</span> <span class="nx">params</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">querystring</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="nx">key</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">querystring</span> <span class="o">+=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">extend</span><span class="o">:</span> <span class="nx">extend</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
    <span class="nx">addEvent</span><span class="o">:</span> <span class="nx">addEvent</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>QUnit.constructor is set to the empty F() above so that we can add to it's prototype later
Doing this allows us to tell if the following methods have been overwritten on the actual
QUnit object, which is a deprecated way of using the callbacks.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">extend</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Logging callbacks; all receive a single argument with the listed properties
run test/logs.html for any related changes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">begin</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;begin&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>done: { failed, passed, total, runtime }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">done</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>log: { result, actual, expected, message }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">log</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>testStart: { name }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">testStart</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;testStart&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>testDone: { name, failed, passed, total }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">testDone</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;testDone&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>moduleStart: { name }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">moduleStart</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;moduleStart&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>moduleDone: { name, failed, passed, total }</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">moduleDone</span><span class="o">:</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="s1">&#39;moduleDone&#39;</span><span class="p">)</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">&quot;complete&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">autorun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;begin&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{});</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Initialize the config, saving the execution queue</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">oldconfig</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">config</span><span class="p">);</span>
    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">oldconfig</span><span class="p">);</span>

    <span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">urlConfigHtml</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">len</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">urlConfig</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">val</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">urlConfig</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">[</span><span class="nx">val</span><span class="p">]</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">urlParams</span><span class="p">[</span><span class="nx">val</span><span class="p">];</span>
      <span class="nx">urlConfigHtml</span> <span class="o">+=</span> <span class="s1">&#39;&lt;label&gt;&lt;input name=&quot;&#39;</span> <span class="o">+</span> <span class="nx">val</span> <span class="o">+</span> <span class="s1">&#39;&quot; type=&quot;checkbox&quot;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">config</span><span class="p">[</span><span class="nx">val</span><span class="p">]</span> <span class="o">?</span> <span class="s1">&#39; checked=&quot;checked&quot;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">val</span> <span class="o">+</span> <span class="s1">&#39;&lt;/label&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">userAgent</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-userAgent&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">userAgent</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">banner</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-header&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">banner</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">banner</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">url</span><span class="p">({</span>
        <span class="nx">filter</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">})</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt; &#39;</span> <span class="o">+</span> <span class="nx">banner</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt; &#39;</span> <span class="o">+</span> <span class="nx">urlConfigHtml</span><span class="p">;</span>
      <span class="nx">addEvent</span><span class="p">(</span><span class="nx">banner</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">params</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">toolbar</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-testrunner-toolbar&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">toolbar</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;checkbox&quot;</span><span class="p">;</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;qunit-filter-pass&quot;</span><span class="p">;</span>
      <span class="nx">addEvent</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ol</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot; hidepass&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\n\t\r]/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
          <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ hidepass /</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">defined</span><span class="p">.</span><span class="nx">sessionStorage</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;qunit-filter-passed-tests&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;qunit-filter-passed-tests&quot;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">hidepassed</span> <span class="o">||</span> <span class="nx">defined</span><span class="p">.</span><span class="nx">sessionStorage</span> <span class="o">&amp;&amp;</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;qunit-filter-passed-tests&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">filter</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ol</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">);</span>
        <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot; hidepass&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">toolbar</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">);</span>
      <span class="nx">label</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="s2">&quot;qunit-filter-pass&quot;</span><span class="p">);</span>
      <span class="nx">label</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Hide passed tests&quot;</span><span class="p">;</span>
      <span class="nx">toolbar</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">label</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s1">&#39;qunit-fixture&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">main</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">fixture</span> <span class="o">=</span> <span class="nx">main</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">autostart</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">addEvent</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">load</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>addEvent(window, "error") gives us a useless event object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">file</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">line</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;global failure&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">file</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">line</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">done</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">autorun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Log the last module results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;moduleDone&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">currentModule</span><span class="p">,</span>
        <span class="nx">failed</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
        <span class="nx">passed</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">all</span> <span class="o">-</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
        <span class="nx">total</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">moduleStats</span><span class="p">.</span><span class="nx">all</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">banner</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-banner&quot;</span><span class="p">),</span>
      <span class="nx">tests</span> <span class="o">=</span> <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-tests&quot;</span><span class="p">),</span>
      <span class="nx">runtime</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">config</span><span class="p">.</span><span class="nx">started</span><span class="p">,</span>
      <span class="nx">passed</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">all</span> <span class="o">-</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tests completed in &#39;</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">,</span> <span class="s1">&#39; milliseconds.&lt;br/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;span class=&quot;passed&quot;&gt;&#39;</span><span class="p">,</span> <span class="nx">passed</span><span class="p">,</span> <span class="s1">&#39;&lt;/span&gt; tests of &lt;span class=&quot;total&quot;&gt;&#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span> <span class="s1">&#39;&lt;/span&gt; passed, &lt;span class=&quot;failed&quot;&gt;&#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span> <span class="s1">&#39;&lt;/span&gt; failed.&#39;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">banner</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">banner</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span> <span class="o">?</span> <span class="s2">&quot;qunit-fail&quot;</span> <span class="o">:</span> <span class="s2">&quot;qunit-pass&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">id</span><span class="p">(</span><span class="s2">&quot;qunit-testresult&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">altertitle</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nb">document</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>show âœ– for good, âœ” for bad suite result in title
use escape sequences in case file gets loaded with non-utf-8-charset</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="p">[(</span><span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span> <span class="o">?</span> <span class="s2">&quot;\u2716&quot;</span> <span class="o">:</span> <span class="s2">&quot;\u2714&quot;</span><span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\u2714\u2716] /i</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">failed</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">bad</span><span class="p">,</span>
      <span class="nx">passed</span><span class="o">:</span> <span class="nx">passed</span><span class="p">,</span>
      <span class="nx">total</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span>
      <span class="nx">runtime</span><span class="o">:</span> <span class="nx">runtime</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">validTest</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">filter</span><span class="p">,</span>
      <span class="nx">run</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">not</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">not</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">filter</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!</span><span class="nx">not</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">not</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">run</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">run</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>so far supports only Firefox, Chrome and Opera (buggy)
could be extended in the future to use something like https://github.com/csnover/TraceKit</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">sourceFromStacktrace</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stacktrace</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Opera</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stacktrace</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Firefox, Chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">sourceURL</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Safari, PhantomJS
TODO sourceURL points at the 'throw new Error' line above, useless
return e.sourceURL + ":" + e.line;</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">escapeInnerText</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\&amp;&lt;&gt;]/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;amp;&quot;</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;&lt;&quot;</span><span class="o">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">synchronize</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">autorun</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">process</span><span class="p">(</span><span class="nx">last</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">depth</span> <span class="o">?</span> <span class="nx">config</span><span class="p">.</span><span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">defined</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="o">||</span> <span class="nx">config</span><span class="p">.</span><span class="nx">updateRate</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">updateRate</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">()();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">process</span><span class="p">(</span><span class="nx">last</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">13</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">depth</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blocking</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">done</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">saveGlobal</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">noglobals</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">checkPollution</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span><span class="p">;</span>
    <span class="nx">saveGlobal</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">newGlobals</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span><span class="p">,</span> <span class="nx">old</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newGlobals</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Introduced global variable(s): &quot;</span> <span class="o">+</span> <span class="nx">newGlobals</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">deletedGlobals</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">old</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">pollution</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">deletedGlobals</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;Deleted global variable(s): &quot;</span> <span class="o">+</span> <span class="nx">deletedGlobals</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>returns a new Array with the elements that are in a but not in b</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">b</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">result</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="nx">i</span><span class="o">--</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">fail</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">exception</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">exception</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opera</span> <span class="o">&amp;&amp;</span> <span class="nx">opera</span><span class="p">.</span><span class="nx">postError</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">opera</span><span class="p">.</span><span class="nx">postError</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">exception</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">toString</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">a</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">fn</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">id</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">registerLoggingCallback</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Supports deprecated method of completely overwriting logging callbacks</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">runLoggingCallbacks</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>debugger;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">callbacks</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">QUnit</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Test for equality any JavaScript type.
Author: Philippe RathÃ© <a href="m&#x61;&#x69;&#x6C;&#116;o:&#112;&#x72;&#x61;&#x74;&#104;&#101;&#64;g&#x6D;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;">&#112;&#x72;&#x61;&#x74;&#104;&#101;&#64;g&#x6D;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;</a></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">equiv</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">innerEquiv</span><span class="p">;</span> <span class="c1">// the real equiv function</span>
    <span class="kd">var</span> <span class="nx">callers</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// stack to decide between skip/abort functions</span>
    <span class="kd">var</span> <span class="nx">parents</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// stack to avoiding loops from circular referencing</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Call the o related callback with the given arguments.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">bindCallbacks</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">prop</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span> <span class="c1">// or undefined</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>for string, boolean, number and null</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">useStrictEquality</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="k">instanceof</span> <span class="nx">a</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">||</span> <span class="nx">a</span> <span class="k">instanceof</span> <span class="nx">b</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>to catch short annotaion VS 'new' annotation of a
declaration
e.g. var i = 1;
var j = new Number(1);</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">a</span> <span class="o">==</span> <span class="nx">b</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;string&quot;</span><span class="o">:</span> <span class="nx">useStrictEquality</span><span class="p">,</span>
        <span class="s2">&quot;boolean&quot;</span><span class="o">:</span> <span class="nx">useStrictEquality</span><span class="p">,</span>
        <span class="s2">&quot;number&quot;</span><span class="o">:</span> <span class="nx">useStrictEquality</span><span class="p">,</span>
        <span class="s2">&quot;null&quot;</span><span class="o">:</span> <span class="nx">useStrictEquality</span><span class="p">,</span>
        <span class="s2">&quot;undefined&quot;</span><span class="o">:</span> <span class="nx">useStrictEquality</span><span class="p">,</span>

        <span class="s2">&quot;nan&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;date&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">===</span> <span class="nx">b</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="s2">&quot;regexp&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;regexp&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">source</span> <span class="o">===</span> <span class="nx">b</span><span class="p">.</span><span class="nx">source</span> <span class="o">&amp;&amp;</span> <span class="c1">// the regex itself</span>
          <span class="nx">a</span><span class="p">.</span><span class="nx">global</span> <span class="o">===</span> <span class="nx">b</span><span class="p">.</span><span class="nx">global</span> <span class="o">&amp;&amp;</span> <span class="c1">// and its modifers</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>(gmi) ...</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">a</span><span class="p">.</span><span class="nx">ignoreCase</span> <span class="o">===</span> <span class="nx">b</span><span class="p">.</span><span class="nx">ignoreCase</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">multiline</span> <span class="o">===</span> <span class="nx">b</span><span class="p">.</span><span class="nx">multiline</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <ul>
<li>skip when the property is a method of an instance (OOP)</li>
<li>abort otherwise,
initial === would have catch identical references anyway</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">caller</span> <span class="o">=</span> <span class="nx">callers</span><span class="p">[</span><span class="nx">callers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">caller</span> <span class="o">!==</span> <span class="nb">Object</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">caller</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="s2">&quot;array&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">loop</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">len</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>b could be an object literal here</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;array&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">len</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// safe and faster</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>track reference to avoid circular references</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">parents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">parents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">parents</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">===</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// dont rewalk array</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loop</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">innerEquiv</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
              <span class="nx">parents</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
              <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="nx">parents</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="s2">&quot;object&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">loop</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">eq</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// unless we can proove it</span>
          <span class="kd">var</span> <span class="nx">aProperties</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">bProperties</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// collection of</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>strings
comparing constructors is more strict than using
instanceof</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>stack constructor before traversing properties</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">callers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">constructor</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>track reference to avoid circular references</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">parents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// be strict: don&#39;t ensures hasOwnProperty</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>and go deep</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">loop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">parents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">parents</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">===</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// don&#39;t go down the same path</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>twice</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">}</span>
            <span class="nx">aProperties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="c1">// collect a&#39;s properties</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loop</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">innerEquiv</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
              <span class="nx">eq</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="nx">callers</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// unstack, we are done</span>
          <span class="nx">parents</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bProperties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="c1">// collect b&#39;s properties</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Ensures identical properties name</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">eq</span> <span class="o">&amp;&amp;</span> <span class="nx">innerEquiv</span><span class="p">(</span><span class="nx">aProperties</span><span class="p">.</span><span class="nx">sort</span><span class="p">(),</span> <span class="nx">bProperties</span><span class="p">.</span><span class="nx">sort</span><span class="p">());</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}();</span>

    <span class="nx">innerEquiv</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="c1">// can take multiple arguments</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// end transition</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// catch the most you can</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">b</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">objectType</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// don&#39;t lose time with error prone cases</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">bindCallbacks</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">,</span> <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">]);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>apply transition with (1..n) arguments</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">})(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">innerEquiv</span><span class="p">;</span>

  <span class="p">}();</span>


  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">quote</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">str</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">literal</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">o</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">join</span><span class="p">(</span><span class="nx">pre</span><span class="p">,</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">jsDump</span><span class="p">.</span><span class="nx">separator</span><span class="p">(),</span>
        <span class="nx">base</span> <span class="o">=</span> <span class="nx">jsDump</span><span class="p">.</span><span class="nx">indent</span><span class="p">(),</span>
        <span class="nx">inner</span> <span class="o">=</span> <span class="nx">jsDump</span><span class="p">.</span><span class="nx">indent</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">arr</span><span class="p">)</span> <span class="k">return</span> <span class="nx">pre</span> <span class="o">+</span> <span class="nx">post</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">pre</span><span class="p">,</span> <span class="nx">inner</span> <span class="o">+</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">base</span> <span class="o">+</span> <span class="nx">post</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">array</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">up</span><span class="p">();</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">--</span><span class="p">)</span>
      <span class="nx">ret</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">down</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">join</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">reName</span> <span class="o">=</span> <span class="sr">/^function (\w+)/</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">jsDump</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//type is used mostly internally, you can fix a (custom)type in advance</span>
        <span class="nx">stack</span> <span class="o">=</span> <span class="nx">stack</span> <span class="o">||</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parsers</span><span class="p">[</span><span class="nx">type</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">typeOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)];</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">parser</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">inStack</span> <span class="o">=</span> <span class="nx">inArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inStack</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s1">&#39;recursion(&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">inStack</span> <span class="o">-</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>else</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>else</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">parser</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parsers</span><span class="p">.</span><span class="nx">error</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">typeOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">type</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;RegExp&quot;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;regexp&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;function&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">setInterval</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nb">document</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;window&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;node&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>native arrays</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;[object Array]&quot;</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>NodeList objects</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">item</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">))))</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;array&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">separator</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">multiline</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">HTML</span> <span class="o">?</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;\n&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">HTML</span> <span class="o">?</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">:</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">indent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">extra</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// extra can be a number, shortcut for increasing-calling-decreasing</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">multiline</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">chr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indentChar</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">HTML</span><span class="p">)</span> <span class="nx">chr</span> <span class="o">=</span> <span class="nx">chr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\t/g</span><span class="p">,</span> <span class="s1">&#39;   &#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ /g</span><span class="p">,</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_depth_</span> <span class="o">+</span> <span class="p">(</span><span class="nx">extra</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="nx">chr</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">up</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_depth_</span> <span class="o">+=</span> <span class="nx">a</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">down</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_depth_</span> <span class="o">-=</span> <span class="nx">a</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">setParser</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">parser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">parsers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>The next 3 are exposed so you can use them</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">quote</span><span class="o">:</span> <span class="nx">quote</span><span class="p">,</span>
      <span class="nx">literal</span><span class="o">:</span> <span class="nx">literal</span><span class="p">,</span>
      <span class="nx">join</span><span class="o">:</span> <span class="nx">join</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_depth_</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>This is the list of parsers, to modify them, use jsDump.setParser</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">parsers</span><span class="o">:</span> <span class="p">{</span>
        <span class="nb">window</span><span class="o">:</span> <span class="s1">&#39;[Window]&#39;</span><span class="p">,</span>
        <span class="nb">document</span><span class="o">:</span> <span class="s1">&#39;[Document]&#39;</span><span class="p">,</span>
        <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;[ERROR]&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>when no parser is found, shouldn't happen</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">unknown</span><span class="o">:</span> <span class="s1">&#39;[Unknown]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;null&#39;</span><span class="o">:</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span>
        <span class="s1">&#39;undefined&#39;</span><span class="o">:</span> <span class="s1">&#39;undefined&#39;</span><span class="p">,</span>
        <span class="s1">&#39;function&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span> <span class="k">in</span> <span class="nx">fn</span> <span class="o">?</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">name</span> <span class="o">:</span> <span class="p">(</span><span class="nx">reName</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="o">||</span> <span class="p">[])[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//functions never have name in IE</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="nx">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
          <span class="nx">ret</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span><span class="p">;</span>

          <span class="nx">ret</span> <span class="o">=</span> <span class="p">[</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="s1">&#39;functionArgs&#39;</span><span class="p">),</span> <span class="s1">&#39;){&#39;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">join</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="s1">&#39;functionCode&#39;</span><span class="p">),</span> <span class="s1">&#39;}&#39;</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">array</span><span class="o">:</span> <span class="nx">array</span><span class="p">,</span>
        <span class="nx">nodelist</span><span class="o">:</span> <span class="nx">array</span><span class="p">,</span>
        <span class="nx">arguments</span><span class="o">:</span> <span class="nx">array</span><span class="p">,</span>
        <span class="nx">object</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">up</span><span class="p">();</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">stack</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">down</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">join</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">node</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">open</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">HTML</span> <span class="o">?</span> <span class="s1">&#39;&amp;lt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span>
            <span class="nx">close</span> <span class="o">=</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">HTML</span> <span class="o">?</span> <span class="s1">&#39;&amp;gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">;</span>

          <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">open</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">DOMAttrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">DOMAttrs</span><span class="p">[</span><span class="nx">a</span><span class="p">]];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="nx">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">QUnit</span><span class="p">.</span><span class="nx">jsDump</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">ret</span> <span class="o">+</span> <span class="nx">close</span> <span class="o">+</span> <span class="nx">open</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">tag</span> <span class="o">+</span> <span class="nx">close</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">functionArgs</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//function calls it internally, it&#39;s the arguments part of the function</span>
          <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">l</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

          <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">l</span><span class="o">--</span><span class="p">)</span>
          <span class="nx">args</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">97</span> <span class="o">+</span> <span class="nx">l</span><span class="p">);</span> <span class="c1">//97 is &#39;a&#39;</span>
          <span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">key</span><span class="o">:</span> <span class="nx">quote</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>object calls it internally, the key part of an item in a map</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">functionCode</span><span class="o">:</span> <span class="s1">&#39;[code]&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>function calls it internally, it's the content of the function</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">attribute</span><span class="o">:</span> <span class="nx">quote</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>node calls it internally, it's an html attribute value</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">string</span><span class="o">:</span> <span class="nx">quote</span><span class="p">,</span>
        <span class="nx">date</span><span class="o">:</span> <span class="nx">quote</span><span class="p">,</span>
        <span class="nx">regexp</span><span class="o">:</span> <span class="nx">literal</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>regex</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">number</span><span class="o">:</span> <span class="nx">literal</span><span class="p">,</span>
        <span class="s1">&#39;boolean&#39;</span><span class="o">:</span> <span class="nx">literal</span>
      <span class="p">},</span>
      <span class="nx">DOMAttrs</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//attributes to dump from nodes, name=&gt;realName</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;className&#39;</span>
      <span class="p">},</span>
      <span class="nx">HTML</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>if true, entities are escaped ( &lt;, >, \t, space and \n )</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">indentChar</span><span class="o">:</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>indentation unit</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">multiline</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">//if true, items in a collection, are separated by a \n, else just a space.</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">jsDump</span><span class="p">;</span>
  <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>from Sizzle.js</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">getText</span><span class="p">(</span><span class="nx">elems</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">elem</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Get the text from text nodes and CDATA nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span> <span class="o">+=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Traverse everything else, except comment nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span> <span class="o">+=</span> <span class="nx">getText</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>from jquery.js</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">inArray</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">QUnit</span><span class="p">.</span><span class="nx">diff</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">ns</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">rows</span><span class="o">:</span> <span class="p">[],</span>
          <span class="nx">o</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">};</span>
        <span class="nx">ns</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">rows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">os</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">os</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">rows</span><span class="o">:</span> <span class="p">[],</span>
          <span class="nx">n</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">};</span>
        <span class="nx">os</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">rows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ns</span><span class="p">,</span> <span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">os</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">os</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">n</span><span class="p">[</span><span class="nx">ns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">n</span><span class="p">[</span><span class="nx">ns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">os</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="p">};</span>
          <span class="nx">o</span><span class="p">[</span><span class="nx">os</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">o</span><span class="p">[</span><span class="nx">os</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">ns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="p">};</span>
          <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="p">};</span>
          <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">row</span><span class="o">:</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">o</span><span class="o">:</span> <span class="nx">o</span><span class="p">,</span>
        <span class="nx">n</span><span class="o">:</span> <span class="nx">n</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">n</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">o</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">),</span> <span class="nx">n</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">));</span>

      <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">oSpace</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">oSpace</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oSpace</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">oSpace</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">nSpace</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nSpace</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nSpace</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">nSpace</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;del&gt;&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">oSpace</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/del&gt;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;del&gt;&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">+</span> <span class="nx">oSpace</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/del&gt;&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;ins&gt;&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">nSpace</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/ins&gt;&quot;</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">pre</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">n</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">text</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">pre</span> <span class="o">+=</span> <span class="s1">&#39;&lt;del&gt;&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">+</span> <span class="nx">oSpace</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/del&gt;&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span> <span class="o">+</span> <span class="nx">nSpace</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">pre</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">})();</span>

<span class="p">})(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 