<!DOCTYPE html>  <html> <head>   <title>can.view.mustache-1.1.0pre.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="can.construct.proxy.html">                 can.construct.proxy.js               </a>                                           <a class="source" href="can.construct.super.html">                 can.construct.super.js               </a>                                           <a class="source" href="can.control.plugin.html">                 can.control.plugin.js               </a>                                           <a class="source" href="can.control.view.html">                 can.control.view.js               </a>                                           <a class="source" href="can.dojo-1.1.0pre.html">                 can.dojo-1.1.0pre.js               </a>                                           <a class="source" href="can.dojo.html">                 can.dojo.js               </a>                                           <a class="source" href="can.fixture.html">                 can.fixture.js               </a>                                           <a class="source" href="can.jquery-1.1.0pre.html">                 can.jquery-1.1.0pre.js               </a>                                           <a class="source" href="can.jquery.html">                 can.jquery.js               </a>                                           <a class="source" href="can.mootools-1.1.0pre.html">                 can.mootools-1.1.0pre.js               </a>                                           <a class="source" href="can.mootools.html">                 can.mootools.js               </a>                                           <a class="source" href="can.observe.attributes.html">                 can.observe.attributes.js               </a>                                           <a class="source" href="can.observe.backup.html">                 can.observe.backup.js               </a>                                           <a class="source" href="can.observe.delegate.html">                 can.observe.delegate.js               </a>                                           <a class="source" href="can.observe.setter.html">                 can.observe.setter.js               </a>                                           <a class="source" href="can.observe.validations.html">                 can.observe.validations.js               </a>                                           <a class="source" href="can.view.modifiers.html">                 can.view.modifiers.js               </a>                                           <a class="source" href="can.view.mustache.html">                 can.view.mustache.js               </a>                                           <a class="source" href="can.yui-1.1.0pre.html">                 can.yui-1.1.0pre.js               </a>                                           <a class="source" href="can.yui.html">                 can.yui.js               </a>                                           <a class="source" href="can.zepto-1.1.0pre.html">                 can.zepto-1.1.0pre.js               </a>                                           <a class="source" href="can.zepto.html">                 can.zepto.js               </a>                                           <a class="source" href="can.construct.proxy-1.1.0pre.html">                 can.construct.proxy-1.1.0pre.js               </a>                                           <a class="source" href="can.construct.super-1.1.0pre.html">                 can.construct.super-1.1.0pre.js               </a>                                           <a class="source" href="can.control.plugin-1.1.0pre.html">                 can.control.plugin-1.1.0pre.js               </a>                                           <a class="source" href="can.control.view-1.1.0pre.html">                 can.control.view-1.1.0pre.js               </a>                                           <a class="source" href="can.fixture-1.1.0pre.html">                 can.fixture-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.attributes-1.1.0pre.html">                 can.observe.attributes-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.backup-1.1.0pre.html">                 can.observe.backup-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.delegate-1.1.0pre.html">                 can.observe.delegate-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.setter-1.1.0pre.html">                 can.observe.setter-1.1.0pre.js               </a>                                           <a class="source" href="can.observe.validations-1.1.0pre.html">                 can.observe.validations-1.1.0pre.js               </a>                                           <a class="source" href="can.view.modifiers-1.1.0pre.html">                 can.view.modifiers-1.1.0pre.js               </a>                                           <a class="source" href="can.view.mustache-1.1.0pre.html">                 can.view.mustache-1.1.0pre.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               can.view.mustache-1.1.0pre.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>can/view/mustache/mustache.js</h2>

<p>Define the view extension</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">ext</span> <span class="o">=</span> <span class="s2">&quot;.mustache&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>internal helpers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">CONTEXT</span> <span class="o">=</span> <span class="s1">&#39;___c0nt3xt&#39;</span><span class="p">,</span>
    <span class="nx">HASH</span> <span class="o">=</span> <span class="s1">&#39;___h4sh&#39;</span><span class="p">,</span>
    <span class="nx">STACK</span> <span class="o">=</span> <span class="s1">&#39;___st4ck&#39;</span><span class="p">,</span>
    <span class="nx">CONTEXT_STACK</span> <span class="o">=</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">CONTEXT</span> <span class="o">+</span> <span class="s1">&#39;,this)&#39;</span><span class="p">,</span>

    <span class="nx">isObserve</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">attr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">canMakeObserve</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">isArrayLike</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">splice</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">Mustache</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Supports calling Mustache without the constructor
This returns a function that renders the template.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!=</span> <span class="nx">Mustache</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">mustache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mustache</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">mustache</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>If we get a <code>function</code> directly, it probably is coming from
a <code>steal</code>-packaged view.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">fn</span><span class="o">:</span> <span class="nx">options</span>
        <span class="p">};</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Set options on self.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scanner</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Put Mustache on the <code>can</code> object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">can</span><span class="p">.</span><span class="nx">Mustache</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Mustache</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">;</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span>

  <span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">extraHelpers</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">_data</span><span class="o">:</span> <span class="nx">object</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">scanner</span><span class="o">:</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Scanner</span><span class="p">({</span>

      <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;var &#39;</span> <span class="o">+</span> <span class="nx">CONTEXT</span> <span class="o">+</span> <span class="s1">&#39; = []; &#39;</span> <span class="o">+</span> <span class="nx">CONTEXT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39; = true;&#39;</span> <span class="o">+</span> <span class="s1">&#39;var &#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39; = function(context, self) {&#39;</span> <span class="o">+</span> <span class="s1">&#39;var s;&#39;</span> <span class="o">+</span> <span class="s1">&#39;if (arguments.length == 1 &amp;&amp; context) {&#39;</span> <span class="o">+</span> <span class="s1">&#39;s = !context.&#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39; ? [context] : context;&#39;</span> <span class="o">+</span> <span class="s1">&#39;} else {&#39;</span> <span class="o">+</span> <span class="s1">&#39;s = context &amp;&amp; context.&#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39; ? context.concat([self]) : &#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39;(context).concat([self]);&#39;</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> <span class="o">+</span> <span class="s1">&#39;return (s.&#39;</span> <span class="o">+</span> <span class="nx">STACK</span> <span class="o">+</span> <span class="s1">&#39; = true) &amp;&amp; s;&#39;</span> <span class="o">+</span> <span class="s1">&#39;};&#39;</span>
      <span class="p">},</span>

      <span class="nx">tokens</span><span class="o">:</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Return unescaped</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;returnLeft&quot;</span><span class="p">,</span> <span class="s2">&quot;{{{&quot;</span><span class="p">,</span> <span class="s2">&quot;{{[{&amp;]&quot;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Full line comments</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;commentFull&quot;</span><span class="p">,</span> <span class="s2">&quot;{{!}}&quot;</span><span class="p">,</span> <span class="s2">&quot;^[\\s\\t]*{{!.+?}}\\n&quot;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Inline comments</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;commentLeft&quot;</span><span class="p">,</span> <span class="s2">&quot;{{!&quot;</span><span class="p">,</span> <span class="s2">&quot;(\\n[\\s\\t]*{{!|{{!)&quot;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Full line escapes
This is used for detecting lines with only whitespace and an escaped tag</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;escapeFull&quot;</span><span class="p">,</span> <span class="s2">&quot;{{}}&quot;</span><span class="p">,</span> <span class="s2">&quot;(^[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}$)&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">before</span><span class="o">:</span> <span class="sr">/^\n.+?\n$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;\n&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
          <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\{\{(.+?)\}\}/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
        <span class="p">};</span>
      <span class="p">}],</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Return escaped</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;escapeLeft&quot;</span><span class="p">,</span> <span class="s2">&quot;{{&quot;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Close return unescaped</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;returnRight&quot;</span><span class="p">,</span> <span class="s2">&quot;}}}&quot;</span><span class="p">],</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Close tag</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;}}&quot;</span><span class="p">]],</span>

      <span class="nx">helpers</span><span class="o">:</span> <span class="p">[</span>

      <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="sr">/^&gt;[\s|\w]\w*/</span><span class="p">,</span>
        <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>get the template name and call back into the render method
passing the name and the current context</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">templateName</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&gt;\s?/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
          <span class="k">return</span> <span class="s2">&quot;can.view.render(&#39;&quot;</span> <span class="o">+</span> <span class="nx">templateName</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &quot;</span> <span class="o">+</span> <span class="nx">CONTEXT_STACK</span> <span class="o">+</span> <span class="s2">&quot;.pop())&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="sr">/^\s?data\s/</span><span class="p">,</span>
        <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s?data\s)|([&quot;&#39;])/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>return a function which calls <code>can.data</code> on the element
with the attribute name with the current context.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="s2">&quot;can.proxy(function(__){can.data(can.$(__),&#39;&quot;</span> <span class="o">+</span> <span class="nx">attr</span> <span class="o">+</span> <span class="s2">&quot;&#39;, this.pop()); }, &quot;</span> <span class="o">+</span> <span class="nx">CONTEXT_STACK</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="sr">/^.*$/</span><span class="p">,</span>
        <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Parse content</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">mode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Trim the content so we don't have any trailing whitespace</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">content</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Try to determine the mode the token is such as a eval, inverting, or closing</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([#^/]|else$)/</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nx">mode</span> <span class="o">=</span> <span class="nx">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;#&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;^&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">insert</span> <span class="o">+</span> <span class="s1">&#39;can.view.txt(0,\&#39;&#39;</span> <span class="o">+</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">+</span> <span class="s1">&#39;\&#39;,&#39;</span> <span class="o">+</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">&#39;,this,function(){ return &#39;</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Close section</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">case</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="p">{</span>
                <span class="nx">raw</span><span class="o">:</span> <span class="s1">&#39;return ___v1ew.join(&quot;&quot;);}}])}));&#39;</span>
              <span class="p">};</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">content</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">!=</span> <span class="s1">&#39;else&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[],</span>
              <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
              <span class="nx">hashing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nx">arg</span><span class="p">,</span> <span class="nx">split</span><span class="p">,</span> <span class="nx">m</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Parse the arguments
Needs to use this method of a split(/\s/) so that strings with spaces can be parsed</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/((([^\s]+?=)?(&#39;.*?&#39;|&quot;.*?&quot;))|.*?)\s/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">whole</span><span class="p">,</span> <span class="nx">part</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">part</span><span class="p">);</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Start the content</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;can.Mustache.txt(&#39;</span> <span class="o">+</span> <span class="nx">CONTEXT_STACK</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">?</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">mode</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">:</span> <span class="s1">&#39;null&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Iterate through the arguments</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">for</span> <span class="p">(;</span> <span class="nx">arg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">i</span> <span class="o">&amp;&amp;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Check for special helper arguments (string/number/boolean/hashes)</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^((&#39;.*?&#39;|&quot;.*?&quot;|[0-9.]+|true|false)|((.+?)=((&#39;.*?&#39;|&quot;.*?&quot;|[0-9.]+|true|false)|(.+))))$/</span><span class="p">)))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Found a string/number/boolean</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
                  <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Found a hash</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Open the hash</p>             </td>             <td class="code">               <div class="highlight"><pre>                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hashing</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">hashing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="nx">HASH</span> <span class="o">+</span> <span class="s1">&#39;:{&#39;</span><span class="p">);</span>
                  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Add the key/value</p>             </td>             <td class="code">               <div class="highlight"><pre>                  <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">?</span> <span class="nx">m</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;can.Mustache.get(&quot;&#39;</span> <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span> <span class="o">+</span> <span class="nx">CONTEXT_STACK</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Close the hash</p>             </td>             <td class="code">               <div class="highlight"><pre>                  <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;}}&#39;</span><span class="p">);</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Otherwise output a normal reference</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="k">else</span> <span class="p">{</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;can.Mustache.get(&quot;&#39;</span> <span class="o">+</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Include the reference</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">arg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span> <span class="o">+</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Then the local and stack contexts</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">CONTEXT_STACK</span> <span class="o">+</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Flag as a definite helper method</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;,true&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Handle sections</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">mode</span> <span class="o">&amp;&amp;</span> <span class="nx">mode</span> <span class="o">!=</span> <span class="s1">&#39;else&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;,[{_:function(){&#39;</span><span class="p">);</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Truthy section</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">case</span> <span class="s1">&#39;#&#39;</span><span class="o">:</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;return ___v1ew.join(&quot;&quot;);}},{fn:function(&#39;</span> <span class="o">+</span> <span class="nx">CONTEXT</span> <span class="o">+</span> <span class="s1">&#39;){var ___v1ew = [];&#39;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>If/else section
Falsey section</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">case</span> <span class="s1">&#39;else&#39;</span><span class="o">:</span>
          <span class="k">case</span> <span class="s1">&#39;^&#39;</span><span class="o">:</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;return ___v1ew.join(&quot;&quot;);}},{inverse:function(&#39;</span> <span class="o">+</span> <span class="nx">CONTEXT</span> <span class="o">+</span> <span class="s1">&#39;){var ___v1ew = [];&#39;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Not a section</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">default</span><span class="o">:</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;);&#39;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">mode</span> <span class="o">?</span> <span class="p">{</span>
            <span class="nx">raw</span><span class="o">:</span> <span class="nx">result</span>
          <span class="p">}</span> <span class="o">:</span> <span class="nx">result</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}]</span>
    <span class="p">})</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">helpers</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Scanner</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">helpers</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Mustache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">scanner</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">helpers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">};</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_helpers</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
      <span class="nx">fn</span><span class="o">:</span> <span class="nx">fn</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">getHelper</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">helper</span><span class="p">;</span> <span class="nx">helper</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_helpers</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Find the correct helper</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">helper</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">helper</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">txt</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="p">[{</span>
        <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>
        <span class="nx">inverse</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span>
      <span class="p">}].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">mode</span> <span class="o">?</span> <span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span> <span class="o">:</span> <span class="p">[])),</span>
      <span class="nx">validArgs</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">args</span> <span class="o">:</span> <span class="p">[</span><span class="nx">name</span><span class="p">],</span>
      <span class="nx">valid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">i</span><span class="p">,</span> <span class="nx">helper</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Validate based on the mode if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">validArgs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">isArrayLike</span><span class="p">(</span><span class="nx">validArgs</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">valid</span> <span class="o">=</span> <span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span> <span class="o">?</span> <span class="nx">valid</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span> <span class="nx">validArgs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span> <span class="o">:</span> <span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;^&#39;</span> <span class="o">?</span> <span class="nx">valid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">validArgs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span> <span class="o">:</span> <span class="nx">valid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">valid</span> <span class="o">=</span> <span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span> <span class="o">?</span> <span class="nx">valid</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span> <span class="nx">validArgs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">:</span> <span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;^&#39;</span> <span class="o">?</span> <span class="nx">valid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">validArgs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">:</span> <span class="nx">valid</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Check for a registered helper or a helper-like function</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">helper</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">getHelper</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">{</span>
      <span class="nx">fn</span><span class="o">:</span> <span class="nx">name</span>
    <span class="p">})))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Update the options with a function/inverse (the inner templates of a section)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">[</span><span class="nx">STACK</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">[</span><span class="nx">context</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="nx">context</span><span class="p">,</span>
        <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">fn</span><span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">),</span>
          <span class="nx">inverse</span><span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">inverse</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="nx">lastArg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Add the hash if one exists</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">lastArg</span> <span class="o">&amp;&amp;</span> <span class="nx">lastArg</span><span class="p">[</span><span class="nx">HASH</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">opts</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()[</span><span class="nx">HASH</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Call the helper</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">helper</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Otherwise interpolate like normal</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">valid</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Handle truthyness</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">switch</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;#&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Iterate over arrays</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">isArrayLike</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">context</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Normal case.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">name</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">context</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;^&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">inverse</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">name</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">context</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>add + '' to convert things like 0 to strings
this can cause issues if you are trying to
eval on the length but I think this is the more
common case</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ref</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">,</span> <span class="nx">isHelper</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">[</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
      <span class="nx">context</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">[</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span>
      <span class="nx">lastValue</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Handle "this" references for list iteration: {{.}} or {{this}}</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="sr">/^\.|this$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ref</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>If context isn't an object, then it was a value passed by a helper so use it as an override.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^object|undefined$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">context</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">context</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Otherwise just return the closest object.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Handle object resolution.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isHelper</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Check the context for the reference</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">value</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Make sure the context isn't a failed object before diving into it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Keep running up the tree while there are matches.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span><span class="p">[</span><span class="nx">names</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
              <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>If it's undefined, still match if the parent is an Observe.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isObserve</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
              <span class="nx">name</span> <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Found a matched reference</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Support functions stored in objects</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">[</span><span class="nx">name</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">lastValue</span><span class="p">[</span><span class="nx">name</span><span class="p">]();</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Add support for observes</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">isObserve</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">lastValue</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Invoke the length to ensure that Observe.List events fire.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">isObserve</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isArrayLike</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Support helper-like functions as anonymous helpers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">ref</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">ref</span><span class="p">];</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Support helpers without arguments, but only if there wasn't a matching data reference.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">getHelper</span><span class="p">(</span><span class="nx">ref</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">ref</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">Mustache</span><span class="p">.</span><span class="nx">_helpers</span> <span class="o">=</span> <span class="p">[</span>

  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;if&#39;</span><span class="p">,</span>
    <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!!</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">inverse</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;unless&#39;</span><span class="p">,</span>
    <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span>
    <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!!</span> <span class="nx">expr</span> <span class="o">&amp;&amp;</span> <span class="nx">expr</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">expr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="nx">expr</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;with&#39;</span><span class="p">,</span>
    <span class="nx">fn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!!</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="nx">expr</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}];</span>

  <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
    <span class="nx">suffix</span><span class="o">:</span> <span class="s2">&quot;mustache&quot;</span><span class="p">,</span>

    <span class="nx">contentType</span><span class="o">:</span> <span class="s2">&quot;x-mustache-template&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>returns a <code>function</code> that renders the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">script</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;can.Mustache(function(_CONTEXT,_VIEW) { &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nx">Mustache</span><span class="p">({</span>
        <span class="nx">text</span><span class="o">:</span> <span class="nx">src</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">id</span>
      <span class="p">}).</span><span class="nx">template</span><span class="p">.</span><span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot; })&quot;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">renderer</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Mustache</span><span class="p">({</span>
        <span class="nx">text</span><span class="o">:</span> <span class="nx">text</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">id</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">})(</span><span class="nx">can</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 