<!DOCTYPE html>  <html> <head>   <title>can.jquery-edge.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="can.dojo-edge.html">                 can.dojo-edge.js               </a>                                           <a class="source" href="can.jquery-edge.html">                 can.jquery-edge.js               </a>                                           <a class="source" href="can.mootools-edge.html">                 can.mootools-edge.js               </a>                                           <a class="source" href="can.yui-edge.html">                 can.yui-edge.js               </a>                                           <a class="source" href="can.zepto-edge.html">                 can.zepto-edge.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               can.jquery-edge.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">){</span>

	<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">can</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">args</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">obj</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">?</span>
				<span class="nx">obj</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">args</span> <span class="p">)</span> <span class="o">:</span>
				<span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">addEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
			<span class="nx">$</span><span class="p">([</span><span class="k">this</span><span class="p">]).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">removeEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
			<span class="nx">$</span><span class="p">([</span><span class="k">this</span><span class="p">]).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">$</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">,</span>
		<span class="nx">prototype</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span>
	<span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>make binding functions</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s1">&#39;bind&#39;</span><span class="p">,</span><span class="s1">&#39;unbind&#39;</span><span class="p">,</span><span class="s1">&#39;undelegate&#39;</span><span class="p">,</span><span class="s1">&#39;delegate&#39;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">func</span><span class="p">){</span>
		<span class="nx">can</span><span class="p">[</span><span class="nx">func</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">func</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="nx">$</span><span class="p">([</span><span class="k">this</span><span class="p">])</span>
			<span class="nx">t</span><span class="p">[</span><span class="nx">func</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">})</span>

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>make modifier based functions</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;append&quot;</span><span class="p">,</span><span class="s2">&quot;filter&quot;</span><span class="p">,</span><span class="s2">&quot;addClass&quot;</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="s2">&quot;get&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">name</span><span class="p">){</span>
		<span class="nx">can</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">wrapped</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
		<span class="p">}</span>
	<span class="p">})</span>

	<span class="kd">var</span> <span class="nx">oldClean</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">cleanData</span><span class="p">;</span>

	<span class="nx">$</span><span class="p">.</span><span class="nx">cleanData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elems</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">elems</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span><span class="s2">&quot;destroyed&quot;</span><span class="p">,[],</span><span class="kc">false</span><span class="p">)</span>
		<span class="p">});</span>
		<span class="nx">oldClean</span><span class="p">(</span><span class="nx">elems</span><span class="p">);</span>
	<span class="p">};</span>

<span class="p">;</span>

	
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Several of the methods in this plugin use code adapated from Prototype
 Prototype JavaScript framework, version 1.6.0.1
 (c) 2005-2007 Sam Stephenson</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">undHash</span><span class="o">=</span> <span class="sr">/_|-/</span><span class="p">,</span>
		<span class="nx">colons</span><span class="o">=</span> <span class="sr">/==/</span><span class="p">,</span>
		<span class="nx">words</span><span class="o">=</span> <span class="sr">/([A-Z]+)([A-Z][a-z])/g</span><span class="p">,</span>
		<span class="nx">lowUp</span><span class="o">=</span> <span class="sr">/([a-z\d])([A-Z])/g</span><span class="p">,</span>
		<span class="nx">dash</span><span class="o">=</span> <span class="sr">/([a-z\d])([A-Z])/g</span><span class="p">,</span>
		<span class="nx">replacer</span><span class="o">=</span> <span class="sr">/\{([^\}]+)\}/g</span><span class="p">,</span>
		<span class="nx">quote</span><span class="o">=</span> <span class="sr">/&quot;/g</span><span class="p">,</span>
		<span class="nx">singleQuote</span><span class="o">=</span> <span class="sr">/&#39;/g</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>gets the nextPart property from current
add - if true and nextPart doesnt exist, create it as an empty object</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">getNext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">nextPart</span><span class="p">,</span> <span class="nx">add</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">nextPart</span> <span class="k">in</span> <span class="nx">current</span> <span class="o">?</span> <span class="nx">current</span><span class="p">[</span><span class="nx">nextPart</span><span class="p">]</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">add</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="nx">nextPart</span><span class="p">]</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>returns true if the object can have properties (no nulls)</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">isContainer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">current</span><span class="p">){</span>
			<span class="k">return</span> <span class="sr">/^f|^o/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="k">typeof</span> <span class="nx">current</span> <span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>a reference</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">getObject</span><span class="p">;</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="p">{</span>
			
			<span class="nx">esc</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">){</span>
				<span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">quote</span><span class="p">,</span> <span class="s1">&#39;&amp;#34;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">singleQuote</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">);</span>
			<span class="p">},</span>
			
			
			<span class="nx">getObject</span> <span class="o">:</span> <span class="nx">getObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">roots</span><span class="p">,</span> <span class="nx">add</span> <span class="p">)</span> <span class="p">{</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>the parts of the name we are looking up
['App','Models','Recipe']</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">?</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="p">[],</span>
					<span class="nx">length</span> <span class="o">=</span>  <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
					<span class="nx">current</span><span class="p">,</span>
					<span class="nx">ret</span><span class="p">,</span> 
					<span class="nx">i</span><span class="p">,</span>
					<span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>make sure roots is an array</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">roots</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">roots</span><span class="p">)</span> <span class="o">?</span> <span class="nx">roots</span> <span class="o">:</span> <span class="p">[</span><span class="nx">roots</span> <span class="o">||</span> <span class="nb">window</span><span class="p">];</span>
				
				<span class="k">if</span><span class="p">(</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
					<span class="k">return</span> <span class="nx">roots</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>for each root, mark it as current</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">while</span><span class="p">(</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">roots</span><span class="p">[</span><span class="nx">r</span><span class="o">++</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>walk current to the 2nd to last object
or until there is not a container</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">isContainer</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">current</span> <span class="o">=</span> <span class="nx">getNext</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">parts</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">add</span><span class="p">);</span>
					<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>if we can get a property from the 2nd to last object</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">if</span><span class="p">(</span> <span class="nx">isContainer</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>get (and possibly set) the property</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">ret</span> <span class="o">=</span> <span class="nx">getNext</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">parts</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">add</span><span class="p">);</span> 
						
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>if there is a value, we exit</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">(</span> <span class="nx">ret</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>if add is false, delete the property</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="k">if</span> <span class="p">(</span> <span class="nx">add</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
								<span class="k">delete</span> <span class="nx">current</span><span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
							<span class="p">}</span>
							<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
							
						<span class="p">}</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">},</span>
			
			<span class="nx">capitalize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">cache</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>used to make newId ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="p">},</span>
			
			
			<span class="nx">underscore</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">s</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">colons</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">words</span><span class="p">,</span> <span class="s1">&#39;$1_$2&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">lowUp</span><span class="p">,</span> <span class="s1">&#39;$1_$2&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">dash</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
			<span class="p">},</span>
			
			<span class="nx">sub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">remove</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">obs</span> <span class="o">=</span> <span class="p">[],</span>
					<span class="nx">remove</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">remove</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span> <span class="o">?</span> <span class="o">!</span><span class="nx">remove</span> <span class="o">:</span> <span class="nx">remove</span><span class="p">;</span>
				<span class="nx">obs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">replacer</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">whole</span><span class="p">,</span> <span class="nx">inside</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>convert inside to type</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="kd">var</span> <span class="nx">ob</span> <span class="o">=</span> <span class="nx">getObject</span><span class="p">(</span><span class="nx">inside</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">remove</span><span class="p">);</span>
					
</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>if a container, push into objs (which will return objects found)</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">if</span><span class="p">(</span> <span class="nx">isContainer</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">){</span>
						<span class="nx">obs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
						<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
					<span class="p">}</span><span class="k">else</span><span class="p">{</span>
						<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">ob</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}));</span>
				
				<span class="k">return</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">obs</span><span class="p">;</span>
			<span class="p">},</span>
			<span class="nx">replacer</span> <span class="o">:</span> <span class="nx">replacer</span><span class="p">,</span>
			<span class="nx">undHash</span> <span class="o">:</span><span class="nx">undHash</span>
		<span class="p">});</span>
<span class="p">;</span>


	
	<span class="kd">var</span> <span class="nx">initializing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	
	<span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">};</span>

	
	<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">,</span> <span class="p">{</span>
		
		<span class="nx">newInstance</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>get a raw instance objet (init is not called)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">(),</span>
				<span class="nx">arg</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
				<span class="nx">args</span><span class="p">;</span>
				
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>call setup if there is a setup</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">setup</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">args</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">inst</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>call init if there is an init, if setup returned args, use those as the arguments</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">init</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">inst</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">inst</span><span class="p">,</span> <span class="nx">args</span> <span class="o">||</span> <span class="nx">arguments</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">inst</span><span class="p">;</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>overwrites an object with methods, sets up _super
  newProps - new properties
  oldProps - where the old properties might be
  addTo - what we are adding to</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">_inherit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">newProps</span><span class="p">,</span> <span class="nx">oldProps</span><span class="p">,</span> <span class="nx">addTo</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">addTo</span> <span class="o">||</span> <span class="nx">newProps</span><span class="p">,</span> <span class="nx">newProps</span> <span class="o">||</span> <span class="p">{})</span>
		<span class="p">},</span>
		
		<span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">fullName</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>set defaults as the merger of the parent defaults and this object's defaults</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,{},</span> <span class="nx">base</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">instance</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>prevent running init</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">initializing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">();</span>
			<span class="nx">initializing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>allow running init</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="nx">inst</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">extend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">fullName</span><span class="p">,</span> <span class="nx">klass</span><span class="p">,</span> <span class="nx">proto</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>figure out what was passed and normalize it</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">fullName</span> <span class="o">!=</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">proto</span> <span class="o">=</span> <span class="nx">klass</span><span class="p">;</span>
				<span class="nx">klass</span> <span class="o">=</span> <span class="nx">fullName</span><span class="p">;</span>
				<span class="nx">fullName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">proto</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">proto</span> <span class="o">=</span> <span class="nx">klass</span><span class="p">;</span>
				<span class="nx">klass</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="nx">proto</span> <span class="o">=</span> <span class="nx">proto</span> <span class="o">||</span> <span class="p">{};</span>
			<span class="kd">var</span> <span class="nx">_super_class</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
				<span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
				<span class="nx">string</span> <span class="o">=</span> <span class="nx">can</span><span class="p">,</span>
				<span class="nx">name</span><span class="p">,</span> <span class="nx">shortName</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">prototype</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Instantiate a base class (but only create the instance,
don't run the init constructor)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">prototype</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">();</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Copy the properties over onto the new prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_inherit</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">_super</span><span class="p">,</span> <span class="nx">prototype</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The dummy class constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">function</span> <span class="nx">Constructor</span><span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>All construction is actually done in the init method</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">initializing</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>we are being called w/o new, we are extending</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nx">Constructor</span> <span class="o">&amp;&amp;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span>
						<span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>we are being called w/ new</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Copy old stuff onto class (can probably be merged w/ inherit)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">for</span> <span class="p">(</span> <span class="nx">name</span> <span class="k">in</span> <span class="k">this</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">Constructor</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>copy new static props on class</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_inherit</span><span class="p">(</span><span class="nx">klass</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">Constructor</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>do namespace stuff</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">fullName</span> <span class="p">)</span> <span class="p">{</span>

				<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">fullName</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
					<span class="nx">shortName</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span>
					<span class="nx">current</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="nb">window</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
					<span class="nx">namespace</span> <span class="o">=</span> <span class="nx">current</span><span class="p">,</span>
					<span class="nx">_fullName</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">fullName</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)),</span>
					<span class="nx">_shortName</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">shortName</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>@steal-remove-start</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span><span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="nx">shortName</span><span class="p">]){</span>
					
				<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>@steal-remove-end</p>             </td>             <td class="code">               <div class="highlight"><pre>
				
				<span class="nx">current</span><span class="p">[</span><span class="nx">shortName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Constructor</span><span class="p">;</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>set things that can't be overwritten</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Constructor</span><span class="p">,</span> <span class="p">{</span>
				<span class="nx">prototype</span><span class="o">:</span> <span class="nx">prototype</span><span class="p">,</span>
				
				<span class="nx">namespace</span><span class="o">:</span> <span class="nx">namespace</span><span class="p">,</span>
				
				<span class="nx">shortName</span><span class="o">:</span> <span class="nx">shortName</span><span class="p">,</span>
				<span class="nx">_shortName</span> <span class="o">:</span> <span class="nx">_shortName</span><span class="p">,</span>
				<span class="nx">_fullName</span><span class="o">:</span> <span class="nx">_fullName</span><span class="p">,</span>
				<span class="nx">constructor</span><span class="o">:</span> <span class="nx">Constructor</span><span class="p">,</span>
				
				<span class="nx">fullName</span><span class="o">:</span> <span class="nx">fullName</span>
			<span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>make sure our prototype looks nice</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">Constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Constructor</span><span class="p">;</span>

			
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>call the class setup</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="nx">_super_class</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)),</span>
				<span class="nx">args</span> <span class="o">=</span> <span class="nx">Constructor</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Constructor</span><span class="p">,</span> <span class="nx">t</span> <span class="p">);</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>call the class init</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">Constructor</span><span class="p">.</span><span class="nx">init</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">Constructor</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Constructor</span><span class="p">,</span> <span class="nx">args</span> <span class="o">||</span> <span class="nx">t</span> <span class="p">);</span>
			<span class="p">}</span>

			
			<span class="k">return</span> <span class="nx">Constructor</span><span class="p">;</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>break up</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Breaks up code</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
		<span class="p">}</span>

	<span class="p">});</span>





<span class="p">;</span>


</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>returns if something is an object with properties of its own</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">canMakeObserve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Date</span><span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>removes all listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">unhookup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">unbind</span><span class="p">){</span>
					<span class="nx">item</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span> <span class="o">+</span> <span class="nx">namespace</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>listens to changes on val and 'bubbles' the event up
- val the object to listen to changes on
- prop the property name val is at on
- parent the parent object of prop</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">hookupBubble</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">parent</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>if it's an array make a list, otherwise a val</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="k">instanceof</span> <span class="nx">Observe</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>we have an observe already
make sure it is not listening to this already</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">unhookup</span><span class="p">([</span><span class="nx">val</span><span class="p">],</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">_namespace</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">val</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observe</span><span class="p">.</span><span class="nx">List</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">val</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observe</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>attr (like target, how you (delegate) to get to the target)
currentAttr (how to get to you)
delegateAttr (hot to get to the delegated Attr)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>listen to all changes and batchTrigger upwards</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">val</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span> <span class="o">+</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">_namespace</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">attr</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>batchTrigger the type on this ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
					<span class="nx">ev</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
					<span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">prop</span> <span class="o">===</span> <span class="s2">&quot;*&quot;</span> <span class="o">?</span> 
						<span class="nx">parent</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span>
						<span class="nx">prop</span> <span class="o">+</span>  <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
			<span class="p">});</span>

			<span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
		<span class="p">},</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>an id to track events for a given observe</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">observeId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>a reference to an array of events that will be dispatched</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">collecting</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>call to start collecting events (Observe sends all events at once)</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">collect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">collecting</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">collecting</span> <span class="o">=</span> <span class="p">[];</span>
				<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>creates an event on item, but will not send immediately 
if collecting events
- item - the item the event should happen on
- event - the event name ("change")
- args - an array of arguments</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">batchTrigger</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">args</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>send no events if initalizing</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_init</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">collecting</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">collecting</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span>
					<span class="nx">item</span><span class="p">,</span>
					<span class="p">{</span>
						<span class="nx">type</span><span class="o">:</span> <span class="nx">event</span><span class="p">,</span>
						<span class="nx">batchNum</span> <span class="o">:</span> <span class="nx">batchNum</span>
					<span class="p">},</span> 
					<span class="nx">args</span> <span class="p">]</span> <span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>which batch of events this is for, might not want to send multiple
messages on the same batch.  This is mostly for 
event delegation</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">batchNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>sends all pending events</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">sendCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">collecting</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
			<span class="nx">collecting</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
			<span class="nx">batchNum</span><span class="o">++</span><span class="p">;</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span>
			<span class="p">})</span>
			
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>a helper used to serialize an Observe or Observe.List where:
observe - the observable
how - to serialize with 'attr' or 'serialize'
where - to put properties, in a {} or [].</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">observe</span><span class="p">,</span> <span class="nx">how</span><span class="p">,</span> <span class="nx">where</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>go through each property</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">observe</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>if the value is an object, and has a attrs or serialize function</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">where</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span> <span class="nx">val</span><span class="p">[</span><span class="nx">how</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span>
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>call attrs or serialize to get the original data back</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">val</span><span class="p">[</span><span class="nx">how</span><span class="p">]()</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>otherwise return the value</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">val</span>
			<span class="p">})</span>
			<span class="k">return</span> <span class="nx">where</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">$method</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">can</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">bind</span> <span class="o">=</span> <span class="nx">$method</span><span class="p">(</span><span class="s1">&#39;addEvent&#39;</span><span class="p">),</span>
		<span class="nx">unbind</span> <span class="o">=</span> <span class="nx">$method</span><span class="p">(</span><span class="s1">&#39;removeEvent&#39;</span><span class="p">),</span>
		<span class="nx">attrParts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">?</span> <span class="nx">attr</span> <span class="o">:</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">attr</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
		<span class="p">};</span>
	
	<span class="kd">var</span> <span class="nx">Observe</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">(</span><span class="s1">&#39;can.Observe&#39;</span><span class="p">,</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>keep so it can be overwritten</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">setup</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
		<span class="p">},</span>
		<span class="nx">bind</span> <span class="o">:</span> <span class="nx">bind</span><span class="p">,</span>
		<span class="nx">unbind</span><span class="o">:</span> <span class="nx">unbind</span><span class="p">,</span>
		<span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;id&quot;</span>
	<span class="p">},</span>
	
	<span class="p">{</span>
		<span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>_data is where we keep the properties</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="p">{};</span>
</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>the namespace this object uses to listen to events</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_namespace</span> <span class="o">=</span> <span class="s2">&quot;.observe&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="o">++</span><span class="nx">observeId</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>sets all attrs</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
			<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">attr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>This is super obfuscated for space -- basically, we're checking
if the type of the attribute is not a number or a string</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!~</span> <span class="s2">&quot;ns&quot;</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">((</span><span class="k">typeof</span> <span class="nx">attr</span><span class="p">).</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span> <span class="p">{</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_attrs</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span><span class="c1">// if we are getting a value</span>
</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>let people know we are reading (</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">Observe</span><span class="p">.</span><span class="nx">__reading</span> <span class="o">&amp;&amp;</span> <span class="nx">Observe</span><span class="p">.</span><span class="nx">__reading</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>otherwise we are setting</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">_set</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">each</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">__get</span><span class="p">()].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)))</span>
		<span class="p">},</span>
		
		<span class="nx">removeAttr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attr</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>convert the attr into parts (if nested)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">attrParts</span><span class="p">(</span><span class="nx">attr</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>the actual property to remove</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">prop</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span>
</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>the current value</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>if we have more parts, call removeAttr on that part</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">current</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>otherwise, delete</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>create the event</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
				<span class="p">}</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">prop</span><span class="p">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">current</span><span class="p">]);</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">current</span><span class="p">);</span>
				<span class="k">return</span> <span class="nx">current</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>reads a property from the object</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">_get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attr</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">attrParts</span><span class="p">(</span><span class="nx">attr</span><span class="p">),</span>
				<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__get</span><span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
			<span class="k">return</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">current</span> <span class="o">?</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="nx">current</span><span class="p">;</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>reads a property directly if an attr is provided, otherwise
returns the 'real' data object itself</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">__get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attr</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">attr</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">;</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>sets attr prop as value on this object where
attr - is a string of properties or an array  of property values
value - the raw value to set
description - an object with converters / attrs / defaults / getterSetters ?</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">_set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>convert attr to attr parts (if it isn't already)</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">attrParts</span><span class="p">(</span><span class="nx">attr</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>the immediate prop we are setting</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">prop</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span>
</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>its current value</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__get</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>if we have an object and remaining parts</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>that object should set it (this might need to call attr)</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">current</span><span class="p">.</span><span class="nx">_set</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>we're in 'real' set territory</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__convert</span><span class="p">){</span>
					<span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__convert</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
				<span class="p">}</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">__set</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span>
				
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">throw</span> <span class="s2">&quot;can.Observe: Object does not exist&quot;</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">__set</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">){</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>otherwise, we are setting it on this object
todo: check if value is object and transform
are we changing the value</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">value</span> <span class="o">!==</span> <span class="nx">current</span> <span class="p">)</span> <span class="p">{</span>

</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>check if we are adding this for the first time
if we are, we need to create an 'add' event</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">changeType</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__get</span><span class="p">().</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;set&quot;</span> <span class="o">:</span> <span class="s2">&quot;add&quot;</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>set the value on data</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">___set</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>if we are getting an object</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">?</span>
</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>hook it up to send event to us</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">hookupBubble</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>value is normal</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">value</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>batchTrigger the change event</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">changeType</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">]);</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>if we can stop listening to our old value, do it</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">unhookup</span><span class="p">([</span><span class="nx">current</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespace</span><span class="p">);</span>
			<span class="p">}</span>

		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>directly sets a property on this object</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">___set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>add property directly for easy writing
check if its on the prototype so we don't overwrite methods like attrs</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">bind</span><span class="o">:</span> <span class="nx">bind</span><span class="p">,</span>
		
		<span class="nx">unbind</span><span class="o">:</span> <span class="nx">unbind</span><span class="p">,</span>
		
		<span class="nx">serialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">serialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;serialize&#39;</span><span class="p">,</span> <span class="p">{});</span>
		<span class="p">},</span>
		
		<span class="nx">_attrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">remove</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">props</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">serialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="p">{})</span>
			<span class="p">}</span>

			<span class="nx">props</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">props</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">prop</span><span class="p">,</span> 
				<span class="nx">collectingStarted</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">(),</span>
				<span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
				<span class="nx">newVal</span><span class="p">;</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">curVal</span><span class="p">){</span>
				<span class="nx">newVal</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>if we are merging ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">newVal</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">remove</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">curVal</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">curVal</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">newVal</span><span class="p">,</span> <span class="nx">remove</span><span class="p">)</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">curVal</span> <span class="o">!=</span> <span class="nx">newVal</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">self</span><span class="p">.</span><span class="nx">_set</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

				<span class="p">}</span>
				<span class="k">delete</span> <span class="nx">props</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
			<span class="p">})</span>
</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>add remaining props</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">newVal</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">_set</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">collectingStarted</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">sendCollection</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Helpers for list</p>             </td>             <td class="code">               <div class="highlight"><pre>
	
	<span class="kd">var</span> <span class="nx">splice</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">splice</span><span class="p">,</span>
		<span class="nx">list</span> <span class="o">=</span> <span class="nx">Observe</span><span class="p">(</span><span class="s1">&#39;can.Observe.List&#39;</span><span class="p">,</span>
	
	<span class="p">{</span>
		<span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">instances</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_namespace</span> <span class="o">=</span> <span class="s2">&quot;.observe&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="o">++</span><span class="nx">observeId</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="nx">can</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_changes</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">instances</span> <span class="o">||</span> <span class="p">[]));</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>if(this.comparator){
this.sort()
}</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">_changes</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">how</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">,</span> <span class="nx">oldVal</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>detects an add, sorts it, re-adds?            </p>             </td>             <td class="code">               <div class="highlight"><pre>
			
</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>if we are sorting, and an attribute inside us changed</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
				
</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>get the index</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">+</span><span class="sr">/^\d+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">attr</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>and item</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>and the new item</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">newIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
				
				<span class="k">if</span><span class="p">(</span><span class="nx">newIndex</span> <span class="o">!==</span> <span class="nx">index</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>move ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">splice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
					<span class="nx">splice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">newIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
					
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">item</span><span class="p">,</span> <span class="nx">newIndex</span><span class="p">,</span> <span class="nx">index</span><span class="p">]);</span>
					<span class="nx">ev</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span>
						<span class="nx">attr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\d+/</span><span class="p">,</span><span class="nx">newIndex</span><span class="p">),</span>
						<span class="nx">how</span><span class="p">,</span>
						<span class="nx">newVal</span><span class="p">,</span>
						<span class="nx">oldVal</span>
					<span class="p">]);</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span><span class="o">*</span><span class="err">/</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>if we add items, we need to handle 
sorting and such</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>batchTrigger direct add and remove events ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!~</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)){</span>
				
				<span class="k">if</span><span class="p">(</span> <span class="nx">how</span> <span class="o">===</span> <span class="s1">&#39;add&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">how</span><span class="p">,</span> <span class="p">[</span><span class="nx">newVal</span><span class="p">,</span><span class="o">+</span><span class="nx">attr</span><span class="p">]);</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s1">&#39;length&#39;</span><span class="p">,[</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">]);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="nx">how</span> <span class="o">===</span> <span class="s1">&#39;remove&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">how</span><span class="p">,</span> <span class="p">[</span><span class="nx">oldVal</span><span class="p">,</span> <span class="o">+</span><span class="nx">attr</span><span class="p">]);</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s1">&#39;length&#39;</span><span class="p">,[</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">]);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">how</span><span class="p">,[</span><span class="nx">newVal</span><span class="p">,</span> <span class="o">+</span><span class="nx">attr</span><span class="p">])</span>
				<span class="p">}</span>
				
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>issue add, remove, and move events ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="p">},</span>
		
		   <span class="nx">sortedIndex</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">itemCompare</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="p">),</span>
				<span class="nx">equaled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
				<span class="nx">i</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">item</span> <span class="o">===</span> <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
					<span class="nx">equaled</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">itemCompare</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">attr</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">i</span><span class="o">+</span><span class="nx">equaled</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">i</span><span class="o">+</span><span class="nx">equaled</span><span class="p">;</span>
		<span class="p">},</span><span class="o">*</span><span class="err">/</span>
		<span class="nx">__get</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">attr</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">___set</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
			<span class="k">this</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">serialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">serialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;serialize&#39;</span><span class="p">,</span> <span class="p">[]);</span>
		<span class="p">},</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>placeholder for each</p>             </td>             <td class="code">               <div class="highlight"><pre>
		
		<span class="nx">splice</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">howMany</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
				<span class="nx">i</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hookupBubble</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">howMany</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">howMany</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">index</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">removed</span> <span class="o">=</span> <span class="nx">splice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">howMany</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">index</span><span class="p">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">removed</span><span class="p">]);</span>
				<span class="nx">unhookup</span><span class="p">(</span><span class="nx">removed</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespace</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">index</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nx">removed</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">removed</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">_attrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">remove</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">props</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">serialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="p">[]);</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>copy</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">props</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
				<span class="nx">collectingStarted</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">(),</span>
				<span class="nx">prop</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">prop</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">prop</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">curVal</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">],</span>
					<span class="nx">newVal</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

				<span class="k">if</span> <span class="p">(</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">curVal</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">curVal</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">newVal</span><span class="p">,</span> <span class="nx">remove</span><span class="p">)</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">curVal</span> <span class="o">!=</span> <span class="nx">newVal</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">_set</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>add in the remaining props</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">remove</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>remove those props didn't get too</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">collectingStarted</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">sendCollection</span><span class="p">()</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}),</span>


</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>create push, pop, shift, and unshift
converts to an array of arguments </p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">getArgs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">args</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">?</span>
				<span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
		<span class="p">};</span>
</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>describes the method and where items should be added</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span>
		
		<span class="nx">push</span><span class="o">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
		
		<span class="nx">unshift</span><span class="o">:</span> <span class="mi">0</span>
	<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>adds a method where
- name - method name
- where - where items in the array should be added</p>             </td>             <td class="code">               <div class="highlight"><pre>


	<span class="kd">function</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">where</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">list</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>get the items being added</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>where we are going to add items</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">len</span> <span class="o">=</span> <span class="nx">where</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>go through and convert anything to an observe that needs to be converted</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">canMakeObserve</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hookupBubble</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">}</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>if we have a sort item, add that</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">comparator</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>add each item ...
we could make this check if we are already adding in order
but that would be confusing ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="p">}</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>call the original method</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[][</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>cause the change where the args are:
len - where the additions happened
add - items added
args - the items added
undefined - the old value</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">comparator</span>  <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">args</span><span class="p">])</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">len</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">])</span>
			<span class="p">}</span>
			

			<span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>

	<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span>
		
		<span class="nx">pop</span><span class="o">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
		
		<span class="nx">shift</span><span class="o">:</span> <span class="mi">0</span>
	<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>creates a 'remove' type method</p>             </td>             <td class="code">               <div class="highlight"><pre>


	<span class="kd">function</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">where</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">list</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			
			<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
				<span class="nx">len</span> <span class="o">=</span> <span class="nx">where</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>


			<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[][</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>

</pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>create a change where the args are
"*" - change on potentially multiple properties
"remove" - items removed
undefined - the new values (there are none)
res - the old, removed values (should these be unbound)
len - where these items were removed</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">batchTrigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">len</span><span class="p">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="p">[</span><span class="nx">res</span><span class="p">]])</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">res</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">unbind</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespace</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
	<span class="nx">list</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span>
	
	<span class="nx">indexOf</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">indexOf</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
		<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
	<span class="p">};</span>
<span class="p">;</span>

	
	
	<span class="kd">var</span>	<span class="nx">pipe</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">func</span><span class="p">){</span>
		<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
		<span class="nx">def</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
			<span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">model</span><span class="p">[</span><span class="nx">func</span><span class="p">](</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
		<span class="p">},</span><span class="kd">function</span><span class="p">(){</span>
			<span class="nx">d</span><span class="p">.</span><span class="nx">resolveWith</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)</span>
		<span class="p">})</span>
		<span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
	<span class="p">},</span>
		<span class="nx">modelNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="nx">ignoreHookup</span> <span class="o">=</span> <span class="sr">/change.observe\d+/</span><span class="p">,</span>
		<span class="nx">getId</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">inst</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">inst</span><span class="p">[</span><span class="nx">inst</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
		<span class="p">},</span>
		<span class="nx">ajax</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ajaxOb</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">dataType</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>

			
</pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>if we get a string, handle it</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">ajaxOb</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>if there's a space, it's probably the type</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="nx">ajaxOb</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">url</span> <span class="o">:</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
				<span class="p">};</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
					<span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>if we are a non-array object, copy to a new attrs</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">data</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">?</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">data</span><span class="p">)</span> <span class="o">:</span> <span class="nx">data</span><span class="p">;</span>
	

</pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>get the url with any templated values filled out</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">ajaxOb</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
				<span class="nx">type</span><span class="o">:</span> <span class="nx">type</span> <span class="o">||</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
				<span class="nx">dataType</span><span class="o">:</span> <span class="nx">dataType</span> <span class="o">||</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
				<span class="nx">success</span> <span class="o">:</span> <span class="nx">success</span><span class="p">,</span>
				<span class="nx">error</span><span class="o">:</span> <span class="nx">error</span>
			<span class="p">},</span><span class="nx">ajaxOb</span><span class="p">));</span>
		<span class="p">},</span>
		<span class="nx">makeRequest</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">method</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">deferred</span> <span class="p">,</span>
				<span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">self</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()],</span>
</pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>the Model</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">model</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span>
				<span class="nx">jqXHR</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>destroy does not need data</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;destroy&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>update and destroy need the id</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;create&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">getId</span><span class="p">(</span><span class="nx">self</span><span class="p">))</span>
			<span class="p">}</span>
			
			<span class="nx">jqXHR</span> <span class="o">=</span> <span class="nx">model</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
			
			<span class="nx">deferred</span> <span class="o">=</span> <span class="nx">jqXHR</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
				<span class="nx">self</span><span class="p">[</span><span class="nx">method</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;d&quot;</span><span class="p">](</span><span class="nx">data</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">);</span>
				<span class="k">return</span> <span class="nx">self</span>
			<span class="p">})</span>
</pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>promise = deferred.promise();
hook up abort</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">.</span><span class="nx">abort</span><span class="p">){</span>
				<span class="nx">deferred</span><span class="p">.</span><span class="nx">abort</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
					<span class="nx">jqXHR</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">}</span>
			
			<span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
		<span class="p">},</span>
	
	
	
</pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>this object describes how to make an ajax request for each ajax method
the available properties are
url - the default url to use as indicated as a property on the model
type - the default http request type
data - a method that takes the arguments and returns data used for ajax
292 bytes</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">ajaxMethods</span> <span class="o">=</span> <span class="p">{</span>
		
		<span class="nx">create</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;_shortName&quot;</span><span class="p">,</span>
			<span class="nx">type</span> <span class="o">:</span><span class="s2">&quot;post&quot;</span>
		<span class="p">},</span>
		
		<span class="nx">update</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">data</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">){</span>
				<span class="nx">attrs</span> <span class="o">=</span> <span class="nx">attrs</span> <span class="o">||</span> <span class="p">{};</span>
				<span class="kd">var</span> <span class="nx">identity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">identity</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">identity</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">attrs</span><span class="p">[</span><span class="s2">&quot;new&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">id</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">identity</span><span class="p">];</span>
					<span class="k">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">identity</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="nx">attrs</span><span class="p">[</span><span class="nx">identity</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
				<span class="k">return</span> <span class="nx">attrs</span><span class="p">;</span>
			<span class="p">},</span>
			<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;put&quot;</span>
		<span class="p">},</span>
		
		<span class="nx">destroy</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
			<span class="nx">data</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
				<span class="k">return</span> <span class="p">{}[</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">findAll</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;_shortName&quot;</span>
		<span class="p">},</span>
		
		<span class="nx">findOne</span><span class="o">:</span> <span class="p">{}</span>
	<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>makes an ajax request function from a string
ajaxMethod - the ajaxMethod object defined above
str - the string the user provided. ex: findAll: "/recipes.json"</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">ajaxMaker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ajaxMethod</span><span class="p">,</span> <span class="nx">str</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>return a function that serves as the ajax method</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>if the ajax method has it's own way of getting data, use that</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">data</span> <span class="o">=</span> <span class="nx">ajaxMethod</span><span class="p">.</span><span class="nx">data</span> <span class="o">?</span> 
					<span class="nx">ajaxMethod</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>otherwise use the data passed in</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">data</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>return the ajax method with data and the type provided</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">ajax</span><span class="p">(</span><span class="nx">str</span> <span class="o">||</span> <span class="k">this</span><span class="p">[</span><span class="nx">ajaxMethod</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="s2">&quot;_url&quot;</span><span class="p">],</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">ajaxMethod</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="s2">&quot;get&quot;</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}</span>


	
	
	<span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">(</span><span class="s2">&quot;can.Model&quot;</span><span class="p">,{</span>
		<span class="nx">setup</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Model</span><span class="p">){</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
			
			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ajaxMethods</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">method</span><span class="p">){</span>
				<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span> <span class="nx">self</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">))</span> <span class="p">{</span>
					<span class="nx">self</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ajaxMaker</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">self</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">});</span>
			<span class="kd">var</span> <span class="nx">clean</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_clean</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span><span class="nx">findAll</span> <span class="o">:</span> <span class="s2">&quot;models&quot;</span><span class="p">,</span> <span class="nx">findOne</span><span class="o">:</span> <span class="s2">&quot;model&quot;</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">method</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">self</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
				<span class="nx">self</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>increment requests</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">self</span><span class="p">.</span><span class="nx">_reqs</span><span class="o">++</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>make the request</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">return</span> <span class="nx">pipe</span><span class="p">(</span> <span class="nx">old</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span><span class="nx">params</span><span class="p">),</span>
						<span class="nx">self</span><span class="p">,</span> 
						<span class="nx">method</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">clean</span><span class="p">,</span> <span class="nx">clean</span><span class="p">);</span>
				<span class="p">}</span>
				
			<span class="p">})</span>
</pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>convert findAll and findOne</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">oldFindAll</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">fullName</span> <span class="o">==</span> <span class="s2">&quot;can.Model&quot;</span><span class="p">){</span>
				<span class="nx">self</span><span class="p">.</span><span class="nx">fullName</span> <span class="o">=</span> <span class="s2">&quot;Model&quot;</span><span class="o">+</span><span class="p">(</span><span class="o">++</span><span class="nx">modelNum</span><span class="p">);</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>add ajax converters</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_reqs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shortName</span><span class="o">+</span><span class="s2">&quot;/{&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;}&quot;</span>
		<span class="p">},</span>
		<span class="nx">_clean</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_reqs</span><span class="o">--</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_reqs</span><span class="p">){</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">id</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">_bindings</span><span class="p">){</span>
						<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">models</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">instancesRawData</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">instancesRawData</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>get the list type</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
				<span class="nx">res</span> <span class="o">=</span> <span class="k">new</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">List</span> <span class="o">||</span> <span class="nx">ML</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>did we get an array</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">arr</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">instancesRawData</span><span class="p">),</span>
				
</pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>did we get a model list?</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">ml</span> <span class="o">=</span> <span class="p">(</span><span class="nx">instancesRawData</span> <span class="k">instanceof</span> <span class="nx">ML</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>get the raw array of objects</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">raw</span> <span class="o">=</span> <span class="nx">arr</span> <span class="o">?</span>
</pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>if an array, return the array</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">instancesRawData</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>otherwise if a model list</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="p">(</span><span class="nx">ml</span> <span class="o">?</span>
</pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>get the raw objects from the list</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">instancesRawData</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span> <span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>get the object's data</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">instancesRawData</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
				<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			

			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">raw</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">rawPart</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span> <span class="nx">rawPart</span> <span class="p">));</span>
			<span class="p">});</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">arr</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">//push other stuff onto array</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">instancesRawData</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">prop</span> <span class="o">!==</span> <span class="s1">&#39;data&#39;</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">res</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">})</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attributes</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attributes</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">attributes</span> <span class="k">instanceof</span> <span class="k">this</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">attributes</span> <span class="o">=</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="k">this</span><span class="p">(</span> <span class="nx">attributes</span> <span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_reqs</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">model</span><span class="p">;</span>
		<span class="p">}</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>inherited with can.Observe</p>             </td>             <td class="code">               <div class="highlight"><pre>
		
</pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>inherited with can.Observe</p>             </td>             <td class="code">               <div class="highlight"><pre>
		
</pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>inherited from can.Observe</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="p">},</span>
	
	<span class="p">{</span>
		
		<span class="nx">isNew</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">getId</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>id || id === 0?</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">id</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//if null or undefined</span>
		<span class="p">},</span>
		
		<span class="nx">save</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">makeRequest</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;create&#39;</span> <span class="o">:</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">makeRequest</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="s1">&#39;destroyed&#39;</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">bind</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventName</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ignoreHookup</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">eventName</span><span class="p">))</span> <span class="p">{</span> 
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">){</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">getId</span><span class="p">(</span><span class="k">this</span><span class="p">)]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">unbind</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventName</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ignoreHookup</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">eventName</span><span class="p">))</span> <span class="p">{</span> 
				<span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="o">--</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">){</span>
					<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">getId</span><span class="p">(</span><span class="k">this</span><span class="p">)];</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unbind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>change ID</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">___set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">___set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
</pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>if we add an id, move it to the store</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span><span class="nx">prop</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">getId</span><span class="p">(</span><span class="k">this</span><span class="p">)]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
		<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span>
	
	<span class="s2">&quot;created&quot;</span><span class="p">,</span>
	
	<span class="s2">&quot;updated&quot;</span><span class="p">,</span>
	
	<span class="s2">&quot;destroyed&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">funcName</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attrs</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">stub</span><span class="p">,</span> 
				<span class="nx">constructor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>update attributes if attributes have been passed</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">stub</span> <span class="o">=</span> <span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">attrs</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">attr</span> <span class="o">?</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span> <span class="o">:</span> <span class="nx">attrs</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>call event on the instance</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">funcName</span><span class="p">);</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="nx">funcName</span><span class="p">)</span>
			

</pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>call event on the instance's Class</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">constructor</span><span class="p">,</span><span class="nx">funcName</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
		<span class="p">};</span>
	<span class="p">});</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>model lists are just like Observe.List except that when their items is destroyed, it automatically
gets removed from the list</p>             </td>             <td class="code">               <div class="highlight"><pre>
	
	<span class="kd">var</span> <span class="nx">ML</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">List</span><span class="p">(</span><span class="s1">&#39;can.Model.List&#39;</span><span class="p">,{</span>
		<span class="nx">setup</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">List</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>send destroy events</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">how</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="sr">/\w+\.destroyed/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">how</span><span class="p">)){</span>
					<span class="nx">self</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">target</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">})</span>
		<span class="p">}</span>
	<span class="p">})</span>
	
<span class="p">;</span>

	
	<span class="kd">var</span> <span class="nx">digitTest</span> <span class="o">=</span> <span class="sr">/^\d+$/</span><span class="p">,</span>
		<span class="nx">keyBreaker</span> <span class="o">=</span> <span class="sr">/([^\[\]]+)|(\[\])/g</span><span class="p">,</span>
		<span class="nx">paramTest</span> <span class="o">=</span> <span class="sr">/([^?#]*)(#.*)?$/</span><span class="p">,</span>
		<span class="nx">prep</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">str</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nb">decodeURIComponent</span><span class="p">(</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="p">);</span>
		<span class="p">}</span>
	
	
	<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="p">{</span> 
		
		
		<span class="nx">deparam</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">){</span>
		
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{},</span>
				<span class="nx">pairs</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">params</span> <span class="o">&amp;&amp;</span> <span class="nx">paramTest</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">params</span> <span class="p">))</span> <span class="p">{</span>
				
				<span class="nx">pairs</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">),</span>
				
				<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">pairs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">pair</span> <span class="p">)</span> <span class="p">{</span>

					<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">),</span>
						<span class="nx">key</span>   <span class="o">=</span> <span class="nx">prep</span><span class="p">(</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="p">),</span>
						<span class="nx">value</span> <span class="o">=</span> <span class="nx">prep</span><span class="p">(</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="p">);</span>

					<span class="nx">current</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
					<span class="nx">parts</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">keyBreaker</span><span class="p">);</span>
			
					<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">current</span><span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>if what we are pointing to looks like an array</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="nx">current</span><span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">digitTest</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="nx">parts</span><span class="p">[</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[]&quot;</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="p">{}</span>
						<span class="p">}</span>
						<span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
					<span class="p">}</span>
					<span class="nx">lastPart</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">lastPart</span> <span class="o">==</span> <span class="s2">&quot;[]&quot;</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">current</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
					<span class="p">}</span><span class="k">else</span><span class="p">{</span>
						<span class="nx">current</span><span class="p">[</span><span class="nx">lastPart</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
<span class="p">;</span>


</pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>Helper methods used for matching routes.</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> 
</pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>RegEx used to match route variables of the type ':name'.
Any word character or a period is matched.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">matcher</span> <span class="o">=</span> <span class="sr">/\:([\w\.]+)/g</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>Regular expression for identifying &amp;key=value lists.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">paramsMatcher</span> <span class="o">=</span> <span class="sr">/^(?:&amp;[^=]+=[^&amp;]*)+/</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>Converts a JS Object into a list of parameters that can be 
inserted into an html element tag.</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">makeProps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;className&#39;</span> <span class="o">?</span> <span class="s1">&#39;class&#39;</span>  <span class="o">:</span> <span class="nx">name</span> <span class="p">)</span><span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">esc</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
			<span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Checks if a route matches the data provided. If any route variable
is not present in the data the route does not match. If all route
variables are present in the data the number of matches is returned 
to allow discerning between general and more specific routes. </p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">matchesData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="nx">count</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">onready</span> <span class="o">=</span> <span class="o">!</span><span class="mi">0</span><span class="p">,</span>
		<span class="nx">location</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
		<span class="nx">each</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
		<span class="nx">extend</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">;</span>

	
	<span class="nx">can</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">defaults</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Extract the variable names and replace with regEx that will match an atual URL with values.</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="p">[],</span>
			<span class="nx">test</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">whole</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">names</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
</pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>TODO: I think this should have a +</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="s2">&quot;([^\\/\\&amp;]*)&quot;</span>  <span class="c1">// The &#39;\\&#39; is for string-escaping giving single &#39;\&#39; for regEx escaping</span>
			<span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Add route in a form that can be easily figured out</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>A regular expression that will match the route when variable values 
are present; i.e. for :page/:type the regEx is /([\w.]<em>)/([\w.]</em>)/ which
will match for any value of :page and :type (word chars or period).</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">test</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">test</span><span class="o">+</span><span class="s2">&quot;($|&amp;)&quot;</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>The original URL, same as the index for this entry in routes.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">route</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>An array of all the variable names in this route</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">names</span><span class="o">:</span> <span class="nx">names</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>Default values provided for the variables.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">defaults</span><span class="o">:</span> <span class="nx">defaults</span> <span class="o">||</span> <span class="p">{},</span>
</pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>The number of parts in the URL separated by '/'.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">length</span><span class="o">:</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">length</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">,</span> <span class="p">{</span>
		
		<span class="nx">param</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>Check if the provided data keys match the names in any routes;
get the one with the most matches.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">route</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>need it to be at least 1 match</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">matches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
				<span class="nx">matchCount</span><span class="p">,</span>
				<span class="nx">routeName</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>if we have a route name in our can.route data, use it</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="p">(</span> <span class="nx">routeName</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">route</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">routeName</span><span class="p">]))){</span>
</pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>otherwise find route</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">each</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">temp</span><span class="p">){</span>
					<span class="nx">matchCount</span> <span class="o">=</span> <span class="nx">matchesData</span><span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">matchCount</span> <span class="o">&gt;</span> <span class="nx">matches</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">route</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
						<span class="nx">matches</span> <span class="o">=</span> <span class="nx">matchCount</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>if this is match</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">route</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">cpy</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">data</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>Create the url by replacing the var names with the provided data.
If the default value is found an empty string is inserted.</p>             </td>             <td class="code">               <div class="highlight"><pre>
				    <span class="nx">res</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">whole</span><span class="p">,</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="k">delete</span> <span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                        <span class="k">return</span> <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nb">encodeURIComponent</span><span class="p">(</span> <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">);</span>
                    <span class="p">}),</span>
                    <span class="nx">after</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>remove matching default values</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">each</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span>
						<span class="k">if</span><span class="p">(</span><span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
							<span class="k">delete</span> <span class="nx">cpy</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
						<span class="p">}</span>
					<span class="p">})</span>
					
</pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>The remaining elements of data are added as 
$amp; separated parameters to the url.</p>             </td>             <td class="code">               <div class="highlight"><pre>
				    <span class="nx">after</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">cpy</span><span class="p">);</span>
				<span class="k">return</span> <span class="nx">res</span> <span class="o">+</span> <span class="p">(</span><span class="nx">after</span> <span class="o">?</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">+</span> <span class="nx">after</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>If no route was found there is no hash URL, only paramters.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">deparam</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>See if the url matches any routes by testing it against the route.test regEx.
By comparing the URL length the most specialized route that matches is used.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">route</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">length</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span>
			<span class="p">};</span>
			<span class="nx">each</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">routes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">temp</span><span class="p">){</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">route</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>If a route was matched</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">route</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">{</span> 
				<span class="kd">var</span> <span class="c1">// Since RegEx backreferences are used in route.test (round brackets)</span>
</pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>the parts will contain the full matched string and each variable (backreferenced) value.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">parts</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">test</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>start will contain the full matched string; parts contain the variable values.</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">start</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span>
</pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>The remainder will be the &amp;key=value list at the end of the URL.</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">remainder</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>If there is a remainder and it contains a &amp;key=value list deparam it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">obj</span> <span class="o">=</span> <span class="p">(</span><span class="nx">remainder</span> <span class="o">&amp;&amp;</span> <span class="nx">paramsMatcher</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">remainder</span><span class="p">))</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span> <span class="nx">remainder</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">:</span> <span class="p">{};</span>

</pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>Add the default values for this route</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">obj</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">route</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>Overwrite each of the default values in obj with those in parts if that part is not empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">each</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">part</span><span class="p">){</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">part</span> <span class="o">&amp;&amp;</span> <span class="nx">part</span> <span class="o">!==</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">obj</span><span class="p">[</span><span class="nx">route</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span> <span class="nx">part</span> <span class="p">);</span>
					<span class="p">}</span>
				<span class="p">});</span>
				<span class="nx">obj</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
				<span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>If no route was matched it is parsed as a &amp;key=value list.</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;&amp;&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">paramsMatcher</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">:</span> <span class="p">{};</span>
		<span class="p">},</span>
		
		<span class="nx">data</span><span class="o">:</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">({}),</span>
        
		<span class="nx">routes</span><span class="o">:</span> <span class="p">{},</span>
		
		<span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span> <span class="nx">val</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">onready</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span><span class="p">(</span> <span class="nx">val</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">onready</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">setState</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">merge</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">options</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">curParams</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
		<span class="p">},</span>
		
		<span class="nx">link</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">merge</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s2">&quot;&lt;a &quot;</span> <span class="o">+</span> <span class="nx">makeProps</span><span class="p">(</span>
			<span class="nx">extend</span><span class="p">({</span>
				<span class="nx">href</span><span class="o">:</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">merge</span><span class="p">)</span>
			<span class="p">},</span> <span class="nx">props</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">current</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">==</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
	
</pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>The functions in the following list applied to can.route (e.g. can.route.attr('...')) will
instead act on the can.route.data Observe.</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">each</span><span class="p">([</span><span class="s1">&#39;bind&#39;</span><span class="p">,</span><span class="s1">&#39;unbind&#39;</span><span class="p">,</span><span class="s1">&#39;delegate&#39;</span><span class="p">,</span><span class="s1">&#39;undelegate&#39;</span><span class="p">,</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span><span class="s1">&#39;removeAttr&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">){</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">})</span>

	<span class="kd">var</span> <span class="c1">// A ~~throttled~~ debounced function called multiple times will only fire once the</span>
</pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>timer runs down. Each call resets the timer. (throttled functions
are called once every x seconds)</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">timer</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>Intermediate storage for can.route.data.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">curParams</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>Deparameterizes the portion of the hash of interest and assign the
values to the can.route.data removing existing values no longer in the hash.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">setState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">curParams</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/#!?/</span><span class="p">).</span><span class="nx">pop</span><span class="p">()</span> <span class="p">);</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">curParams</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>If the hash changes, update the can.route.data</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span><span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="nx">setState</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>If the can.route.data changes, update the hash.
Using .serialize() retrieves the raw data contained in the observable.
This function is ~~throttled~~ debounced so it only updates once even if multiple values changed.</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">clearTimeout</span><span class="p">(</span> <span class="nx">timer</span> <span class="p">);</span>
		<span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s2">&quot;#!&quot;</span> <span class="o">+</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">serialize</span><span class="p">())</span>
		<span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>onready event ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="s2">&quot;ready&quot;</span><span class="p">,</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">ready</span><span class="p">);</span>
<span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>------- HELPER FUNCTIONS  ------</p>             </td>             <td class="code">               <div class="highlight"><pre>
	
</pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>Binds an element, returns a function that unbinds</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">)</span>
</pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>var binder = el.bind &amp;&amp; el.unbind ? el : $(isFunction(el) ? [el] : el);</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>binder.bind(ev, callback);
if ev name has >, change the name and bind
in the wrapped callback, check that the element matches the actual element</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">unbind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">};</span>
	<span class="p">},</span>
		<span class="nx">isFunction</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">,</span>
		<span class="nx">extend</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">,</span>
		<span class="nx">each</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
		<span class="nx">slice</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">,</span>
		<span class="nx">special</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="s2">&quot;$.event.special&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">{},</span>

</pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>Binds an element, returns a function that unbinds</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">delegate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>var binder = el.delegate &amp;&amp; el.undelegate ? el : $(isFunction(el) ? [el] : el)
binder.delegate(selector, ev, callback);</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">undelegate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
			<span class="p">};</span>
		<span class="p">},</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>calls bind or unbind depending if there is a selector</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">binder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">selector</span> <span class="o">?</span>
				<span class="nx">delegate</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">selector</span> <span class="p">),</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">)</span> <span class="o">:</span> 
				<span class="nx">bind</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">);</span>
		<span class="p">},</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>moves 'this' to the first argument, wraps it with jQuery if it's an element</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">shifter</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">shifter</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">?</span> <span class="nx">context</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">:</span> <span class="nx">name</span><span class="p">;</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">context</span><span class="p">.</span><span class="nx">called</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    			<span class="k">return</span> <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)));</span>
			<span class="p">};</span>
		<span class="p">},</span>
		<span class="nx">basicProcessor</span><span class="p">;</span>
	
	
	<span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">(</span><span class="s2">&quot;can.Control&quot;</span><span class="p">,</span>
	
	<span class="p">{</span>
		
		<span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

</pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>Allow contollers to inherit "defaults" from superclasses as it done in can.Construct</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">Construct</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>if you didn't provide a name, or are control, don't do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">this</span> <span class="o">!==</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Control</span> <span class="p">)</span> <span class="p">{</span>

</pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>cache the underscored names</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
					<span class="nx">funcName</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>calculate and cache actions</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">control</span><span class="p">.</span><span class="nx">actions</span> <span class="o">=</span> <span class="p">{};</span>

				<span class="k">for</span> <span class="p">(</span> <span class="nx">funcName</span> <span class="k">in</span> <span class="nx">control</span><span class="p">.</span><span class="nx">prototype</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">funcName</span> <span class="o">==</span> <span class="s1">&#39;constructor&#39;</span> <span class="o">||</span> <span class="o">!</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">control</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">funcName</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">continue</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">control</span><span class="p">.</span><span class="nx">_isAction</span><span class="p">(</span><span class="nx">funcName</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">control</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">control</span><span class="p">.</span><span class="nx">_action</span><span class="p">(</span><span class="nx">funcName</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">_isAction</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">methodName</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>RegExp literals don't carry a last index property so this is
safe</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="nx">special</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span> <span class="o">||</span> <span class="nx">processors</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span> <span class="o">||</span> <span class="sr">/[^\w]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">methodName</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>reset the test index</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
</pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>if we don't have options (a control instance), we'll run this later
Parameter replacer regex</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">options</span> <span class="o">||</span> <span class="o">!</span> <span class="sr">/\{([^\}]+)\}/g</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">methodName</span> <span class="p">))</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>If we have options, run sub to replace templates "{}" with a value from the options
or the window</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">convertedName</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">methodName</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">,</span> <span class="nb">window</span><span class="p">])</span> <span class="o">:</span> <span class="nx">methodName</span><span class="p">,</span>
					
</pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>If a "{}" resolves to an object, convertedName will be an array</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">arr</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">convertedName</span><span class="p">),</span>
					
</pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>get the parts of the function = [convertedName, delegatePart, eventPart]
Breaker regex</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">parts</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arr</span> <span class="o">?</span> <span class="nx">convertedName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">convertedName</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(?:(.*?)\s)?([\w\.\:&gt;]+)$/</span><span class="p">),</span>
					<span class="nx">event</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
					<span class="nx">processor</span> <span class="o">=</span> <span class="nx">processors</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">||</span> <span class="nx">basicProcessor</span><span class="p">;</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="nx">processor</span><span class="o">:</span> <span class="nx">processor</span><span class="p">,</span>
					<span class="nx">parts</span><span class="o">:</span> <span class="nx">parts</span><span class="p">,</span>
					<span class="nx">delegate</span> <span class="o">:</span> <span class="nx">arr</span> <span class="o">?</span> <span class="nx">convertedName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="kc">undefined</span>
				<span class="p">};</span>
			<span class="p">}</span>
		<span class="p">},</span>
		
		<span class="nx">processors</span><span class="o">:</span> <span class="p">{},</span>
		
		<span class="nx">defaults</span><span class="o">:</span> <span class="p">{}</span>
	<span class="p">},</span>
	
	<span class="p">{</span>
		
		<span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">cls</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span>
				<span class="nx">pluginname</span> <span class="o">=</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">pluginName</span> <span class="o">||</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">_fullName</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>want the raw element here</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>

			<span class="k">if</span><span class="p">(</span> <span class="nx">pluginname</span> <span class="o">&amp;&amp;</span> <span class="nx">pluginname</span> <span class="o">!==</span> <span class="s1">&#39;can_control&#39;</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>set element and className on element</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">pluginname</span><span class="p">);</span>
			<span class="p">}</span>
			
			<span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span><span class="s2">&quot;controls&quot;</span><span class="p">))</span> <span class="o">||</span> <span class="nx">can</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="k">this</span> <span class="p">]);</span>
			
			
			<span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>bind all event handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">();</span>

			
			<span class="k">return</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">];</span>
		<span class="p">},</span>
		
		<span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">func</span> <span class="p">)</span> <span class="p">{</span>
			
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">el</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>adds bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">off</span><span class="p">();</span>
</pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>go through the cached list of actions and use the processor to bind</p>             </td>             <td class="code">               <div class="highlight"><pre>
				
				<span class="kd">var</span> <span class="nx">cls</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span>
					<span class="nx">bindings</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">,</span>
					<span class="nx">actions</span> <span class="o">=</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">actions</span><span class="p">,</span>
					<span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span>
					<span class="nx">destroyCB</span> <span class="o">=</span> <span class="nx">shifter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;destroy&quot;</span><span class="p">);</span>
					
				<span class="k">for</span> <span class="p">(</span> <span class="nx">funcName</span> <span class="k">in</span> <span class="nx">actions</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">actions</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="nx">funcName</span> <span class="p">))</span> <span class="p">{</span>
						<span class="nx">ready</span> <span class="o">=</span> <span class="nx">actions</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">_action</span><span class="p">(</span><span class="nx">funcName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
						<span class="nx">bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
							<span class="nx">ready</span><span class="p">.</span><span class="nx">processor</span><span class="p">(</span><span class="nx">ready</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">||</span> <span class="nx">element</span><span class="p">,</span> 
							                <span class="nx">ready</span><span class="p">.</span><span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
											<span class="nx">ready</span><span class="p">.</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
											<span class="nx">funcName</span><span class="p">,</span> 
											<span class="k">this</span><span class="p">));</span>
					<span class="p">}</span>
				<span class="p">}</span>
	
	
</pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>setup to be destroyed ... don't bind b/c we don't want to remove it</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="s2">&quot;destroyed&quot;</span><span class="p">,</span> <span class="nx">destroyCB</span><span class="p">);</span>
				<span class="nx">bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">el</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">can</span><span class="p">.</span><span class="nx">unbind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="s2">&quot;destroyed&quot;</span><span class="p">,</span> <span class="nx">destroyCB</span><span class="p">);</span>
				<span class="p">});</span>
				<span class="k">return</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">el</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">func</span> <span class="o">=</span> <span class="nx">eventName</span><span class="p">;</span>
				<span class="nx">eventName</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">;</span>
				<span class="nx">selector</span> <span class="o">=</span> <span class="nx">el</span><span class="p">;</span>
				<span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">func</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">func</span> <span class="o">=</span> <span class="nx">shifter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">func</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">binder</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">));</span>

			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">off</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span> <span class="o">||</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">value</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
			<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>adds bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">_bindings</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="p">},</span>
		
		<span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">Class</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span>
				<span class="nx">pluginName</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">pluginName</span> <span class="o">||</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">_fullName</span><span class="p">,</span>
				<span class="nx">controls</span><span class="p">;</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>unbind bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">this</span><span class="p">.</span><span class="nx">off</span><span class="p">();</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nx">pluginName</span> <span class="o">&amp;&amp;</span> <span class="nx">pluginName</span> <span class="o">!==</span> <span class="s1">&#39;can_control&#39;</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>remove the className</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">pluginName</span><span class="p">);</span>
			<span class="p">}</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>remove from data</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">controls</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span><span class="s2">&quot;controls&quot;</span><span class="p">);</span>
			<span class="nx">controls</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">controls</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
			
			<span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;destroyed&quot;</span><span class="p">);</span> <span class="c1">//in case we want to know if the control is removed</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>

	<span class="kd">var</span> <span class="nx">processors</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">processors</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <p>------------- PROCESSSORS -----------------------------
processors do the binding.  They return a function that
unbinds when called.
the basic processor that binds events</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">basicProcessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">control</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">binder</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">shifter</span><span class="p">(</span><span class="nx">control</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">),</span> <span class="nx">selector</span><span class="p">);</span>
	<span class="p">};</span>




</pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <p>set common events to be processed as a basicProcessor</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">each</span><span class="p">([</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;contextmenu&quot;</span><span class="p">,</span> <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span> <span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">,</span> <span class="s2">&quot;keypress&quot;</span><span class="p">,</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseout&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;resize&quot;</span><span class="p">,</span> <span class="s2">&quot;scroll&quot;</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="s2">&quot;focusin&quot;</span><span class="p">,</span> <span class="s2">&quot;focusout&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseleave&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">processors</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">basicProcessor</span><span class="p">;</span>
	<span class="p">});</span>
	

	

<span class="p">;</span>

	
	<span class="nx">can</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">processors</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">funcName</span><span class="p">,</span> <span class="nx">controller</span><span class="p">){</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">selector</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="kd">var</span> <span class="nx">batchNum</span><span class="p">,</span>
			<span class="nx">check</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">how</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="nx">selector</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
				   <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span> <span class="o">!==</span> <span class="nx">batchNum</span> <span class="p">)</span> <span class="p">){</span>
					
					<span class="nx">batchNum</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span><span class="p">;</span>
					
					<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">attr</span><span class="p">();</span>
					<span class="k">delete</span> <span class="nx">d</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
					
					<span class="nx">controller</span><span class="p">[</span><span class="nx">funcName</span><span class="p">](</span><span class="nx">d</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="nx">check</span><span class="p">);</span>
		<span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="nx">check</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">;</span>


</pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>a path like string into something that's ok for an element ID</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">toId</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">src</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\/|\./g</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">);</span>
	<span class="p">},</span>
		<span class="nx">isFunction</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">,</span>
		<span class="nx">makeArray</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>used for hookup ids</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">hookupId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>this might be useful for testing if html
htmlTest = /^[\s\n\r\xA0]<em>&lt;(.|[\r\n])</em>>[\s\n\r\xA0]*$/</p>             </td>             <td class="code">               <div class="highlight"><pre>
	
	<span class="nx">$view</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">view</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>get the result</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">view</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span><span class="p">(</span><span class="nx">result</span><span class="p">)){</span>
			<span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
				<span class="k">return</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">frag</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
			<span class="p">})</span>
		<span class="p">}</span>
		
</pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>convert it into a dom frag</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="k">return</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">frag</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
	<span class="p">};</span>

	<span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">$view</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">frag</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">buildFragment</span><span class="p">([</span><span class="nx">result</span><span class="p">],[</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">]).</span><span class="nx">fragment</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p>if we have an empty fraga</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">frag</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> 
				<span class="nx">frag</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">hookup</span><span class="p">(</span><span class="nx">frag</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">hookup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">hookupEls</span> <span class="o">=</span> <span class="p">[],</span>
				<span class="nx">id</span><span class="p">,</span> 
				<span class="nx">func</span><span class="p">,</span> 
				<span class="nx">el</span><span class="p">,</span>
				<span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>get all childNodes</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">childNodes</span> <span class="o">?</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">)</span> <span class="o">:</span> <span class="nx">fragment</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">node</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
					<span class="nx">hookupEls</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span>
					<span class="nx">hookupEls</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">hookupEls</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)))</span>
				<span class="p">}</span>
			<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>filter by data-view-id attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">for</span> <span class="p">(;</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">hookupEls</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];</span> <span class="p">)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-view-id&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">func</span> <span class="o">=</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">hookups</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">func</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
					<span class="k">delete</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">hookups</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
					<span class="nx">el</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">&#39;data-view-id&#39;</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">fragment</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">hookups</span><span class="o">:</span> <span class="p">{},</span>
		
		<span class="nx">hook</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cb</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">$view</span><span class="p">.</span><span class="nx">hookups</span><span class="p">[</span><span class="o">++</span><span class="nx">hookupId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cb</span><span class="p">;</span>
			<span class="k">return</span> <span class="s2">&quot; data-view-id=&#39;&quot;</span><span class="o">+</span><span class="nx">hookupId</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">cached</span><span class="o">:</span> <span class="p">{},</span>
		
		<span class="nx">cache</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
		
		<span class="nx">register</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">info</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">info</span><span class="p">.</span><span class="nx">suffix</span><span class="p">]</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">types</span><span class="o">:</span> <span class="p">{},</span>
		
		<span class="nx">ext</span><span class="o">:</span> <span class="s2">&quot;.ejs&quot;</span><span class="p">,</span>
		
		<span class="nx">registerScript</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
		
		<span class="nx">preload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="p">)</span> <span class="p">{},</span>
		<span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>if helpers is a function, it is actually a callback</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">isFunction</span><span class="p">(</span> <span class="nx">helpers</span> <span class="p">))</span> <span class="p">{</span>
				<span class="nx">callback</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">;</span>
				<span class="nx">helpers</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
			<span class="p">}</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>see if we got passed any deferreds</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">deferreds</span> <span class="o">=</span> <span class="nx">getDeferreds</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
	
	
			<span class="k">if</span> <span class="p">(</span> <span class="nx">deferreds</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// does data contain any deferreds?</span>
</pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>the deferred that resolves into the rendered content ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>add the view request to the list of deferreds</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">deferreds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">get</span><span class="p">(</span><span class="nx">view</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>wait for the view and all deferreds to finish</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">can</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="nx">deferreds</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">resolved</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>get all the resolved deferreds</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="kd">var</span> <span class="nx">objs</span> <span class="o">=</span> <span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>renderer is last [0] is the data</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">renderer</span> <span class="o">=</span> <span class="nx">objs</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span>
</pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>the result of the template rendering with data</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">result</span><span class="p">;</span> 
	
</pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>make data look like the resolved deferreds</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">data</span> <span class="o">=</span> <span class="nx">usefulPart</span><span class="p">(</span><span class="nx">resolved</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>go through each prop in data again,
replace the defferreds with what they resolved to</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
							<span class="k">if</span> <span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
								<span class="nx">data</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">usefulPart</span><span class="p">(</span><span class="nx">objs</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
							<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>get the rendered result</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">result</span> <span class="o">=</span> <span class="nx">renderer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">);</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>resolve with the rendered view</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> 
</pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>if there's a callback, call it back with the result</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
				<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>return the deferred ....</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>no deferreds, render this bad boy</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">response</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>if there's a callback function</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">async</span> <span class="o">=</span> <span class="nx">isFunction</span><span class="p">(</span> <span class="nx">callback</span> <span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>get the 'view' type</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">deferred</span> <span class="o">=</span> <span class="nx">get</span><span class="p">(</span><span class="nx">view</span><span class="p">,</span> <span class="nx">async</span><span class="p">);</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>if we are async, </p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">async</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>return the deferred</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">response</span> <span class="o">=</span> <span class="nx">deferred</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>and callback callback with the rendered result</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">deferred</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">renderer</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">callback</span><span class="p">(</span><span class="nx">renderer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">))</span>
					<span class="p">})</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>otherwise, the deferred is complete, so
set response to the result of the rendering</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="nx">deferred</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">renderer</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">response</span> <span class="o">=</span> <span class="nx">renderer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">);</span>
					<span class="p">});</span>
				<span class="p">}</span>
	
				<span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>returns true if something looks like a deferred</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">then</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">pipe</span><span class="p">)</span> <span class="c1">// check if obj is a can.Deferred</span>
	<span class="p">}</span> 
</pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>makes sure there's a template, if not, has steal provide a warning</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span>	<span class="nx">checkText</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">url</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>@steal-remove-start</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>@steal-remove-end</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">throw</span> <span class="s2">&quot;can.view: No template or empty template:&quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>returns a 'view' renderer deferred
url - the url to the view template
async - if the ajax request should be synchronous
returns a deferred</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">async</span> <span class="p">)</span> <span class="p">{</span>
			
			
			<span class="kd">var</span> <span class="nx">suffix</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\.[\w\d]+$/</span><span class="p">),</span>
			<span class="nx">type</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>if we are reading a script element for the content of the template
el will be set to that script element</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">el</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>a unique identifier for the view (used for caching)
this is typically derived from the element id or
the url for the template</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">id</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-268">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-268">&#182;</a>               </div>               <p>the AJAX request used to retrieve the template content</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">jqXHR</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-269">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-269">&#182;</a>               </div>               <p>used to generate the response </p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">response</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-270">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-270">&#182;</a>               </div>               <p>get the renderer function</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">renderer</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">),</span>
					<span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
				<span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span>
</pre></div>             </td>           </tr>                               <tr id="section-271">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-271">&#182;</a>               </div>               <p>cache if if we are caching</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">cache</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">$view</span><span class="p">.</span><span class="nx">cached</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
				<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-272">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-272">&#182;</a>               </div>               <p>return the objects for the response's dataTypes 
(in this case view)</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
			<span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-273">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-273">&#182;</a>               </div>               <p>if we have an inline template, derive the suffix from the 'text/???' part
this only supports '<script></script>' tags</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">suffix</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nx">el</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\/(x\-)?(.+)/</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span>
			<span class="p">}</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-274">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-274">&#182;</a>               </div>               <p>if there is no suffix, add one</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">suffix</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">url</span> <span class="o">+=</span> <span class="p">(</span> <span class="nx">suffix</span> <span class="o">=</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">ext</span> <span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">suffix</span><span class="p">)){</span>
				<span class="nx">suffix</span> <span class="o">=</span> <span class="nx">suffix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="p">}</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-275">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-275">&#182;</a>               </div>               <p>convert to a unique and valid id</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">id</span> <span class="o">=</span> <span class="nx">toId</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-276">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-276">&#182;</a>               </div>               <p>if a absolute path, use steal to get it
you should only be using // if you are using steal</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\/\//</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">steal</span> <span class="o">?</span> 
					<span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">sub</span> <span class="o">:</span> 
					<span class="nx">steal</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">mapJoin</span><span class="p">(</span><span class="nx">sub</span><span class="p">);</span>
			<span class="p">}</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-277">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-277">&#182;</a>               </div>               <p>set the template engine type </p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">type</span> <span class="o">=</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="nx">suffix</span><span class="p">];</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-278">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-278">&#182;</a>               </div>               <p>if it is cached, </p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">cached</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-279">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-279">&#182;</a>               </div>               <p>return the cached deferred renderer</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">cached</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-280">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-280">&#182;</a>               </div>               <p>otherwise if we are getting this from a script elment</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">el</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-281">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-281">&#182;</a>               </div>               <p>resolve immediately with the element's innerHTML</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-282">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-282">&#182;</a>               </div>               <p>make an ajax request for text</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
					<span class="nx">async</span><span class="o">:</span> <span class="nx">async</span><span class="p">,</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
					<span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
					<span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">checkText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
						<span class="nx">d</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">);</span>
					<span class="p">},</span>
					<span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-283">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-283">&#182;</a>               </div>               <p>make sure we got some text back</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">checkText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
						<span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">renderer</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">))</span>
</pre></div>             </td>           </tr>                               <tr id="section-284">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-284">&#182;</a>               </div>               <p>cache if if we are caching</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span> <span class="p">(</span> <span class="nx">$view</span><span class="p">.</span><span class="nx">cache</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">$view</span><span class="p">.</span><span class="nx">cached</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
						<span class="p">}</span>
						
					<span class="p">}</span>
				<span class="p">});</span>
				<span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-285">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-285">&#182;</a>               </div>               <p>gets an array of deferreds from an object
this only goes one level deep</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">getDeferreds</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">deferreds</span> <span class="o">=</span> <span class="p">[];</span>

</pre></div>             </td>           </tr>                               <tr id="section-286">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-286">&#182;</a>               </div>               <p>pull out deferreds</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="p">[</span><span class="nx">data</span><span class="p">]</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isDeferred</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">deferreds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">prop</span><span class="p">]);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">deferreds</span><span class="p">;</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-287">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-287">&#182;</a>               </div>               <p>gets the useful part of deferred
this is for Models and can.ajax that resolve to array (with success and such)
returns the useful, content part</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">usefulPart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">resolved</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">resolved</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">resolved</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;success&#39;</span> <span class="o">?</span> <span class="nx">resolved</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">resolved</span>
		<span class="p">};</span>
	
<span class="p">;</span>


</pre></div>             </td>           </tr>                               <tr id="section-288">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-288">&#182;</a>               </div>               <p>HELPER METHODS ==============</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">myEval</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">script</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nb">eval</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
	<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-289">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-289">&#182;</a>               </div>               <p>removes the last character from a string
this is no longer needed</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">extend</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-290">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-290">&#182;</a>               </div>               <p>regular expressions for caching</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">quickFunc</span> <span class="o">=</span> <span class="sr">/\s*\(([\$\w]+)\)\s*-&gt;([^\n]*)/</span><span class="p">,</span>
		<span class="nx">attrReg</span> <span class="o">=</span> <span class="sr">/([^\s]+)=$/</span><span class="p">,</span>
		<span class="nx">attributeReplace</span> <span class="o">=</span> <span class="sr">/__!!__/g</span><span class="p">,</span>
		<span class="nx">tagMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="o">:</span> <span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="o">:</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="nx">tr</span><span class="o">:</span> <span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="nx">ol</span><span class="o">:</span> <span class="s2">&quot;li&quot;</span><span class="p">,</span> <span class="nx">ul</span><span class="o">:</span> <span class="s2">&quot;li&quot;</span><span class="p">,</span> <span class="nx">tbody</span><span class="o">:</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="nx">thead</span><span class="o">:</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="nx">tfoot</span><span class="o">:</span> <span class="s2">&quot;tr&quot;</span><span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-291">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-291">&#182;</a>               </div>               <p>escapes characters starting with \</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">content</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">content</span>
				<span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\\\&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\\&quot;&#39;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\t&quot;</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">bracketNum</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">){</span>
			<span class="k">return</span> <span class="p">(</span><span class="o">--</span><span class="nx">content</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">--</span><span class="nx">content</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-292">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-292">&#182;</a>               </div>               <p>used to bind to an observe, and unbind when the element is removed</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">liveBind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">ob</span><span class="p">){</span>
				<span class="nx">ob</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
			<span class="p">})</span>
			<span class="nx">can</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="s1">&#39;destroyed&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">ob</span><span class="p">){</span>
					<span class="nx">ob</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
				<span class="p">})</span>
			<span class="p">})</span>
		<span class="p">},</span>
		<span class="nx">contentEscape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">txt</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-293">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-293">&#182;</a>               </div>               <p>return sanatized text</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">txt</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">txt</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="o">?</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">esc</span><span class="p">(</span> <span class="nx">txt</span> <span class="p">)</span> <span class="o">:</span>
				<span class="nx">contentText</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">contentText</span> <span class="o">=</span>  <span class="kd">function</span><span class="p">(</span> <span class="nx">input</span> <span class="p">)</span> <span class="p">{</span>	
			
</pre></div>             </td>           </tr>                               <tr id="section-294">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-294">&#182;</a>               </div>               <p>if it's a string, return</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">input</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-295">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-295">&#182;</a>               </div>               <p>if has no value</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">input</span> <span class="o">&amp;&amp;</span> <span class="nx">input</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-296">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-296">&#182;</a>               </div>               <p>if it's an object, and it has a hookup method</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">hook</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">hookup</span> <span class="o">&amp;&amp;</span>
</pre></div>             </td>           </tr>                               <tr id="section-297">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-297">&#182;</a>               </div>               <p>make a function call the hookup method</p>             </td>             <td class="code">               <div class="highlight"><pre>

			<span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">input</span><span class="p">.</span><span class="nx">hookup</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
			<span class="p">})</span> <span class="o">||</span>
</pre></div>             </td>           </tr>                               <tr id="section-298">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-298">&#182;</a>               </div>               <p>or if it's a function, just use the input</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="p">(</span><span class="k">typeof</span> <span class="nx">input</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">input</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-299">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-299">&#182;</a>               </div>               <p>finally, if there is a funciton to hookup on some dom
pass it to hookup to get the data-view-id back</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">hook</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="nx">hook</span><span class="p">);</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-300">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-300">&#182;</a>               </div>               <p>finally, if all else false, toString it</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">input</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">EJS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!=</span> <span class="nx">EJS</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">ejs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EJS</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
				<span class="k">return</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">ejs</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">);</span>
				<span class="p">};</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-301">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-301">&#182;</a>               </div>               <p>if we get a function directly, it probably is coming from
a steal-packaged view</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">fn</span><span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-302">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-302">&#182;</a>               </div>               <p>set options on self</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">scan</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
		<span class="p">};</span>
</pre></div>             </td>           </tr>                               <tr id="section-303">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-303">&#182;</a>               </div>               <p>add EJS to jQuery if it exists</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">EJS</span> <span class="o">=</span> <span class="nx">EJS</span><span class="p">;</span>
	
	<span class="nx">EJS</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span>
	
	<span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">extraHelpers</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span> <span class="o">||</span> <span class="p">{};</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="k">new</span> <span class="nx">EJS</span><span class="p">.</span><span class="nx">Helpers</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">extraHelpers</span> <span class="o">||</span> <span class="p">{}));</span>
	<span class="p">};</span>
	
	<span class="nx">extend</span><span class="p">(</span><span class="nx">EJS</span><span class="p">,</span> <span class="p">{</span>
		
		<span class="nx">txt</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">escape</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-304">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-304">&#182;</a>               </div>               <p>set callback on reading ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">__reading</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">attr</span><span class="p">){</span>
					<span class="nx">observed</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
						<span class="nx">obj</span><span class="o">:</span> <span class="nx">obj</span><span class="p">,</span>
						<span class="nx">attr</span><span class="o">:</span> <span class="nx">attr</span>
					<span class="p">});</span>
				<span class="p">}</span>
			<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-305">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-305">&#182;</a>               </div>               <p>get value</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="kd">var</span> <span class="nx">observed</span> <span class="o">=</span> <span class="p">[],</span>
				<span class="nx">input</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">),</span>
				<span class="nx">tag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tagMap</span><span class="p">[</span><span class="nx">tagName</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;span&quot;</span><span class="p">);</span>
	
</pre></div>             </td>           </tr>                               <tr id="section-306">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-306">&#182;</a>               </div>               <p>set back so we are no longer reading</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">){</span>
				<span class="k">delete</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">__reading</span><span class="p">;</span>
			<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-307">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-307">&#182;</a>               </div>               <p>if we had no observes</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">observed</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
				<span class="k">return</span> <span class="p">(</span><span class="nx">escape</span> <span class="o">||</span> <span class="nx">status</span> <span class="o">!==</span> <span class="mi">0</span><span class="o">?</span> <span class="nx">contentEscape</span> <span class="o">:</span> <span class="nx">contentText</span><span class="p">)(</span><span class="nx">input</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="k">if</span><span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
				<span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span><span class="nx">tag</span><span class="o">+</span><span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span>
</pre></div>             </td>           </tr>                               <tr id="section-308">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-308">&#182;</a>               </div>               <p>are we escaping</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">escape</span> <span class="o">?</span> 
</pre></div>             </td>           </tr>                               <tr id="section-309">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-309">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>
					<span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-310">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-310">&#182;</a>               </div>               <p>remove child, bind on parent</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span>
							<span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
						
						<span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">el</span><span class="p">);</span>
						<span class="nx">parent</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
						
</pre></div>             </td>           </tr>                               <tr id="section-311">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-311">&#182;</a>               </div>               <p>create textNode</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">liveBind</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
							<span class="nx">node</span><span class="p">.</span><span class="nx">nodeValue</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span>
						<span class="p">});</span>
					<span class="p">}</span>
					<span class="o">:</span>
					<span class="kd">function</span><span class="p">(</span><span class="nx">span</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-312">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-312">&#182;</a>               </div>               <p>remove child, bind on parent</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="kd">var</span> <span class="nx">makeAndPut</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">remove</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-313">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-313">&#182;</a>               </div>               <p>get fragement of html to fragment</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">frag</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-314">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-314">&#182;</a>               </div>               <p>wrap it to keep a reference to the elements .. </p>             </td>             <td class="code">               <div class="highlight"><pre>
									<span class="nx">nodes</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">frag</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span>
										<span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
									<span class="p">})),</span>
									<span class="nx">last</span> <span class="o">=</span> <span class="nx">remove</span><span class="p">[</span><span class="nx">remove</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
								
</pre></div>             </td>           </tr>                               <tr id="section-315">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-315">&#182;</a>               </div>               <p>insert it in the document</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="k">if</span><span class="p">(</span> <span class="nx">last</span><span class="p">.</span><span class="nx">nextSibling</span> <span class="p">){</span>
									<span class="nx">last</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">frag</span><span class="p">,</span> <span class="nx">last</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span>
								<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
									<span class="nx">last</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">frag</span><span class="p">)</span>
								<span class="p">}</span>
								
</pre></div>             </td>           </tr>                               <tr id="section-316">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-316">&#182;</a>               </div>               <p>remove the old content</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">can</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="nx">can</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">remove</span><span class="p">)</span> <span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-317">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-317">&#182;</a>               </div>               <p>can.view.hookup(nodes);</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="k">return</span> <span class="nx">nodes</span><span class="p">;</span>
							<span class="p">},</span>
							<span class="nx">nodes</span> <span class="o">=</span> <span class="nx">makeAndPut</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="p">[</span><span class="nx">span</span><span class="p">]);</span>
</pre></div>             </td>           </tr>                               <tr id="section-318">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-318">&#182;</a>               </div>               <p>listen to changes and update
make sure the parent does not die
we might simply check that nodes is still in the document 
before a write ...</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">liveBind</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="nx">span</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
							<span class="nx">nodes</span> <span class="o">=</span> <span class="nx">makeAndPut</span><span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">),</span> <span class="nx">nodes</span><span class="p">);</span>
						<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-319">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-319">&#182;</a>               </div>               <p>return parent;</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;&gt;&lt;/&quot;</span> <span class="o">+</span><span class="nx">tag</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span> <span class="c1">// in a tag</span>
</pre></div>             </td>           </tr>                               <tr id="section-320">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-320">&#182;</a>               </div>               <p>mark at end!</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="kd">var</span> <span class="nx">attrName</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[&#39;&quot;]/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
				<span class="nx">pendingHookups</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">liveBind</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">),</span>
							<span class="nx">parts</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[&#39;&quot;]/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">),</span>
							<span class="nx">newAttrName</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
						
</pre></div>             </td>           </tr>                               <tr id="section-321">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-321">&#182;</a>               </div>               <p>remove if we have a change and used to have an attrName</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">((</span><span class="nx">newAttrName</span> <span class="o">!=</span> <span class="nx">attrName</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">attrName</span><span class="p">){</span>
							<span class="nx">el</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">attrName</span><span class="p">)</span>
						<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-322">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-322">&#182;</a>               </div>               <p>set if we have a new attrName</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">(</span><span class="nx">newAttrName</span><span class="p">){</span>
							<span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">newAttrName</span><span class="p">,</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
						<span class="p">}</span>
					<span class="p">});</span>
				<span class="p">});</span>

				<span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// in an attribute</span>
				<span class="nx">pendingHookups</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">){</span>
					<span class="kd">var</span> <span class="nx">wrapped</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span>
						<span class="nx">hooks</span><span class="p">;</span>
						
					<span class="p">(</span><span class="nx">hooks</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">,</span><span class="s1">&#39;hooks&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="nx">can</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">,</span> <span class="s1">&#39;hooks&#39;</span><span class="p">,</span> <span class="nx">hooks</span> <span class="o">=</span> <span class="p">{});</span>
					<span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">status</span><span class="p">),</span>
						<span class="nx">parts</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;__!!__&quot;</span><span class="p">),</span>
						<span class="nx">hook</span><span class="p">;</span>

					<span class="k">if</span><span class="p">(</span><span class="nx">hooks</span><span class="p">[</span><span class="nx">status</span><span class="p">])</span> <span class="p">{</span>
						<span class="nx">hooks</span><span class="p">[</span><span class="nx">status</span><span class="p">].</span><span class="nx">funcs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>

						<span class="nx">hooks</span><span class="p">[</span><span class="nx">status</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
							<span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span>
									<span class="nx">newAttr</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">attributeReplace</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
										<span class="k">return</span> <span class="nx">contentText</span><span class="p">(</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">funcs</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span> <span class="p">);</span>
									<span class="p">});</span>
								<span class="k">return</span> <span class="nx">newAttr</span><span class="p">;</span>
							<span class="p">},</span>
							<span class="nx">funcs</span><span class="o">:</span> <span class="p">[</span><span class="nx">func</span><span class="p">],</span>
							<span class="nx">batchNum</span> <span class="o">:</span> <span class="kc">undefined</span>
						<span class="p">};</span>
					<span class="p">}</span>
					<span class="nx">hook</span> <span class="o">=</span> <span class="nx">hooks</span><span class="p">[</span><span class="nx">status</span><span class="p">];</span>
					
					<span class="nx">parts</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">input</span><span class="p">);</span>
					<span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">status</span><span class="p">,</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">));</span>
					

					<span class="nx">liveBind</span><span class="p">(</span><span class="nx">observed</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span> <span class="o">!==</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">batchNum</span><span class="p">){</span>
							<span class="nx">hook</span><span class="p">.</span><span class="nx">batchNum</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">batchNum</span><span class="p">;</span>
							<span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">status</span><span class="p">,</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">render</span><span class="p">());</span>
						<span class="p">}</span> 
						
						
					<span class="p">});</span>
				<span class="p">})</span>
				<span class="k">return</span> <span class="s2">&quot;__!!__&quot;</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-323">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-323">&#182;</a>               </div>               <p>called to setup escaped text</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">esc</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">func</span><span class="p">){</span>
			<span class="k">return</span> <span class="nx">EJS</span><span class="p">.</span><span class="nx">txt</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
		<span class="p">},</span>
		<span class="nx">pending</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">pendingHookups</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">hooks</span> <span class="o">=</span> <span class="nx">pendingHookups</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

				<span class="nx">pendingHookups</span> <span class="o">=</span> <span class="p">[];</span>
				<span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">){</span>
					<span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">hooks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
						<span class="nx">fn</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
					<span class="p">})</span>
				<span class="p">});</span>
			<span class="p">}</span><span class="k">else</span> <span class="p">{</span>
				<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
<span class="p">});</span>
</pre></div>             </td>           </tr>                               <tr id="section-324">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-324">&#182;</a>               </div>               <p>========= SCANNING CODE =========</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="kd">var</span> <span class="nx">tokenReg</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span><span class="p">[</span><span class="s2">&quot;&lt;%%&quot;</span><span class="p">,</span><span class="s2">&quot;%%&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;%==&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;%=&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;%#&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;%&quot;</span><span class="p">,</span><span class="s2">&quot;%&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">),</span>
</pre></div>             </td>           </tr>                               <tr id="section-325">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-325">&#182;</a>               </div>               <p>commands for caching</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">startTxt</span> <span class="o">=</span> <span class="s1">&#39;var ___v1ew = [];&#39;</span><span class="p">,</span>
		<span class="nx">finishTxt</span> <span class="o">=</span> <span class="s2">&quot;return ___v1ew.join(&#39;&#39;)&quot;</span><span class="p">,</span>
		<span class="nx">put_cmd</span> <span class="o">=</span> <span class="s2">&quot;___v1ew.push(&quot;</span><span class="p">,</span>
		<span class="nx">insert_cmd</span> <span class="o">=</span> <span class="nx">put_cmd</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-326">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-326">&#182;</a>               </div>               <p>global controls (used by other functions to know where we are)
are we inside a tag</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">htmlTag</span> <span class="o">=</span><span class="kc">null</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-327">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-327">&#182;</a>               </div>               <p>are we within a quote within a tag</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">quote</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-328">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-328">&#182;</a>               </div>               <p>what was the text before the current quote (used to get the attr name)</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">beforeQuote</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-329">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-329">&#182;</a>               </div>               <p>used to mark where the element is</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">status</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</pre></div>             </td>           </tr>                               <tr id="section-330">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-330">&#182;</a>               </div>               <p>t - 1
h - 0
q - string beforeQuote</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="k">return</span> <span class="nx">quote</span> <span class="o">?</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">+</span><span class="nx">beforeQuote</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">attrReg</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">htmlTag</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">},</span>
		<span class="nx">pendingHookups</span> <span class="o">=</span> <span class="p">[],</span>
		
		<span class="nx">scan</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">name</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\r|\n)+/g</span><span class="p">,</span> <span class="s2">&quot;\n&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">tokenReg</span><span class="p">),</span>
				<span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
				<span class="nx">buff</span> <span class="o">=</span> <span class="p">[</span><span class="nx">startTxt</span><span class="p">],</span>
</pre></div>             </td>           </tr>                               <tr id="section-331">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-331">&#182;</a>               </div>               <p>helper function for putting stuff in the view concat</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">put</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">bonus</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">put_cmd</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="nx">clean</span><span class="p">(</span><span class="nx">content</span><span class="p">),</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">bonus</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;);&#39;</span><span class="p">);</span>
				<span class="p">},</span>
</pre></div>             </td>           </tr>                               <tr id="section-332">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-332">&#182;</a>               </div>               <p>a stack used to keep track of how we should end a bracket }
once we have a &lt;%= %> with a leftBracket
we store how the file should end here (either '))' or ';' )</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">endStack</span> <span class="o">=</span><span class="p">[],</span>
</pre></div>             </td>           </tr>                               <tr id="section-333">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-333">&#182;</a>               </div>               <p>the last token, used to remember which tag we are in</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">lastToken</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-334">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-334">&#182;</a>               </div>               <p>the corresponding magic tag</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">startTag</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-335">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-335">&#182;</a>               </div>               <p>was there a magic tag inside an html tag</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">magicInTag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-336">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-336">&#182;</a>               </div>               <p>the current tag name</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-337">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-337">&#182;</a>               </div>               <p>declared here</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">bracketCount</span><span class="p">,</span>
				<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
				<span class="nx">token</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-338">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-338">&#182;</a>               </div>               <p>re-init the tag state goodness</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">htmlTag</span> <span class="o">=</span> <span class="nx">quote</span> <span class="o">=</span> <span class="nx">beforeQuote</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(;</span> <span class="p">(</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">])</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">;)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span> <span class="nx">startTag</span> <span class="o">===</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">switch</span> <span class="p">(</span> <span class="nx">token</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;%&#39;</span><span class="o">:</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;%=&#39;</span><span class="o">:</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;%==&#39;</span><span class="o">:</span>
						<span class="nx">magicInTag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;%#&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-339">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-339">&#182;</a>               </div>               <p>a new line, just add whatever content w/i a clean
reset everything</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">startTag</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span> <span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">put</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
						<span class="p">}</span>
						<span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>

					<span class="k">case</span> <span class="s1">&#39;&lt;%%&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-340">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-340">&#182;</a>               </div>               <p>replace &lt;%% with &lt;%</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="nx">content</span> <span class="o">+=</span> <span class="s1">&#39;&lt;%&#39;</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-341">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-341">&#182;</a>               </div>               <p>make sure we are not in a comment</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">(</span><span class="nx">tokens</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;!--&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
							<span class="nx">htmlTag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
							<span class="nx">magicInTag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="nx">content</span> <span class="o">+=</span> <span class="nx">token</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span>
						<span class="nx">htmlTag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-342">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-342">&#182;</a>               </div>               <p>TODO: all &lt;%= in tags should be added to pending hookups</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">(</span><span class="nx">magicInTag</span><span class="p">){</span>
							<span class="nx">put</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s2">&quot;,can.EJS.pending(),\&quot;&gt;\&quot;&quot;</span><span class="p">);</span>
							<span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="nx">content</span> <span class="o">+=</span> <span class="nx">token</span><span class="p">;</span>
						<span class="p">}</span>
						
						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span>
					<span class="k">case</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-343">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-343">&#182;</a>               </div>               <p>if we are in an html tag, finding matching quotes</p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">if</span><span class="p">(</span><span class="nx">htmlTag</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-344">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-344">&#182;</a>               </div>               <p>we have a quote and it matches</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="k">if</span><span class="p">(</span><span class="nx">quote</span> <span class="o">&amp;&amp;</span> <span class="nx">quote</span> <span class="o">===</span> <span class="nx">token</span><span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-345">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-345">&#182;</a>               </div>               <p>we are exiting the quote</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">quote</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-346">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-346">&#182;</a>               </div>               <p>otherwise we are creating a quote
TOOD: does this handle "\""</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">quote</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
								<span class="nx">quote</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
								<span class="nx">beforeQuote</span> <span class="o">=</span> <span class="nx">lastToken</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span>
					<span class="k">default</span><span class="o">:</span>
						<span class="k">if</span><span class="p">(</span><span class="nx">lastToken</span> <span class="o">===</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">){</span>
							<span class="nx">tagName</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
						<span class="p">}</span>
						<span class="nx">content</span> <span class="o">+=</span> <span class="nx">token</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-347">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-347">&#182;</a>               </div>               <p>we have a start tag</p>             </td>             <td class="code">               <div class="highlight"><pre>
					<span class="k">switch</span> <span class="p">(</span> <span class="nx">token</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">case</span> <span class="s1">&#39;%&gt;&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-348">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-348">&#182;</a>               </div>               <p>%></p>             </td>             <td class="code">               <div class="highlight"><pre>
						<span class="k">switch</span> <span class="p">(</span> <span class="nx">startTag</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">case</span> <span class="s1">&#39;&lt;%&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-349">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-349">&#182;</a>               </div>               <p>&lt;%</p>             </td>             <td class="code">               <div class="highlight"><pre>
							
</pre></div>             </td>           </tr>                               <tr id="section-350">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-350">&#182;</a>               </div>               <p>get the number of { minus }</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="nx">bracketCount</span> <span class="o">=</span> <span class="nx">bracketNum</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
							
</pre></div>             </td>           </tr>                               <tr id="section-351">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-351">&#182;</a>               </div>               <p>we are ending a block</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="k">if</span> <span class="p">(</span><span class="nx">bracketCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-352">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-352">&#182;</a>               </div>               <p>we are starting on</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">insert_cmd</span><span class="p">,</span> <span class="s2">&quot;can.EJS.txt(&#39;&quot;</span><span class="o">+</span><span class="nx">tagName</span><span class="o">+</span><span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;,this,function(){&quot;</span><span class="p">,</span> <span class="nx">startTxt</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span>
								
								<span class="nx">endStack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
									<span class="nx">before</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
									<span class="nx">after</span><span class="o">:</span> <span class="nx">finishTxt</span><span class="o">+</span><span class="s2">&quot;}));&quot;</span>
								<span class="p">})</span>
							<span class="p">}</span>
							<span class="k">else</span> <span class="p">{</span>
								
</pre></div>             </td>           </tr>                               <tr id="section-353">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-353">&#182;</a>               </div>               <p>how are we ending this statement</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="kd">var</span> <span class="nx">last</span> <span class="o">=</span> <span class="c1">// if the stack has value and we are ending a block</span>
									 <span class="nx">endStack</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">bracketCount</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">?</span> <span class="c1">// use the last item in the block stack</span>
									 <span class="nx">endStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span> <span class="o">:</span> <span class="c1">// or use the default ending</span>
								<span class="p">{</span>
									<span class="nx">after</span><span class="o">:</span> <span class="s2">&quot;;&quot;</span>
								<span class="p">};</span>
								
</pre></div>             </td>           </tr>                               <tr id="section-354">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-354">&#182;</a>               </div>               <p>if we are ending a returning block
add the finish text which returns the result of the
block </p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="k">if</span> <span class="p">(</span><span class="nx">last</span><span class="p">.</span><span class="nx">before</span><span class="p">)</span> <span class="p">{</span>
									<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">last</span><span class="p">.</span><span class="nx">before</span><span class="p">)</span>
								<span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-355">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-355">&#182;</a>               </div>               <p>add the remaining content</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="nx">last</span><span class="p">.</span><span class="nx">after</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="k">case</span> <span class="s1">&#39;&lt;%=&#39;</span><span class="o">:</span>
						<span class="k">case</span> <span class="s1">&#39;&lt;%==&#39;</span><span class="o">:</span>
</pre></div>             </td>           </tr>                               <tr id="section-356">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-356">&#182;</a>               </div>               <ul>
<li>we have an extra { -> block
get the number of { minus } </li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="nx">bracketCount</span> <span class="o">=</span> <span class="nx">bracketNum</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-357">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-357">&#182;</a>               </div>               <p>if we have more {, it means there is a block</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="k">if</span><span class="p">(</span> <span class="nx">bracketCount</span> <span class="p">){</span>
</pre></div>             </td>           </tr>                               <tr id="section-358">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-358">&#182;</a>               </div>               <p>when we return to the same # of { vs } end wiht a doubleParen</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">endStack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
									<span class="nx">before</span> <span class="o">:</span> <span class="nx">finishTxt</span><span class="p">,</span>
									<span class="nx">after</span><span class="o">:</span> <span class="s2">&quot;}));&quot;</span>
								<span class="p">})</span>
							<span class="p">}</span> 
</pre></div>             </td>           </tr>                               <tr id="section-359">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-359">&#182;</a>               </div>               <p>check if its a func like ()-></p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="k">if</span><span class="p">(</span><span class="nx">quickFunc</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">content</span><span class="p">)){</span>
								<span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">quickFunc</span><span class="p">)</span>
								<span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;function(__){var &quot;</span><span class="o">+</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;=can.$(__);&quot;</span><span class="o">+</span><span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;}&quot;</span>
							<span class="p">}</span>
							
</pre></div>             </td>           </tr>                               <tr id="section-360">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-360">&#182;</a>               </div>               <p>if we have &lt;%== a(function(){ %> then we want
 can.EJS.text(0,this, function(){ return a(function(){ var _v1ew = [];</p>             </td>             <td class="code">               <div class="highlight"><pre>
							<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">insert_cmd</span><span class="p">,</span> <span class="s2">&quot;can.EJS.&quot;</span><span class="o">+</span><span class="p">(</span><span class="nx">startTag</span> <span class="o">===</span> <span class="s1">&#39;&lt;%=&#39;</span> <span class="o">?</span> <span class="s2">&quot;esc&quot;</span> <span class="o">:</span> <span class="s2">&quot;txt&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;(&#39;&quot;</span><span class="o">+</span><span class="nx">tagName</span><span class="o">+</span><span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;,this,function(){ return &quot;</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> 
</pre></div>             </td>           </tr>                               <tr id="section-361">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-361">&#182;</a>               </div>               <p>if we have a block</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">bracketCount</span> <span class="o">?</span> 
</pre></div>             </td>           </tr>                               <tr id="section-362">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-362">&#182;</a>               </div>               <p>start w/ startTxt "var _v1ew = [];"</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="nx">startTxt</span> <span class="o">:</span> 
</pre></div>             </td>           </tr>                               <tr id="section-363">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-363">&#182;</a>               </div>               <p>if not, add doubleParent to close push and text</p>             </td>             <td class="code">               <div class="highlight"><pre>
								<span class="s2">&quot;}));&quot;</span>
								<span class="p">);</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="nx">startTag</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
						<span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="s1">&#39;&lt;%%&#39;</span><span class="o">:</span>
						<span class="nx">content</span> <span class="o">+=</span> <span class="s1">&#39;&lt;%&#39;</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">default</span><span class="o">:</span>
						<span class="nx">content</span> <span class="o">+=</span> <span class="nx">token</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
					
				<span class="p">}</span>
				<span class="nx">lastToken</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
			<span class="p">}</span>
			
</pre></div>             </td>           </tr>                               <tr id="section-364">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-364">&#182;</a>               </div>               <p>put it together ..</p>             </td>             <td class="code">               <div class="highlight"><pre>
			
			<span class="k">if</span> <span class="p">(</span> <span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-365">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-365">&#182;</a>               </div>               <p>Should be content.dump in Ruby</p>             </td>             <td class="code">               <div class="highlight"><pre>
				<span class="nx">put</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="nx">buff</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
			<span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">buff</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
				<span class="nx">out</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">out</span><span class="o">:</span> <span class="s1">&#39;with(_VIEW) { with (_CONTEXT) {&#39;</span> <span class="o">+</span> <span class="nx">template</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">finishTxt</span><span class="o">+</span><span class="s2">&quot;}}&quot;</span>
				<span class="p">};</span>
</pre></div>             </td>           </tr>                               <tr id="section-366">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-366">&#182;</a>               </div>               <p>use eval instead of creating a function, b/c it is easier to debug</p>             </td>             <td class="code">               <div class="highlight"><pre>
			<span class="nx">myEval</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="s1">&#39;this.fn = (function(_CONTEXT,_VIEW){&#39;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">.</span><span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;});\r\n//@ sourceURL=&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;.js&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
		<span class="p">};</span>
	
	

	
	<span class="nx">EJS</span><span class="p">.</span><span class="nx">Helpers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">extras</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_extras</span> <span class="o">=</span> <span class="nx">extras</span><span class="p">;</span>
		<span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">extras</span><span class="p">);</span>
	<span class="p">};</span>
	
	<span class="nx">EJS</span><span class="p">.</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
		
		<span class="nx">view</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">helpers</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$View</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">,</span> <span class="nx">helpers</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_extras</span><span class="p">);</span> <span class="c1">//new EJS(options).render(data, helpers);</span>
		<span class="p">},</span>
		<span class="nx">list</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
			<span class="nx">list</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
				<span class="nx">cb</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-367">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-367">&#182;</a>               </div>               <p>options for steal's build</p>             </td>             <td class="code">               <div class="highlight"><pre>
	<span class="nx">can</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
		<span class="nx">suffix</span><span class="o">:</span> <span class="s2">&quot;ejs&quot;</span><span class="p">,</span>
</pre></div>             </td>           </tr>                               <tr id="section-368">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-368">&#182;</a>               </div>               <p>returns a function that renders the view</p>             </td>             <td class="code">               <div class="highlight"><pre>
		<span class="nx">script</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">src</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s2">&quot;can.EJS(function(_CONTEXT,_VIEW) { &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nx">EJS</span><span class="p">({</span>
				<span class="nx">text</span><span class="o">:</span> <span class="nx">src</span><span class="p">,</span>
				<span class="nx">name</span><span class="o">:</span> <span class="nx">id</span>
			<span class="p">}).</span><span class="nx">template</span><span class="p">.</span><span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot; })&quot;</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">renderer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">EJS</span><span class="p">({</span>
				<span class="nx">text</span><span class="o">:</span> <span class="nx">text</span><span class="p">,</span>
				<span class="nx">name</span><span class="o">:</span> <span class="nx">id</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">})(</span><span class="nx">can</span> <span class="o">=</span> <span class="p">{},</span> <span class="k">this</span> <span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 