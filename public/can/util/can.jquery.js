(function(){$.extend(can,jQuery,{trigger:function(a,b,c){a.trigger?a.trigger(b,c):$.event.trigger(b,c,a,true)},addEvent:function(a,b){$([this]).bind(a,b);return this},removeEvent:function(a,b){$([this]).unbind(a,b);return this},$:jQuery});$.each(["bind","unbind","undelegate","delegate"],function(a,b){can[b]=function(){var c=this[b]?this:$([this]);c[b].apply(c,arguments);return this}});$.each(["append","filter","addClass","remove","data","get"],function(a,b){can[b]=function(c){return c[b].apply(c,
can.makeArray(arguments).slice(1))}});var q={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./,quote:/"/g,singleQuote:/'/g},U=function(a,b,c){return a[b]!==undefined?a[b]:c&&(a[b]={})},H=function(a){var b=typeof a;return a&&(b=="function"||b=="object")},V;can.String=can.extend({esc:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(q.quote,"&#34;").replace(q.singleQuote,
"&#39;")},getObject:V=function(a,b,c){a=a?a.split(q.dot):[];var d=a.length,e,f,g,h=0;b=can.isArray(b)?b:[b||window];if(d==0)return b[0];for(;e=b[h++];){for(g=0;g<d-1&&H(e);g++)e=U(e,a[g],c);if(H(e)){f=U(e,a[g],c);if(f!==undefined){c===false&&delete e[a[g]];return f}}}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},underscore:function(a){return a.replace(q.colons,"/").replace(q.words,"$1_$2").replace(q.lowUp,"$1_$2").replace(q.dash,"_").toLowerCase()},sub:function(a,b,c){var d=
[];c=typeof c=="boolean"?!c:c;d.push(a.replace(q.replacer,function(e,f){e=V(f,b,c);if(H(e)){d.push(e);return""}else return""+e}));return d.length<=1?d[0]:d},_regs:q});var I=false;can.Construct=function(){if(arguments.length)return can.Construct.extend.apply(can.Construct,arguments)};can.extend(can.Construct,{newInstance:function(){var a=this.instance(),b;if(a.setup)b=a.setup.apply(a,arguments);if(a.init)a.init.apply(a,can.isArray(b)?b:arguments);return a},_inherit:function(a,b,c){can.extend(c||a,
a||{})},setup:function(a){this.defaults=can.extend(true,{},a.defaults,this.defaults)},instance:function(){I=true;var a=new this;I=false;return a},extend:function(a,b,c){function d(){if(!I)return this.constructor!==d&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.constructor.newInstance.apply(this.constructor,arguments)}if(typeof a!="string"){c=b;b=a;a=null}if(!c){c=b;b=null}c=c||{};var e=this,f=this.prototype,g,h,i,j;j=this.instance();this._inherit(c,f,j);for(g in this)if(this.hasOwnProperty(g))d[g]=
this[g];this._inherit(b,this,d);if(a){i=a.split(/\./);h=i.pop();i=f=can.String.getObject(i.join("."),window,true);var k=can.String.underscore(a.replace(/\./g,"_")),l=can.String.underscore(h);f[h]=d}can.extend(d,{prototype:j,namespace:i,shortName:h,_shortName:l,_fullName:k,constructor:d,fullName:a});d.prototype.constructor=d;h=d.setup.apply(d,[e].concat(can.makeArray(arguments)));if(d.init)d.init.apply(d,h||[e].concat(can.makeArray(arguments)));return d}});var r=function(a){return typeof a==="object"&&
a!==null&&a&&!(a instanceof Date)},J=function(a,b){return can.each(a,function(c,d){d&&d.unbind&&d.unbind("change"+b)})},K=function(a,b,c){if(a instanceof w)J([a],c._namespace);else a=can.isArray(a)?new w.List(a):new w(a);a.bind("change"+c._namespace,function(d){var e=can.makeArray(arguments);d=e.shift();e[0]=b==="*"?c.indexOf(a)+"."+e[0]:b+"."+e[0];can.trigger(c,d,e)});return a},W=0,t=null,X=function(){if(!t){t=[];return true}},m=function(a,b,c){if(!a._init)if(t)t.push([a,{type:b,batchNum:Y},c]);
else return can.trigger(a,b,c)},Y=1,Z=function(){var a=t.length,b=t.slice(0);t=null;Y++;for(var c=0;c<a;c++)can.trigger.apply(can,b[c])},D=function(a,b,c){a.each(function(d,e){c[d]=r(e)&&typeof e[b]=="function"?e[b]():e});return c},x=function(a){return function(){return can[a].apply(this,arguments)}},E=x("addEvent");x=x("removeEvent");var L=function(a){return can.isArray(a)?a:(""+a).split(".")},w=can.Construct("can.Observe",{setup:function(){can.Construct.setup.apply(this,arguments)},bind:E,unbind:x},
{setup:function(a){this._data={};this._namespace=".observe"+ ++W;this._init=1;this.attr(a);delete this._init},attr:function(a,b){var c=typeof a;if(c!="string"&&c!="number")return this._attrs(a,b);else if(b===undefined){w.__reading&&w.__reading(this,a);return this._get(a)}else{this._set(a,b);return this}},each:function(){return can.each.apply(null,[this.__get()].concat(can.makeArray(arguments)))},removeAttr:function(a){a=L(a);var b=a.shift(),c=this._data[b];if(a.length)return c.removeAttr(a);else{delete this._data[b];
b in this.constructor.prototype||delete this[b];m(this,"change",[b,"remove",undefined,c]);m(this,b,undefined,c);return c}},_get:function(a){a=L(a);var b=this.__get(a.shift());return a.length?b?b._get(a):undefined:b},__get:function(a){return a?this._data[a]:this._data},_set:function(a,b){a=L(a);var c=a.shift(),d=this.__get(c);if(r(d)&&a.length)d._set(a,b);else if(a.length)throw"can.Observe: set a property on an object that does not exist";else this.__set(c,b,d)},__set:function(a,b,c){if(b!==c){var d=
this.__get().hasOwnProperty(a)?"set":"add";this.___set(a,r(b)?K(b,a,this):b);m(this,"change",[a,d,b,c]);m(this,a,b,c);c&&J([c],this._namespace)}},___set:function(a,b){this._data[a]=b;a in this.constructor.prototype||(this[a]=b)},bind:E,unbind:x,serialize:function(){return D(this,"serialize",{})},_attrs:function(a,b){if(a===undefined)return D(this,"attr",{});a=can.extend(true,{},a);var c,d=X(),e=this;this.each(function(f,g){var h=a[f];if(h===undefined)b&&e.removeAttr(f);else{if(r(g)&&r(h))g.attr(h,
b);else g!=h&&e._set(f,h);delete a[f]}});for(c in a){newVal=a[c];this._set(c,newVal)}d&&Z();return this}}),ta=[].splice,M=w("can.Observe.List",{setup:function(a,b){this.length=0;this._namespace=".list"+ ++W;this._init=1;this.bind("change",can.proxy(this._changes,this));this.push.apply(this,can.makeArray(a||[]));can.extend(this,b);delete this._init},_changes:function(a,b,c,d,e){if(b.indexOf(".")===-1)if(c==="add"){m(this,c,[d,+b]);m(this,"length",[this.length])}else if(c==="remove"){m(this,c,[e,+b]);
m(this,"length",[this.length])}else m(this,c,[d,+b])},__get:function(a){return a?this[a]:this},___set:function(a,b){this[a]=b},serialize:function(){return D(this,"serialize",[])},splice:function(a,b){var c=can.makeArray(arguments),d;for(d=2;d<c.length;d++){var e=c[d];if(r(e))c[d]=K(e,"*",this)}if(b===undefined)b=c[1]=this.length-a;d=ta.apply(this,c);if(b>0){m(this,"change",[""+a,"remove",undefined,d]);J(d,this._namespace)}c.length>2&&m(this,"change",[""+a,"add",c.slice(2),d]);return d},_attrs:function(a,
b){if(a===undefined)return D(this,"attr",[]);a=a.slice(0);for(var c=Math.min(a.length,this.length),d=X(),e=0;e<c;e++){var f=this[e],g=a[e];if(r(f)&&r(g))f.attr(g,b);else f!=g&&this._set(e,g)}if(a.length>this.length)this.push(a.slice(this.length));else a.length<this.length&&b&&this.splice(a.length);d&&Z()}}),aa=function(a){return a[0]&&can.isArray(a[0])?a[0]:can.makeArray(a)};can.each({push:"length",unshift:0},function(a,b){M.prototype[a]=function(){for(var c=aa(arguments),d=b?this.length:0,e=0;e<
c.length;e++){var f=c[e];if(r(f))c[e]=K(f,"*",this)}if(c.length==1&&this.comparator){this.splice(this.sortedIndex(c[0]),0,c[0]);return this.length}e=[][a].apply(this,c);if(this.comparator&&c.length>1){this.sort(null,true);m(this,"reset",[c])}else m(this,"change",[""+d,"add",c,undefined]);return e}});can.each({pop:"length",shift:0},function(a,b){M.prototype[a]=function(){var c=aa(arguments),d=b&&this.length?this.length-1:0;c=[][a].apply(this,c);m(this,"change",[""+d,"remove",undefined,[c]]);c&&c.unbind&&
c.unbind("change"+this._namespace);return c}});M.prototype.indexOf=[].indexOf||function(a){return can.inArray(a,this)};var ua=/^\d+$/,va=/([^\[\]]+)|(\[\])/g,ba=/\+/g,wa=/([^?#]*)(#.*)?$/;can.extend(can.String,{deparam:function(a){if(!a||!wa.test(a))return{};var b={};a=a.split("&");for(var c,d=0;d<a.length;d++){c=b;var e=a[d].split("=");if(e.length!=2)e=[e[0],e.slice(1).join("=")];var f=decodeURIComponent(e[0].replace(ba," "));e=decodeURIComponent(e[1].replace(ba," "));f=f.match(va);for(var g=0;g<
f.length-1;g++){var h=f[g];c[h]||(c[h]=ua.test(f[g+1])||f[g+1]=="[]"?[]:{});c=c[h]}lastPart=f[f.length-1];if(lastPart=="[]")c.push(e);else c[lastPart]=e}return b}});var xa=$.cleanData;$.cleanData=function(a){for(var b=0,c;(c=a[b])!==undefined;b++)$(c).triggerHandler("destroyed");xa(a)};var ca=/\:([\w\.]+)/g,da=/^(?:&[^=]+=[^&]*)+/,ya=function(a){var b=[];s(a,function(c,d){d&&b.push(c==="className"?"class":c,'="',can.String.esc(d),'"')});return b.join(" ")},za=function(a,b){for(var c=0,d=0;d<a.names.length;d++){if(!b.hasOwnProperty(a.names[d]))return-1;
c++}return c},ea=true,y=window.location,s=can.each,n=can.extend;can.route=function(a,b){var c=[],d=a.replace(ca,function(e,f){c.push(f);return"([^\\/\\&]*)"});can.route.routes[a]={test:new RegExp("^"+d+"($|&)"),route:a,names:c,defaults:b||{},length:a.split("/").length};return can.route};n(can.route,{param:function(a){delete a.route;var b,c=0,d,e=a.route;delete a.route;e&&(b=can.route.routes[e])||s(can.route.routes,function(h,i){d=za(i,a);if(d>c){b=i;c=d}});if(b){var f=n({},a);e=b.route.replace(ca,
function(h,i){delete f[i];return a[i]===b.defaults[i]?"":encodeURIComponent(a[i])});var g;s(b.defaults,function(h,i){f[h]===i&&delete f[h]});g=can.param(f);return e+(g?"&"+g:"")}return can.isEmptyObject(a)?"":"&"+can.param(a)},deparam:function(a){var b={length:-1};s(can.route.routes,function(f,g){if(g.test.test(a)&&g.length>b.length)b=g});if(b.length>-1){var c=a.match(b.test),d=c.shift(),e=(d=a.substr(d.length-(c[c.length-1]==="&"?1:0)))&&da.test(d)?can.String.deparam(d.slice(1)):{};e=n(true,{},b.defaults,
e);s(c,function(f,g){if(g&&g!=="&")e[b.names[f]]=decodeURIComponent(g)});e.route=b.route;return e}if(a.charAt(0)!=="&")a="&"+a;return da.test(a)?can.String.deparam(a.slice(1)):{}},data:new can.Observe({}),routes:{},ready:function(a){if(a===false)ea=false;if(a===true||ea===true)fa();return can.route},url:function(a,b){return b?"#!"+can.route.param(n({},N,a)):"#!"+can.route.param(a)},link:function(a,b,c,d){return"<a "+ya(n({href:can.route.url(b,d)},c))+">"+a+"</a>"},current:function(a){return y.hash==
"#!"+can.route.param(a)}});s(["bind","unbind","delegate","undelegate","attr","removeAttr"],function(a,b){can.route[b]=function(){return can.route.data[b].apply(can.route.data,arguments)}});var N,fa=function(){var a=y.hash.substr(1,1)==="!"?y.hash.slice(2):y.hash.slice(1);N=can.route.deparam(a);can.route.attr(N,true)};can.bind.call(window,"hashchange",fa);can.route.bind("change",function(a){var b;return function(){var c=arguments,d=this;clearTimeout(b);b=setTimeout(function(){a.apply(d,c)},1)}}(function(){y.hash=
"#!"+can.route.param(can.route.data.serialize())}));can.bind.call(document,"ready",can.route.ready);E=function(a,b,c){can.bind.call(a,b,c);return function(){can.unbind.call(a,b,c)}};var Aa=can.isFunction;n=can.extend;s=can.each;var Ba=[].slice,Ca=$.event&&$.event.special||{},Da=function(a,b,c,d){can.delegate.call(a,b,c,d);return function(){can.undelegate.call(a,b,c,d)}},ga=function(a,b,c,d){return d?Da(a,can.trim(d),b,c):E(a,b,c)},O=function(a,b){var c=typeof b=="string"?a[b]:b;return function(){a.called=
b;return c.apply(a,[this.nodeName?can.$(this):this].concat(Ba.call(arguments,0)))}},Ea=/[^\w]/,ha=/\{([^\}]+)\}/g,Fa=/^(?:(.*?)\s)?([\w\.\:>]+)$/,P;can.Construct("can.Control",{setup:function(){can.Construct.setup.apply(this,arguments);if(this!==can.Control){var a=this.pluginName||this._fullName,b;a!=="can_control"&&this.plugin(a);this.actions={};for(b in this.prototype)if(!(b=="constructor"||!Aa(this.prototype[b])))if(this._isAction(b))this.actions[b]=this._action(b)}},_isAction:function(a){return Ea.test(a)?
true:Ca[a]||Q[a]},plugin:function(){},_action:function(a,b){ha.lastIndex=0;if(!b&&ha.test(a))return null;a=b?can.String.sub(a,[b,window]):a;b=can.isArray(a);var c=(b?a[1]:a).match(Fa);return{processor:Q[c[2]]||P,parts:c,delegate:b?a[0]:undefined}},processors:{},defaults:{}},{setup:function(a,b){var c=this.constructor;a=can.get(can.$(a),0);var d=c.pluginName||c._fullName;this.element=can.$(a);d&&d!=="can_control"&&this.element.addClass(d);(a=can.data(this.element,"controls"))||can.data(this.element,
"controls",a=[]);a.push(this);this.options=n(n({},c.defaults),b);this.on();return[this.element,this.options]},on:function(a,b,c,d){if(a===undefined){this.off();a=this.constructor;b=this._bindings;c=a.actions;d=this.element;for(funcName in c)if(c.hasOwnProperty(funcName)){ready=c[funcName]||a._action(funcName,this.options);b.push(ready.processor(ready.delegate||d,ready.parts[2],ready.parts[1],funcName,this))}var e=O(this,"destroy");can.bind.call(d,"destroyed",e);b.push(function(f){can.unbind.call(f,
"destroyed",e)});return b.length}if(typeof a=="string"){d=c;c=b;b=a;a=this.element}if(typeof d=="string")d=O(this,d);this._bindings.push(ga(a,c,d,b));return this._bindings.length},off:function(){var a=can.get(this.element,0);s(this._bindings||[],function(b,c){c(a)});this._bindings=[]},update:function(a){n(this.options,a);this.on()},destroy:function(){var a=this.constructor;a=a.pluginName||a._fullName;this.off();a&&a!=="can_control"&&this.element.removeClass(a);a=can.data(this.element,"controls");
a.splice(can.inArray(this,a),1);can.trigger(this,"destroyed");this.element=null}});var Q=can.Control.processors;P=function(a,b,c,d,e){return ga(a,b,O(e,d),c)};s("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),function(a,b){Q[b]=P});var Ga=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},R=can.makeArray,Ha=1,o=can.view=function(a,b,c,d){a=can.render(a,
b,c,d);if(can.isDeferred(a))return a.pipe(function(e){return can.view.frag(e)});return can.view.frag(a)};can.extend(can.view,{frag:function(a){a=can.buildFragment([a],[document.body]).fragment;a.childNodes.length||a.appendChild(document.createTextNode(""));return can.view.hookup(a)},hookup:function(a){var b=[],c,d,e,f=0;for(can.each(a.childNodes?R(a.childNodes):a,function(g,h){if(h.nodeType!=3){b.push(h);b.push.apply(b,R(h.getElementsByTagName("*")))}});e=b[f++];)if(e.getAttribute&&(c=e.getAttribute("data-view-id"))&&
(d=o.hookups[c])){d(e,c);delete o.hookups[c];e.removeAttribute("data-view-id")}return a},hookups:{},hook:function(a){var b=++Ha;o.hookups[b]=a;return b},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a},types:{},ext:".ejs",registerScript:function(){},preload:function(){}});can.render=function(a,b,c,d){if(typeof c==="function"){d=c;c=undefined}var e=Ia(b);if(e.length){var f=new can.Deferred;e.push(ia(a,true));can.when.apply(can,e).then(function(h){var i=R(arguments),j=i.pop();if(can.isDeferred(b))b=
ja(h);else for(var k in b)if(can.isDeferred(b[k]))b[k]=ja(i.shift());i=j(b,c);f.resolve(i);d&&d(i)});return f}else{var g;e=typeof d==="function";f=ia(a,e);if(e){g=f;f.then(function(h){d(h(b,c))})}else f.then(function(h){g=h(b,c)});return g}};can.isDeferred=function(a){return a&&can.isFunction(a.then)&&can.isFunction(a.pipe)};var ka=function(a,b){if(!a.match(/[^\s]/))throw"can.view ERROR: There is no template or an empty template at "+b;},ia=function(a,b){var c=a.match(/\.[\w\d]+$/),d,e,f,g=function(j){j=
d.renderer(f,j);var k=new can.Deferred;k.resolve(j);if(o.cache)o.cached[f]=k;return k};if(e=document.getElementById(a))c="."+e.type.match(/\/(x\-)?(.+)/)[2];if(!c){c=o.ext;a+=o.ext}if(can.isArray(c))c=c[0];f=Ga(a);if(a.match(/^\/\//)){var h=a.substr(2);a=typeof steal==="undefined"?(a="/"+h):steal.root.mapJoin(h)}d=o.types[c];if(o.cached[f])return o.cached[f];else if(e)return g(e.innerHTML);else{var i=new can.Deferred;can.ajax({async:b,url:a,dataType:"text",error:function(j){ka("",a);i.reject(j)},
success:function(j){ka(j,a);i.resolve(d.renderer(f,j));if(o.cache)o.cached[f]=i}});return i}},Ia=function(a){var b=[];if(can.isDeferred(a))return[a];else for(var c in a)can.isDeferred(a[c])&&b.push(a[c]);return b},ja=function(a){return can.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a},la=function(a,b,c){var d=new can.Deferred;a.then(function(){arguments[0]=b[c](arguments[0]);d.resolve.apply(d,arguments)},function(){d.resolveWith.apply(this,arguments)});return d},Ja=0,z=function(a){return a[a.constructor.id]},
A=function(a,b,c,d,e,f){if(typeof a=="string"){a=a.split(" ");a={url:a.pop(),type:a.pop()}}a.data=typeof b=="object"&&!can.isArray(b)?can.extend(a.data||{},b):b;a.url=can.String.sub(a.url,a.data,true);return can.ajax(can.extend({type:c||"post",dataType:d||"json",success:e,error:f},a))},ma=function(a,b,c,d,e){var f;f=[a.serialize()];var g=a.constructor,h;b=="destroy"&&f.shift();b!=="create"&&f.unshift(z(a));h=g[b].apply(g,f);f=h.pipe(function(i){a[e||b+"d"](i,h);return a});if(h.abort)f.abort=function(){h.abort()};
f.then(c,d);return f};ajaxMethods={create:function(a){return function(b){return A(a||this._shortName,b)}},update:function(a){return function(b,c){c=c||{};var d=this.id;if(c[d]&&c[d]!==b){c["new"+can.String.capitalize(b)]=c[d];delete c[d]}c[d]=b;return A(a||this._url,c,"put")}},destroy:function(a){return function(b){var c={};c[this.id]=b;return A(a||this._url,c,"delete")}},findAll:function(a){return function(b,c,d){return la(A(a||this._shortName,b,"get","json"),this,"models").then(c,d)}},findOne:function(a){return function(b,
c,d){return la(A(a||this._url,b,"get","json"),this,"model").then(c,d)}}};can.Observe("can.Model",{setup:function(){can.Observe.apply(this,arguments);if(this!==can.Model){var a=this;can.each(ajaxMethods,function(d,e){var f=a[d];if(typeof f!=="function")a[d]=e(f)});if(a.fullName=="can.Model")a.fullName="Model"+ ++Ja;if(window.jQuery){var b={},c="* "+a.fullName+".model";b[c+"s"]=can.proxy(a.models,a);b[c]=can.proxy(a.model,a);$.ajaxSetup({converters:b})}this.store={};this._url=this._shortName+"/{"+this.id+
"}"}},id:"id",models:function(a){if(!a)return null;var b=new (this.List||na),c=can.isArray(a),d=a instanceof na;d=c?a:d?a.serialize():a.data;for(var e=d.length,f=0;f<e;f++)b.push(this.model(d[f]));c||can.each(a,function(g,h){if(g!=="data")b[g]=h});return b},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return this.store[a.id]||new this(a)}},{isNew:function(){var a=z(this);return!(a||a===0)},save:function(a,b){return ma(this,this.isNew()?"create":"update",a,b)},destroy:function(a,
b){return ma(this,"destroy",a,b,"destroyed")},bind:function(){if(!this._bindings){this.constructor.store[z(this)]=this;this._bindings=0}this._bindings++;return can.Observe.prototype.bind.apply(this,arguments)},unbind:function(){this._bindings--;this._bindings||delete this.constructor.store[z(this)];return can.Observe.prototype.unbind.apply(this,arguments)},___set:function(a,b){can.Observe.prototype.___set.call(this,a,b);if(a===this.constructor.id&&this._bindings)this.constructor.store[z(this)]=this}});
can.each(["created","updated","destroyed"],function(a,b){can.Model.prototype[b]=function(c){var d=this.constructor;c&&typeof c=="object"&&this.attr(c.attr?c.attr():c);can.trigger(this,b);can.trigger(this,"change",b);can.trigger(d,b,this)}});var na=can.Observe.List("can.Model.List",{setup:function(){can.Observe.List.prototype.setup.apply(this,arguments);var a=this;this.bind("change",function(b,c){/\w+\.destroyed/.test(c)&&a.splice(a.indexOf(b.target),1)})}});can.Control.processors.route=function(a,
b,c,d,e){can.route(c||"");var f,g=function(h){if(can.route.attr("route")===(c||"")&&(h.batchNum===undefined||h.batchNum!==f)){f=h.batchNum;h=can.route.attr();delete h.route;e[d](h)}};can.route.bind("change",g);return function(){can.route.unbind("change",g)}};var Ka=function(a){eval(a)};n=can.extend;var La=/\r\n/g,Ma=/\r/g,Na=/\n/g,Oa=/\\/g,Pa=/\t/g,Qa=/\{/g,Ra=/\}/g,oa=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,Sa=/([^\s]+)=$/,Ta={"":"span",table:"tr",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr"},
Ua=function(a){return a.replace(Oa,"\\\\").replace(Na,"\\n").replace(/"/g,'\\"').replace(Pa,"\\t")},pa=function(a){var b=a.match(Qa);a=a.match(Ra);return(b?b.length:0)-(a?a.length:0)},F=function(a,b,c){can.each(a,function(d,e){e.cb=function(f,g){console.log("event",g,"listening",e.attr);g===e.attr&&c()};console.log("listening on",e.attr);e.obj.bind("change",e.cb)});can.bind.call(b,"destroyed",function(){can.each(a,function(d,e){e.obj.unbind("change",e.cb)})})},ra=function(a){return typeof a=="string"||
typeof a=="number"?can.String.esc(""+a):qa(a)},qa=function(a){if(typeof a=="string")return a;if(a===null||a===undefined)return"";var b=a.hookup&&function(c,d){a.hookup.call(a,c,d)}||typeof a=="function"&&a;if(b)return"data-view-id='"+can.view.hook(b)+"'";return""+a},p=function(a){if(this.constructor!=p){var b=new p(a);return function(c,d){return b.render(c,d)}}if(typeof a=="function")this.template={fn:a};else{n(this,a);this.template=Va(this.text,this.name)}};can.EJS=p;p.prototype.render=function(a,
b){a=a||{};return this.template.fn.call(a,a,new p.Helpers(a,b||{}))};n(p,{txt:function(a,b,c,d,e){if(can.Observe)can.Observe.__reading=function(i,j){f.push({obj:i,attr:j})};var f=[],g=d.call(c);can.Observe&&delete can.Observe.__reading;if(!f.length)return(e||b!==0?ra:qa)(g);a=Ta[a]||"span";if(b==0)return"<"+a+" data-view-id='"+can.view.hook(e?function(i){var j=i.parentNode,k=document.createTextNode(g);j.insertBefore(k,i);j.removeChild(i);F(f,j,function(){k.nodeValue=d.call(c)})}:function(i){var j=
function(l,u){l=can.view.frag(l);var S=can.$(can.map(l.childNodes,function(Wa){return Wa})),G=u[u.length-1];G.nextSibling?G.parentNode.insertBefore(l,G.nextSibling):G.parentNode.appendChild(l);can.remove(can.$(u));return S},k=j(g,[i]);F(f,i.parentNode,function(){k=j(d.call(c),k)})})+"'></"+a+">";else if(b===1){var h=d.call(c).replace(/['"]/g,"").split("=")[0];B.push(function(i){F(f,i,function(){var j=(d.call(c)||"").replace(/['"]/g,"").split("=");newAttrName=j[0];newAttrName!=h&&h&&i.removeAttribute(h);
newAttrName&&i.setAttribute(newAttrName,j[1])})});return g}else{B.push(function(i){var j=can.$(i),k;(k=can.data(j,"hooks"))||can.data(j,"hooks",k={});var l=i.getAttribute(b);j=l.split("__!!__");if(k[b])k[b].funcs.push(d);else k[b]={render:function(){var u=0;return l.replace(/__!!__/g,function(){return ra(k[b].funcs[u++].call(c))})},funcs:[d]};j.splice(1,0,g);i.setAttribute(b,j.join(""));F(f,i,function(){i.setAttribute(b,k[b].render())})});return"__!!__"}},esc:function(a,b,c,d){return p.txt(a,b,c,
d,true)},pending:function(){if(B.length){var a=B.slice(0);B=[];return" data-view-id='"+can.view.hook(function(b){can.each(a,function(c,d){d(b)})})+"'"}else return""}});var Xa=/(<%%|%%>|<%==|<%=|<%#|<%|%>|<|>|"|')/,C=null,v=null,T=null,sa=function(){return v?"'"+T.match(Sa)[1]+"'":C?1:0},B=[],Va=function(a,b){a=a.replace(La,"\n").replace(Ma,"\n").split(Xa);var c="",d=["var ___v1ew = [];"],e=function(u,S){d.push("___v1ew.push(",'"',Ua(u),'"'+(S||"")+");")},f=[],g,h=null,i=false,j="",k=0,l;for(C=v=T=
null;(l=a[k++])!==undefined;){if(h===null)switch(l){case "<%":case "<%=":case "<%==":i=1;case "<%#":h=l;c.length>0&&e(c);c="";break;case "<%%":c+="<%";break;case "<":C=1;c+=l;i=0;break;case ">":C=0;if(i){e(c,',can.EJS.pending(),">"');c=""}else c+=l;break;case "'":case '"':if(C)if(v&&v===l)v=null;else if(v===null){v=l;T=g}default:if(g==="<")j=l.split(" ")[0];c+=l;break}else switch(l){case "%>":switch(h){case "<%":g=pa(c);if(g==1){d.push("___v1ew.push(","can.EJS.txt('"+j+"',"+sa()+",this,function(){",
"var ___v1ew = [];",c);f.push({before:"",after:"return ___v1ew.join('')}));"})}else{h=f.length&&g==-1?f.pop():{after:";"};h.before&&d.push(h.before);d.push(c,";",h.after)}break;case "<%=":case "<%==":(g=pa(c))&&f.push({before:"return ___v1ew.join('')",after:"}));"});if(oa.test(c)){c=c.match(oa);c="function(__){var "+c[1]+"=can.$(__);"+c[2]+"}"}d.push("___v1ew.push(","can.EJS."+(h==="<%="?"esc":"txt")+"('"+j+"',"+sa()+",this,function(){ return ",c,g?"var ___v1ew = [];":"}));");break}h=null;c="";break;
case "<%%":c+="<%";break;default:c+=l;break}g=l}c.length>0&&e(c);d.push(";");a={out:"with(_VIEW) { with (_CONTEXT) {"+d.join("")+" return ___v1ew.join('')}}"};Ka.call(a,"this.fn = (function(_CONTEXT,_VIEW){"+a.out+"});\r\n//@ sourceURL="+b+".js");return a};p.Helpers=function(a,b){this._data=a;this._extras=b;n(this,b)};p.Helpers.prototype={view:function(a,b,c){return $View(a,b||this._data,c||this._extras)},list:function(a,b){a.attr("length");for(var c=0,d=a.length;c<d;c++)b(a[c],c,a)}};can.view.register({suffix:"ejs",
script:function(a,b){return"can.EJS(function(_CONTEXT,_VIEW) { "+(new p({text:b,name:a})).template.out+" })"},renderer:function(a,b){return p({text:b,name:a})}})})(can={});
