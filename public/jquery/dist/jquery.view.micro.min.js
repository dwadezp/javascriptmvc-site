(function(f){var j=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},k=f.makeArray,n=1,e=f.View=function(a,b,c,d){if(typeof c==="function"){d=c;c=undefined}var g=C(b);if(g.length){var h=f.Deferred();g.push(u(a,true));f.when.apply(f,g).then(function(l){var m=k(arguments),o=m.pop()[0];if(q(b))b=v(l);else for(var p in b)if(q(b[p]))b[p]=v(m.shift());m=o(b,c);h.resolve(m);d&&d(m)});return h.promise()}else{var i;g=typeof d==="function";h=u(a,g);if(g){i=h;h.done(function(l){d(l(b,c))})}else h.done(function(l){i=
l(b,c)});return i}},w=function(a,b){if(!a.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+b;},u=function(a,b){return f.ajax({url:a,dataType:"view",async:b})},q=function(a){return a&&f.isFunction(a.always)},C=function(a){var b=[];if(q(a))return[a];else for(var c in a)q(a[c])&&b.push(a[c]);return b},v=function(a){return f.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a};f.ajaxTransport("view",function(a,b){var c=b.url;a=c.match(/\.[\w\d]+$/);var d,g,h,i,l=function(o){o=
d.renderer(h,o);if(e.cache)e.cached[h]=o;return{view:o}};if(g=document.getElementById(c))a="."+g.type.match(/\/(x\-)?(.+)/)[2];if(!a){a=e.ext;c+=e.ext}h=j(c);if(c.match(/^\/\//)){var m=c.substr(2);c=typeof steal==="undefined"?(c="/"+m):steal.root.mapJoin(m)+""}d=e.types[a];return{send:function(o,p){if(e.cached[h])return p(200,"success",{view:e.cached[h]});else if(g)p(200,"success",l(g.innerHTML));else i=f.ajax({async:b.async,url:c,dataType:"text",error:function(){w("",c);p(404)},success:function(x){w(x,
c);p(200,"success",l(x))}})},abort:function(){i&&i.abort()}}});f.extend(e,{hookups:{},hookup:function(a){var b=++n;e.hookups[b]=a;return b},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a;window.steal&&steal.type(a.suffix+" view js",function(b,c){var d=e.types["."+b.type],g=j(b.rootSrc+"");b.text=d.script(g,b.text);c()})},types:{},ext:".ejs",registerScript:function(a,b,c){return"$.View.preload('"+b+"',"+e.types["."+a].script(b,c)+");"},preload:function(a,b){e.cached[a]=function(c,
d){return b.call(c,c,d)}}});window.steal&&steal.type("view js",function(a,b){var c=e.types["."+a.type],d=j(a.rootSrc+"");a.text="steal('"+(c.plugin||"jquery/view/"+a.type)+"').then(function($){$.View.preload('"+d+"',"+a.text+");\n})";b()});var y,r,z,A,s,B,t,D={val:true,text:true};y=function(a){var b=f.fn[a];f.fn[a]=function(){var c=k(arguments),d,g,h=this;if(q(c[0])){c[0].done(function(i){r.call(h,[i],b)});return this}else if(z(c)){if(d=B(c)){g=c[d];c[d]=function(i){r.call(h,[i],b);g.call(h,i)};e.apply(e,
c);return this}c=e.apply(e,c);if(q(c)){c.done(function(i){r.call(h,[i],b)});return this}else c=[c]}return D[a]?b.apply(this,c):r.call(this,c,b)}};r=function(a,b){var c;for(var d in e.hookups)break;if(d&&a[0]&&A(a[0])){c=e.hookups;e.hookups={};a[0]=f(a[0])}b=b.apply(this,a);c&&t(a[0],c);return b};z=function(a){var b=typeof a[1];return typeof a[0]=="string"&&(b=="object"||b=="function")&&!s(a[1])};s=function(a){return a.nodeType||a.jquery};A=function(a){if(s(a))return true;else if(typeof a==="string"){a=
f.trim(a);return a.substr(0,1)==="<"&&a.substr(a.length-1,1)===">"&&a.length>=3}else return false};B=function(a){return typeof a[3]==="function"?3:typeof a[2]==="function"&&2};t=function(a,b){var c,d=0,g,h;a=a.filter(function(){return this.nodeType!=3});a=a.add("[data-view-id]",a);for(c=a.length;d<c;d++)if(a[d].getAttribute&&(g=a[d].getAttribute("data-view-id"))&&(h=b[g])){h(a[d],g);delete b[g];a[d].removeAttribute("data-view-id")}f.extend(e.hookups,b)};f.fn.hookup=function(){var a=e.hookups;e.hookups=
{};t(this,a);return this};f.each(["prepend","append","after","before","text","html","replaceWith","val"],function(a,b){y(b)})})(jQuery);
(function(){function f(j,k){j="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+j.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%})/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/{%=(.+?)%}/g,"',$1,'").split("{%").join("');").split("%}").join("p.push('")+"');}return p.join('');";var n=new Function("obj",j);n.body=j;return k?n(k):n}$.View.register({suffix:"micro",renderer:function(j,k){var n=f(k);return function(e){return n(e)}},script:function(j,k){return"function(obj){"+
f(k).body+"}"}});jQuery.View.ext=".micro"})(jQuery);
