(function(r){var s={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},w=function(g,j,m){return g[j]!==undefined?g[j]:m&&(g[j]={})},A=function(g){var j=typeof g;return g&&(j=="function"||j=="object")},x,y=r.String=r.extend(r.String||{},{getObject:x=function(g,j,m){g=g?g.split(s.dot):[];var q=g.length,e,n,l,h=0;j=r.isArray(j)?j:[j||window];if(q==0)return j[0];for(;e=j[h++];){for(l=0;l<q-1&&A(e);l++)e=w(e,g[l],
m);if(A(e)){n=w(e,g[l],m);if(n!==undefined){m===false&&delete e[g[l]];return n}}}},capitalize:function(g){return g.charAt(0).toUpperCase()+g.substr(1)},camelize:function(g){g=y.classize(g);return g.charAt(0).toLowerCase()+g.substr(1)},classize:function(g,j){g=g.split(s.undHash);for(var m=0;m<g.length;m++)g[m]=y.capitalize(g[m]);return g.join(j||"")},niceName:function(g){return y.classize(g," ")},underscore:function(g){return g.replace(s.colons,"/").replace(s.words,"$1_$2").replace(s.lowUp,"$1_$2").replace(s.dash,
"_").toLowerCase()},sub:function(g,j,m){var q=[];m=typeof m=="boolean"?!m:m;q.push(g.replace(s.replacer,function(e,n){e=x(n,j,m);if(A(e)){q.push(e);return""}else return""+e}));return q.length<=1?q[0]:q},_regs:s})})(jQuery);
(function(r){var s=false,w=r.makeArray,A=r.isFunction,x=r.isArray,y=r.extend,g=r.String.getObject,j=function(e,n){return e.concat(w(n))},m=/xyz/.test(function(){})?/\b_super\b/:/.*/,q=function(e,n,l){l=l||e;for(var h in e)l[h]=A(e[h])&&A(n[h])&&m.test(e[h])?function(z,v){return function(){var t=this._super,o;this._super=n[z];o=v.apply(this,arguments);this._super=t;return o}}(h,e[h]):e[h]};clss=r.Class=function(){arguments.length&&clss.extend.apply(clss,arguments)};y(clss,{proxy:function(e){var n=
w(arguments),l;e=n.shift();x(e)||(e=[e]);l=this;return function(){for(var h=j(n,arguments),z,v=e.length,t=0,o;t<v;t++)if(o=e[t]){if((z=typeof o=="string")&&l._set_called)l.called=o;h=(z?l[o]:o).apply(l,h||[]);if(t<v-1)h=!x(h)||h._use_call?[h]:h}return h}},newInstance:function(){var e=this.rawInstance(),n;if(e.setup)n=e.setup.apply(e,arguments);if(e.init)e.init.apply(e,x(n)?n:arguments);return e},setup:function(e){this.defaults=y(true,{},e.defaults,this.defaults);return arguments},rawInstance:function(){s=
true;var e=new this;s=false;return e},extend:function(e,n,l){function h(){if(!s)return this.constructor!==h&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof e!="string"){l=n;n=e;e=null}if(!l){l=n;n=null}l=l||{};var z=this,v=this.prototype,t,o,B,a;s=true;a=new this;s=false;q(l,v,a);for(t in this)if(this.hasOwnProperty(t))h[t]=this[t];q(n,this,h);if(e){B=e.split(/\./);o=B.pop();B=v=g(B.join("."),window,true);v[o]=
h}y(h,{prototype:a,namespace:B,shortName:o,constructor:h,fullName:e});h.prototype.Class=h.prototype.constructor=h;o=h.setup.apply(h,j([z],arguments));if(h.init)h.init.apply(h,o||j([z],arguments));return h}});clss.callback=clss.prototype.callback=clss.prototype.proxy=clss.proxy})(jQuery);
(function(){var r=$.String,s=r.getObject,w=r.underscore,A=r.classize,x=$.isArray,y=$.makeArray,g=$.extend,j=$.each,m=function(a,b,c){$.event.trigger(b,c,a,true)},q=function(a,b,c,d,i,f,k){if(typeof a=="string"){var p=a.indexOf(" ");a=p>-1?{url:a.substr(p+1),type:a.substr(0,p)}:{url:a}}a.data=typeof b=="object"&&!x(b)?g(a.data||{},b):b;a.url=r.sub(a.url,a.data,true);return $.ajax(g({type:f||"post",dataType:k||"json",fixture:i,success:c,error:d},a))},e=function(a,b,c){var d=w(a.shortName),i="-"+d+(b||
"");return $.fixture&&$.fixture[i]?i:c||"//"+w(a.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+d+(b||"")+".json"},n=function(a,b,c){b=b||{};a=a.id;if(b[a]&&b[a]!==c){b["new"+r.capitalize(c)]=b[a];delete b[a]}b[a]=c;return b},l=function(a){return new (a||$.Model.List||Array)},h=function(a){return a[a.constructor.id]},z=function(a){var b=[];j(a,function(c,d){if(!d["__u Nique"]){b.push(d);d["__u Nique"]=1}});return j(b,function(c,d){delete d["__u Nique"]})},v=function(a,b,c,d,
i){var f=$.Deferred(),k=[a.serialize(),function(C){a[i||b+"d"](C);f.resolveWith(a,[a,C,b])},function(C){f.rejectWith(a,[C])}],p=a.constructor,u,D=f.promise();b=="destroy"&&k.shift();b!=="create"&&k.unshift(h(a));f.then(c);f.fail(d);if((u=p[b].apply(p,k))&&u.abort)D.abort=function(){u.abort()};return D},t=function(a){return typeof a==="object"&&a!==null&&a},o=function(a){return function(){return $.fn[a].apply($([this]),arguments)}},B=o("bind");o=o("unbind");ajaxMethods={create:function(a){return function(b,
c,d){return q(a||this._shortName,b,c,d,e(this,"Create","-restCreate"))}},update:function(a){return function(b,c,d,i){return q(a||this._shortName+"/{"+this.id+"}",n(this,c,b),d,i,e(this,"Update","-restUpdate"),"put")}},destroy:function(a){return function(b,c,d){var i={};i[this.id]=b;return q(a||this._shortName+"/{"+this.id+"}",i,c,d,e(this,"Destroy","-restDestroy"),"delete")}},findAll:function(a){return function(b,c,d){return q(a||this._shortName,b,c,d,e(this,"s"),"get","json "+this._shortName+".models")}},
findOne:function(a){return function(b,c,d){return q(a||this._shortName+"/{"+this.id+"}",b,c,d,e(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this,c=this.fullName;j(["attributes","validations"],function(i,f){if(!b[f]||a[f]===b[f])b[f]={}});j(["convert","serialize"],function(i,f){if(a[f]!=b[f])b[f]=g({},a[f],b[f])});this._fullName=w(c.replace(/\./g,"_"));this._shortName=w(this.shortName);if(c.indexOf("jQuery")!=0){if(this.listType)this.list=new this.listType([]);
j(ajaxMethods,function(i,f){var k=b[i];if(typeof k!=="function")b[i]=f(k)});c={};var d="* "+this._shortName+".model";c[d+"s"]=this.proxy("models");c[d]=this.proxy("model");$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return new this(t(a[this._shortName])||t(a.data)||t(a.attributes)||a)},models:function(a){if(!a)return null;var b=l(this.List),c=x(a),d=$.Model.List;d=d&&a instanceof d;for(var i=(d=c?a:d?a.serialize():a.data)?d.length:
null,f=0;f<i;f++)b.push(this.model(d[f]));c||j(a,function(k,p){if(k!=="data")b[k]=p});return b},id:"id",addAttr:function(a,b){var c=this.attributes;c[a]||(c[a]=b);return b},convert:{date:function(a){var b=typeof a;return b==="string"?isNaN(Date.parse(a))?null:Date.parse(a):b==="number"?new Date(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a==="false"?0:a)},"default":function(a,b,c){b=s(c);var d=window;if(c.indexOf(".")>=0){c=c.substring(0,c.lastIndexOf("."));
d=s(c)}return typeof b=="function"?b.call(d,a):a}},serialize:{"default":function(a){return t(a)&&a.serialize?a.serialize():a},date:function(a){return a&&a.getTime()}},bind:B,unbind:o,_ajax:q},{setup:function(a){this._init=true;this.attrs(g({},this.constructor.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=x(a)?a:y(arguments);var b={},c=this,d=function(f,k){j(k,function(p,u){if(p=u.call(c)){b[f]||(b[f]=[]);b[f].push(p)}})},i=this.constructor.validations;
j(a||i||{},function(f,k){if(typeof f=="number"){f=k;k=i[f]}d(f,k||[])});return $.isEmptyObject(b)?null:b},attr:function(a,b,c,d){var i=A(a),f="get"+i;if(b!==undefined){i="set"+i;f=this[a];var k=this,p=function(u){d&&d.call(k,u);m(k,"error."+a,u)};if(this[i]&&(b=this[i](b,this.proxy("_updateProperty",a,b,f,c,p),p))===undefined)return;this._updateProperty(a,b,f,c,p);return this}return this[f]?this[f]():this[a]},bind:B,unbind:o,_updateProperty:function(a,b,c,d,i){var f=this.constructor,k=f.attributes[a]||
f.addAttr(a,"string"),p=f.convert[k]||f.convert["default"],u=null,D="",C="updated.";d=d;var E=f.list;b=this[a]=b===null?null:p.call(f,b,function(){},k);this._init||(u=this.errors(a));k=[b];p=[a,b,c];if(u){D=C="error.";d=i;p.splice(1,0,u);k.unshift(u)}if(c!==b&&!this._init){!u&&m(this,D+a,k);m(this,C+"attr",p)}d&&d.apply(this,k);if(a===f.id&&b!==null&&E)if(c){if(c!=b){E.remove(c);E.push(this)}}else E.push(this)},removeAttr:function(a){var b=this[a],c=false,d=this.constructor.attributes;this[a]&&delete this[a];
if(d[a]){delete d[a];c=true}!this._init&&c&&b&&m(this,"updated.attr",[a,null,b])},attrs:function(a){var b,c=this.constructor,d=c.attributes;if(a){c=c.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,a[c])}else{a={};for(b in d)if(d.hasOwnProperty(b))a[b]=this.attr(b)}return a},serialize:function(){var a=this.constructor,b=a.attributes,c,d,i={},f;attributes={};for(f in b)if(b.hasOwnProperty(f)){c=b[f];d=a.serialize[c]||a.serialize["default"];i[f]=d.call(a,this[f],c)}return i},isNew:function(){var a=
h(this);return a===undefined||a===null||a===""},save:function(a,b){return v(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return v(this,"destroy",a,b,"destroyed")},identity:function(){var a=h(this),b=this.constructor;return(b._fullName+"_"+(b.escapeIdentity?encodeURIComponent(a):a)).replace(/ /g,"_")},elements:function(a){var b=this.identity();if(this.constructor.escapeIdentity)b=b.replace(/([ #;&,.+*~\'%:"!^$[\]()=>|\/])/g,"\\$1");return $("."+b,a)},hookup:function(a){var b=this.constructor._shortName,
c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});j(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){var d=this.constructor;b==="destroyed"&&d.list&&d.list.remove(h(this));c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);m(this,b);m(d,b,this);return[this].concat(y(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){j($.data(this,"models")||{},function(d,i){b=b===undefined?i.constructor.List||null:
i.constructor.List===b?b:null;a.push(i)})});c=l(b);c.push.apply(c,z(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,arguments)[0]}})(jQuery);
