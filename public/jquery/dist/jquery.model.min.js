(function(q){var r={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},y=function(g,n,o){return g[n]!==undefined?g[n]:o&&(g[n]={})},z=function(g){return(g=typeof g)&&(g=="function"||g=="object")},x=function(g,n,o){g=g?g.split(r.dot):[];var v=g.length;n=q.isArray(n)?n:[n||window];var e,i,l,h=0;if(v==0)return n[0];for(;e=n[h++];){for(l=0;l<v-1&&z(e);l++)e=y(e,g[l],o);if(z(e)){i=y(e,g[l],o);if(i!==undefined){o===
false&&delete e[g[l]];return i}}}},s=q.String=q.extend(q.String||{},{getObject:x,capitalize:function(g){return g.charAt(0).toUpperCase()+g.substr(1)},camelize:function(g){g=s.classize(g);return g.charAt(0).toLowerCase()+g.substr(1)},classize:function(g,n){g=g.split(r.undHash);for(var o=0;o<g.length;o++)g[o]=s.capitalize(g[o]);return g.join(n||"")},niceName:function(g){return s.classize(g," ")},underscore:function(g){return g.replace(r.colons,"/").replace(r.words,"$1_$2").replace(r.lowUp,"$1_$2").replace(r.dash,
"_").toLowerCase()},sub:function(g,n,o){var v=[];v.push(g.replace(r.replacer,function(e,i){e=x(i,n,typeof o=="boolean"?!o:o);i=typeof e;if((i==="object"||i==="function")&&i!==null){v.push(e);return""}else return""+e}));return v.length<=1?v[0]:v},_regs:r})})(jQuery);
(function(q){var r=false,y=q.makeArray,z=q.isFunction,x=q.isArray,s=q.extend,g=q.String.getObject,n=function(e,i){return e.concat(y(i))},o=/xyz/.test(function(){})?/\b_super\b/:/.*/,v=function(e,i,l){l=l||e;for(var h in e)l[h]=z(e[h])&&z(i[h])&&o.test(e[h])?function(w,t){return function(){var u=this._super,a;this._super=i[w];a=t.apply(this,arguments);this._super=u;return a}}(h,e[h]):e[h]};clss=q.Class=function(){arguments.length&&clss.extend.apply(clss,arguments)};s(clss,{proxy:function(e){var i=
y(arguments),l;e=i.shift();x(e)||(e=[e]);l=this;return function(){for(var h=n(i,arguments),w,t=e.length,u=0,a;u<t;u++)if(a=e[u]){if((w=typeof a=="string")&&l._set_called)l.called=a;h=(w?l[a]:a).apply(l,h||[]);if(u<t-1)h=!x(h)||h._use_call?[h]:h}return h}},newInstance:function(){var e=this.rawInstance(),i;if(e.setup)i=e.setup.apply(e,arguments);if(e.init)e.init.apply(e,x(i)?i:arguments);return e},setup:function(e){this.defaults=s(true,{},e.defaults,this.defaults);return arguments},rawInstance:function(){r=
true;var e=new this;r=false;return e},extend:function(e,i,l){function h(){if(!r)return this.constructor!==h&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof e!="string"){l=i;i=e;e=null}if(!l){l=i;i=null}l=l||{};var w=this,t=this.prototype,u,a,b,c;r=true;c=new this;r=false;v(l,t,c);for(u in this)if(this.hasOwnProperty(u))h[u]=this[u];v(i,this,h);if(e){b=e.split(/\./);a=b.pop();b=t=g(b.join("."),window,true);t[a]=
h}s(h,{prototype:c,namespace:b,shortName:a,constructor:h,fullName:e});h.prototype.Class=h.prototype.constructor=h;w=h.setup.apply(h,n([w],arguments));if(h.init)h.init.apply(h,w||[]);return h}});clss.callback=clss.prototype.callback=clss.prototype.proxy=clss.proxy})(jQuery);
(function(){var q=$.String.underscore,r=$.String.classize,y=$.isArray,z=$.makeArray,x=$.extend,s=$.each,g=/GET|POST|PUT|DELETE/i,n=function(a,b,c,d,j,f,k){k=k||"json";var m="";if(typeof a=="string"){var p=a.indexOf(" ");if(p>2&&p<7){m=a.substr(0,p);if(g.test(m))f=m;else k=m;m=a.substr(p+1)}else m=a}typeof b=="object"&&!y(b)&&(b=x({},b));a=$.String.sub(m,b,true);return $.ajax({url:a,data:b,success:c,error:d,type:f||"post",dataType:k,fixture:j})},o=function(a,b){var c=q(this.shortName),d="-"+c+(a||
"");return $.fixture&&$.fixture[d]?d:b||"//"+q(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+c+(a||"")+".json"},v=function(a,b){a=a||{};var c=this.id;if(a[c]&&a[c]!==b){a["new"+$.String.capitalize(b)]=a[c];delete a[c]}a[c]=b;return a},e=function(a){return new (a||$.Model.List||Array)},i=function(a){return a[a.constructor.id]},l=function(a){for(var b=[],c=0;c<a.length;c++)if(!a[c]["__u Nique"]){b.push(a[c]);a[c]["__u Nique"]=true}for(c=0;c<b.length;c++)delete b[c]["__u Nique"];
return b},h=function(a,b,c,d,j){var f=$.Deferred(),k=[a.serialize(),function(p){a[j||b+"d"](p);f.resolveWith(a,[a,p,b])},function(p){f.rejectWith(a,[p])}],m=a.constructor;b=="destroy"&&k.shift();b!=="create"&&k.unshift(i(a));f.then(c);f.fail(d);m[b].apply(m,k);return f.promise()},w=function(a){return typeof a==="object"&&a!==null&&a},t=function(a){return function(){$.fn[a].apply($([this]),arguments);return this}},u=t("bind");t=t("unbind");ajaxMethods={create:function(a){return function(b,c,d){return n(a,
b,c,d,o.call(this,"Create","-restCreate"))}},update:function(a){return function(b,c,d,j){return n(a,v.call(this,c,b),d,j,o.call(this,"Update","-restUpdate"),"put")}},destroy:function(a){return function(b,c,d){var j={};j[this.id]=b;return n(a,j,c,d,o.call(this,"Destroy","-restDestroy"),"delete")}},findAll:function(a){return function(b,c,d){return n(a||this.shortName+"s.json",b,c,d,o.call(this,"s"),"get","json "+this._shortName+".models")}},findOne:function(a){return function(b,c,d){return n(a,b,c,
d,o.call(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this;s(["attributes","associations","validations"],function(j,f){if(!b[f]||a[f]===b[f])b[f]={}});s(["convert","serialize"],function(j,f){if(a[f]!=b[f])b[f]=x({},a[f],b[f])});this._fullName=q(this.fullName.replace(/\./g,"_"));this._shortName=q(this.shortName);if(this.fullName.substr(0,7)!="jQuery."){if(this.listType)this.list=new this.listType([]);for(var c in ajaxMethods)if(typeof this[c]!==
"function")this[c]=ajaxMethods[c](this[c]);c={};var d="* "+this._shortName+".model";c[d+"s"]=this.proxy("models");c[d]=this.proxy("model");$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return new this(w(a[this._shortName])||w(a.data)||w(a.attributes)||a)},models:function(a){if(!a)return null;var b=e(this.List),c=y(a),d=$.Model.List&&a instanceof $.Model.List;d=c?a:d?a.serialize():a.data;var j=d.length,f=0;for(b._use_call=true;f<
j;f++)b.push(this.model(d[f]));if(!c)for(var k in a)if(k!=="data")b[k]=a[k];return b},id:"id",addAttr:function(a,b){if(!this.associations[a]){this.attributes[a]||(this.attributes[a]=b);return b}},_models:{},publish:function(a,b){window.OpenAjax&&OpenAjax.hub.publish(this._shortName+"."+a,b)},guessType:function(){return"string"},convert:{date:function(a){var b=typeof a;return b==="string"?isNaN(Date.parse(a))?null:Date.parse(a):b==="number"?new Date(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a)},
"default":function(a,b,c){b=$.String.getObject(c);var d=window;if(c.indexOf(".")>=0){c=c.substring(0,c.lastIndexOf("."));d=$.String.getObject(c)}return typeof b=="function"?b.call(d,a):a}},serialize:{"default":function(a){return w(a)&&a.serialize?a.serialize():a}},bind:u,unbind:t,_ajax:n},{setup:function(a){this._init=true;this.attrs(x({},this.constructor.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=y(a)?a:z(arguments);var b=
{},c=this,d=function(k,m){s(m,function(p,A){if(p=A.call(c)){b.hasOwnProperty(k)||(b[k]=[]);b[k].push(p)}})},j=this.constructor.validations;s(a||j||{},function(k,m){if(typeof k=="number"){k=m;m=j[k]}d(k,m||[])});for(var f in b)if(b.hasOwnProperty(f))return b;return null},attr:function(a,b,c,d){var j=r(a),f="get"+j;if(b!==undefined){this._setProperty(a,b,c,d,j);return this}return this[f]?this[f]():this[a]},bind:u,unbind:t,_setProperty:function(a,b,c,d,j){j="set"+j;var f=this[a],k=this,m=function(p){d&&
d.call(k,p);$(k).triggerHandler("error."+a,p)};this[j]&&(b=this[j](b,this.proxy("_updateProperty",a,b,f,c,m),m))===undefined||this._updateProperty(a,b,f,c,m)},_updateProperty:function(a,b,c,d,j){var f=this.constructor,k=f.attributes[a]||f.addAttr(a,f.guessType(b)),m=f.convert[k]||f.convert["default"],p=null,A="",C="updated.";d=d;var B=f.list;b=this[a]=b===null?null:m.call(f,b,function(){},k);this._init||(p=this.errors(a));k=[b];m=[a,b,c];if(p){A=C="error.";d=j;m.splice(1,0,p);k.unshift(p)}if(c!==
b&&!this._init){!p&&$(this).triggerHandler(A+a,k);$(this).triggerHandler(C+"attr",m)}d&&d.apply(this,k);if(a===f.id&&b!==null&&B)if(c){if(c!=b){B.remove(c);B.push(this)}}else B.push(this)},removeAttr:function(a){var b=this[a],c=false,d=this.constructor.attributes;this[a]&&delete this[a];if(d[a]){delete d[a];c=true}!this._init&&c&&b&&$(this).triggerHandler("updated.attr",[a,null,b])},attrs:function(a){var b,c=this.constructor,d=c.attributes;if(a){c=c.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,
a[c])}else{a={};for(b in d)if(d.hasOwnProperty(b))a[b]=this.attr(b)}return a},serialize:function(){var a=this.constructor,b=a.attributes,c,d,j={},f;attributes={};for(f in b)if(b.hasOwnProperty(f)){c=b[f];d=a.serialize[c]||a.serialize["default"];j[f]=d(this[f],c)}return j},isNew:function(){var a=i(this);return a===undefined||a===null},save:function(a,b){return h(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return h(this,"destroy",a,b,"destroyed")},identity:function(){var a=i(this),
b=this.constructor;return(b._fullName+"_"+(b.escapeIdentity?encodeURIComponent(a):a)).replace(/ /g,"_")},elements:function(a){return $("."+this.identity(),a)},publish:function(a,b){this.constructor.publish(a,b||this)},hookup:function(a){var b=this.constructor._shortName,c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});s(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){var d=this.constructor;b==="destroyed"&&d.list&&d.list.remove(i(this));
c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);$(this).triggerHandler(b);this.publish(b,this);$([d]).triggerHandler(b,this);return[this].concat(z(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){s($.data(this,"models")||{},function(d,j){b=b===undefined?j.constructor.List||null:j.constructor.List===b?b:null;a.push(j)})});c=e(b);c.push.apply(c,l(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,
arguments)[0]}})(jQuery);
