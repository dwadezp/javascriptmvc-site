(function(n){var w=function(c){return c.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},y=n.makeArray,F=1,k=n.View=function(c,g,f,j){if(typeof f==="function"){j=f;f=undefined}var m=L(g);if(m.length){var a=n.Deferred();m.push(G(c,true));n.when.apply(n,m).then(function(e){var d=y(arguments),i=d.pop()[0];if(t(g))g=H(e);else for(var h in g)if(t(g[h]))g[h]=H(d.shift());d=i(g,f);a.resolve(d);j&&j(d)});return a.promise()}else{var b;m=typeof j==="function";a=G(c,m);if(m){b=a;a.done(function(e){j(e(g,f))})}else a.done(function(e){b=
e(g,f)});return b}},z=function(c,g){if(!c.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+g;},G=function(c,g){return n.ajax({url:c,dataType:"view",async:g})},t=function(c){return c&&n.isFunction(c.always)},L=function(c){var g=[];if(t(c))return[c];else for(var f in c)t(c[f])&&g.push(c[f]);return g},H=function(c){return n.isArray(c)&&c.length===3&&c[1]==="success"?c[0]:c};n.ajaxTransport("view",function(c,g){var f=g.url;c=f.match(/\.[\w\d]+$/);var j,m,a,b,e=function(i){i=
j.renderer(a,i);if(k.cache)k.cached[a]=i;return{view:i}};if(m=document.getElementById(f))c="."+m.type.match(/\/(x\-)?(.+)/)[2];if(!c){c=k.ext;f+=k.ext}a=w(f);if(f.match(/^\/\//)){var d=f.substr(2);f=typeof steal==="undefined"?(f="/"+d):steal.root.mapJoin(d)+""}j=k.types[c];return{send:function(i,h){if(k.cached[a])return h(200,"success",{view:k.cached[a]});else if(m)h(200,"success",e(m.innerHTML));else b=n.ajax({async:g.async,url:f,dataType:"text",error:function(){z("",f);h(404)},success:function(l){z(l,
f);h(200,"success",e(l))}})},abort:function(){b&&b.abort()}}});n.extend(k,{hookups:{},hookup:function(c){var g=++F;k.hookups[g]=c;return g},cached:{},cache:true,register:function(c){this.types["."+c.suffix]=c;window.steal&&steal.type(c.suffix+" view js",function(g,f){var j=k.types["."+g.type],m=w(g.rootSrc+"");g.text=j.script(m,g.text);f()})},types:{},ext:".ejs",registerScript:function(c,g,f){return"$.View.preload('"+g+"',"+k.types["."+c].script(g,f)+");"},preload:function(c,g){k.cached[c]=function(f,
j){return g.call(f,f,j)}}});window.steal&&steal.type("view js",function(c,g){var f=k.types["."+c.type],j=w(c.rootSrc+"");c.text="steal('"+(f.plugin||"jquery/view/"+c.type)+"').then(function($){$.View.preload('"+j+"',"+c.text+");\n})";g()});var I,x,J,C,u,D,q,A={val:true,text:true};I=function(c){var g=n.fn[c];n.fn[c]=function(){var f=y(arguments),j,m,a=this;if(t(f[0])){f[0].done(function(b){x.call(a,[b],g)});return this}else if(J(f)){if(j=D(f)){m=f[j];f[j]=function(b){x.call(a,[b],g);m.call(a,b)};k.apply(k,
f);return this}f=k.apply(k,f);if(t(f)){f.done(function(b){x.call(a,[b],g)});return this}else f=[f]}return A[c]?g.apply(this,f):x.call(this,f,g)}};x=function(c,g){var f;for(var j in k.hookups)break;if(j&&c[0]&&C(c[0])){f=k.hookups;k.hookups={};c[0]=n(c[0])}g=g.apply(this,c);f&&q(c[0],f);return g};J=function(c){var g=typeof c[1];return typeof c[0]=="string"&&(g=="object"||g=="function")&&!u(c[1])};u=function(c){return c.nodeType||c.jquery};C=function(c){if(u(c))return true;else if(typeof c==="string"){c=
n.trim(c);return c.substr(0,1)==="<"&&c.substr(c.length-1,1)===">"&&c.length>=3}else return false};D=function(c){return typeof c[3]==="function"?3:typeof c[2]==="function"&&2};q=function(c,g){var f,j=0,m,a;c=c.filter(function(){return this.nodeType!=3});c=c.add("[data-view-id]",c);for(f=c.length;j<f;j++)if(c[j].getAttribute&&(m=c[j].getAttribute("data-view-id"))&&(a=g[m])){a(c[j],m);delete g[m];c[j].removeAttribute("data-view-id")}n.extend(k.hookups,g)};n.fn.hookup=function(){var c=k.hookups;k.hookups=
{};q(this,c);return this};n.each(["prepend","append","after","before","text","html","replaceWith","val"],function(c,g){I(g)})})(jQuery);
(function(){function n(a,b,e,d){d={data:d||(b?b.data:{}),_wrap:b?b._wrap:null,tmpl:null,parent:b||null,nodes:[],calls:L,nest:H,wrap:I,html:x,update:J};a&&jQuery.extend(d,a,{nodes:[],parent:b});if(e){d.tmpl=e;d._ctnt=d._ctnt||d.tmpl(jQuery,d);d.key=++f;(m.length?A:q)[f]=d}return d}function w(a,b,e){var d;e=e?jQuery.map(e,function(i){return typeof i==="string"?a.key?i.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+u+'="'+a.key+'" $2'):i:w(i,a,i._ctnt)}):a;if(b)return e;e=e.join("");e.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(i,h,l,p){d=jQuery(l).get();t(d);if(h)d=y(h).concat(d);if(p)d=d.concat(y(p))});return d?d:y(e)}function y(a){var b=document.createElement("div");b.innerHTML=a;return jQuery.makeArray(b.childNodes)}function F(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+jQuery.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(b,e,d,i,h,l,p){b=jQuery.tmpl.tag[d];if(!b)throw"Template command not found: "+d;d=b._default||[];if(l&&!/\w$/.test(h)){h+=l;l=""}if(h){h=z(h);p=p?","+z(p)+")":l?")":"";p=l?h.indexOf(".")>-1?h+l:"("+h+").call($item"+p:h;l=l?p:"(typeof("+h+")==='function'?("+h+").call($item):("+h+"))"}else l=p=d.$1||"null";i=z(i);return"');"+b[e?"close":"open"].split("$notnull_1").join(h?"typeof("+h+")!=='undefined' && ("+h+")!=null":"true").split("$1a").join(l).split("$1").join(p).split("$2").join(i?i.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,
function(B,v,K,s){return(s=s?","+s+")":K?")":"")?"("+v+").call($item"+s:B}):d.$2||"")+"_.push('"})+"');}return _;")}function k(a,b){a._wrap=w(a,true,jQuery.isArray(b)?b:[D.test(b)?b:jQuery(b).html()]).join("")}function z(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function G(a){var b=document.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML}function t(a){function b(v){function K(M){M+=e;o=h[M]=h[M]||n(o,q[o.parent.key+e]||o.parent,null,true)}var s,r=v,o,E;
if(E=v.getAttribute(u)){for(;r.parentNode&&(r=r.parentNode).nodeType===1&&!(s=r.getAttribute(u)););if(s!==E){r=r.parentNode?r.nodeType===11?0:r.getAttribute(u)||0:0;if(!(o=q[E])){o=A[E];o=n(o,q[r]||A[r],null,true);o.key=++f;q[f]=o}j&&K(E)}v.removeAttribute(u)}else if(j&&(o=jQuery.data(v,"tmplItem"))){K(o.key);q[o.key]=o;r=(r=jQuery.data(v.parentNode,"tmplItem"))?r.key:0}if(o){for(s=o;s&&s.key!=r;){s.nodes.push(v);s=s.parent}delete o._ctnt;delete o._wrap;jQuery.data(v,"tmplItem",o)}}var e="_"+j,d,
i,h={},l,p,B;l=0;for(p=a.length;l<p;l++)if((d=a[l]).nodeType===1){i=d.getElementsByTagName("*");for(B=i.length-1;B>=0;B--)b(i[B]);b(d)}}function L(a,b,e,d){if(!a)return m.pop();m.push({_:a,tmpl:b,item:this,data:e,options:d})}function H(a,b,e){return jQuery.tmpl(jQuery.template(a),b,e,this)}function I(a,b){var e=a.options||{};e.wrapped=b;return jQuery.tmpl(jQuery.template(a.tmpl),a.data,e,a.item)}function x(a,b){var e=this._wrap;return jQuery.map(jQuery(jQuery.isArray(e)?e.join(""):e).filter(a||"*"),
function(d){return b?d.innerText||d.textContent:d.outerHTML||G(d)})}function J(){var a=this.nodes;jQuery.tmpl(null,null,null,this).insertBefore(a[0]);jQuery(a).remove()}var C=jQuery.fn.domManip,u="_tmplitem",D=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,q={},A={},c,g={key:0,data:{}},f=0,j=0,m=[];jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){jQuery.fn[a]=function(e){var d=[];e=jQuery(e);var i,h,l;i=this.length===1&&this[0].parentNode;
c=q||{};if(i&&i.nodeType===11&&i.childNodes.length===1&&e.length===1){e[b](this[0]);d=this}else{h=0;for(l=e.length;h<l;h++){j=h;i=(h>0?this.clone(true):this).get();jQuery.fn[b].apply(jQuery(e[h]),i);d=d.concat(i)}j=0;d=this.pushStack(d,a,e.selector)}e=c;c=null;jQuery.tmpl.complete(e);return d}});jQuery.fn.extend({tmpl:function(a,b,e){return jQuery.tmpl(this[0],a,b,e)},tmplItem:function(){return jQuery.tmplItem(this[0])},template:function(a){return jQuery.template(a,this[0])},domManip:function(a,b,
e){if(a[0]&&a[0].nodeType){for(var d=jQuery.makeArray(arguments),i=a.length,h=0,l;h<i&&!(l=jQuery.data(a[h++],"tmplItem")););if(i>1)d[0]=[jQuery.makeArray(a)];if(l&&j)d[2]=function(p){jQuery.tmpl.afterManip(this,p,e)};C.apply(this,d)}else C.apply(this,arguments);j=0;c||jQuery.tmpl.complete(q);return this}});jQuery.extend({tmpl:function(a,b,e,d){var i=!d;if(i){d=g;a=jQuery.template[a]||jQuery.template(null,a);A={}}else if(!a){a=d.tmpl;q[d.key]=d;d.nodes=[];d.wrapped&&k(d,d.wrapped);return jQuery(w(d,
null,d.tmpl(jQuery,d)))}if(!a)return[];if(typeof b==="function")b=b.call(d||{});e&&e.wrapped&&k(e,e.wrapped);b=jQuery.isArray(b)?jQuery.map(b,function(h){return h?n(e,d,a,h):null}):[n(e,d,a,b)];return i?jQuery(w(d,null,b)):b},tmplItem:function(a){var b;if(a instanceof jQuery)a=a[0];for(;a&&a.nodeType===1&&!(b=jQuery.data(a,"tmplItem"))&&(a=a.parentNode););return b||g},template:function(a,b){if(b){if(typeof b==="string")b=F(b);else if(b instanceof jQuery)b=b[0]||{};if(b.nodeType)b=jQuery.data(b,"tmpl")||
jQuery.data(b,"tmpl",F(b.innerHTML));return typeof a==="string"?(jQuery.template[a]=b):b}return a?typeof a!=="string"?jQuery.template(null,a):jQuery.template[a]||jQuery.template(null,D.test(a)?a:jQuery(a)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});jQuery.extend(jQuery.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",
close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){q={}},afterManip:function(a,b,e){var d=b.nodeType===11?jQuery.makeArray(b.childNodes):
b.nodeType===1?[b]:[];e.call(a,b);t(d);j++}});$.View.register({suffix:"tmpl",renderer:function(a,b){var e=$.template(null,b);return function(d){return e.call($,$,{data:d}).join("")}},script:function(a,b){return"function(data){return ("+$.template(null,b)+").call(jQuery, jQuery, {data: data}).join(''); }"}});jQuery.View.ext=".tmpl"})(jQuery);
