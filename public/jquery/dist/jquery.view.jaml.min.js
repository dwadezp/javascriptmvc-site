(function(b){var e=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},j=b.makeArray,q=1,f=b.View=function(a,c,d,g){if(typeof d==="function"){g=d;d=undefined}var h=C(c);if(h.length){var i=b.Deferred();h.push(n(a,true));b.when.apply(b,h).then(function(o){var p=j(arguments),r=p.pop()[0];if(k(c))c=w(o);else for(var s in c)if(k(c[s]))c[s]=w(p.shift());p=r(c,d);i.resolve(p);g&&g(p)});return i.promise()}else{var l;h=typeof g==="function";i=n(a,h);if(h){l=i;i.done(function(o){g(o(c,d))})}else i.done(function(o){l=
o(c,d)});return l}},m=function(a,c){if(!a.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+c;},n=function(a,c){return b.ajax({url:a,dataType:"view",async:c})},k=function(a){return a&&b.isFunction(a.always)},C=function(a){var c=[];if(k(a))return[a];else for(var d in a)k(a[d])&&c.push(a[d]);return c},w=function(a){return b.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a};b.ajaxTransport("view",function(a,c){var d=c.url;a=d.match(/\.[\w\d]+$/);var g,h,i,l,o=function(r){r=
g.renderer(i,r);if(f.cache)f.cached[i]=r;return{view:r}};if(h=document.getElementById(d))a="."+h.type.match(/\/(x\-)?(.+)/)[2];if(!a){a=f.ext;d+=f.ext}i=e(d);if(d.match(/^\/\//)){var p=d.substr(2);d=typeof steal==="undefined"?(d="/"+p):steal.root.mapJoin(p)+""}g=f.types[a];return{send:function(r,s){if(f.cached[i])return s(200,"success",{view:f.cached[i]});else if(h)s(200,"success",o(h.innerHTML));else l=b.ajax({async:c.async,url:d,dataType:"text",error:function(){m("",d);s(404)},success:function(x){m(x,
d);s(200,"success",o(x))}})},abort:function(){l&&l.abort()}}});b.extend(f,{hookups:{},hookup:function(a){var c=++q;f.hookups[c]=a;return c},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a;window.steal&&steal.type(a.suffix+" view js",function(c,d){var g=f.types["."+c.type],h=e(c.rootSrc+"");c.text=g.script(h,c.text);d()})},types:{},ext:".ejs",registerScript:function(a,c,d){return"$.View.preload('"+c+"',"+f.types["."+a].script(c,d)+");"},preload:function(a,c){f.cached[a]=function(d,
g){return c.call(d,d,g)}}});window.steal&&steal.type("view js",function(a,c){var d=f.types["."+a.type],g=e(a.rootSrc+"");a.text="steal('"+(d.plugin||"jquery/view/"+a.type)+"').then(function($){$.View.preload('"+g+"',"+a.text+");\n})";c()});var y,t,z,A,u,B,v,D={val:true,text:true};y=function(a){var c=b.fn[a];b.fn[a]=function(){var d=j(arguments),g,h,i=this;if(k(d[0])){d[0].done(function(l){t.call(i,[l],c)});return this}else if(z(d)){if(g=B(d)){h=d[g];d[g]=function(l){t.call(i,[l],c);h.call(i,l)};f.apply(f,
d);return this}d=f.apply(f,d);if(k(d)){d.done(function(l){t.call(i,[l],c)});return this}else d=[d]}return D[a]?c.apply(this,d):t.call(this,d,c)}};t=function(a,c){var d;for(var g in f.hookups)break;if(g&&a[0]&&A(a[0])){d=f.hookups;f.hookups={};a[0]=b(a[0])}c=c.apply(this,a);d&&v(a[0],d);return c};z=function(a){var c=typeof a[1];return typeof a[0]=="string"&&(c=="object"||c=="function")&&!u(a[1])};u=function(a){return a.nodeType||a.jquery};A=function(a){if(u(a))return true;else if(typeof a==="string"){a=
b.trim(a);return a.substr(0,1)==="<"&&a.substr(a.length-1,1)===">"&&a.length>=3}else return false};B=function(a){return typeof a[3]==="function"?3:typeof a[2]==="function"&&2};v=function(a,c){var d,g=0,h,i;a=a.filter(function(){return this.nodeType!=3});a=a.add("[data-view-id]",a);for(d=a.length;g<d;g++)if(a[g].getAttribute&&(h=a[g].getAttribute("data-view-id"))&&(i=c[h])){i(a[g],h);delete c[h];a[g].removeAttribute("data-view-id")}b.extend(f.hookups,c)};b.fn.hookup=function(){var a=f.hookups;f.hookups=
{};v(this,a);return this};b.each(["prepend","append","after","before","text","html","replaceWith","val"],function(a,c){y(c)})})(jQuery);
(function(){Jaml=function(){return{templates:{},helpers:{},register:function(b,e){this.templates[b]=e},render:function(b,e){return(new Jaml.Template(this.templates[b])).render(e)},registerHelper:function(b,e){this.helpers[b]=e}}}();Jaml.Node=function(b){this.tagName=b;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(b){for(var e in b)this.attributes[e=="cls"?"class":e]=b[e]},addChild:function(b){this.children.push(b)},render:function(b){b=b||0;var e=[],j=[],q=this instanceof
Jaml.TextNode,f=this.multiLineTag();for(var m in this.attributes)j.push(m+"="+this.attributes[m]);q||e.push(this.getPadding(b));e.push("<"+this.tagName);for(m in this.attributes)e.push(" "+m+'="'+this.attributes[m]+'"');if(this.isSelfClosing())e.push(" />\n");else{e.push(">");f&&e.push("\n");for(j=0;j<this.children.length;j++)e.push(this.children[j].render(b+2));f&&e.push(this.getPadding(b));e.push("</",this.tagName,">\n")}return e.join("")},multiLineTag:function(){var b=this.children.length,e=b>
0;if(b==1&&this.children[0]instanceof Jaml.TextNode)e=false;return e},getPadding:function(b){return(new Array(b+1)).join(" ")},isSelfClosing:function(){for(var b=false,e=this.selfClosingTags.length-1;e>=0;e--)if(this.tagName==this.selfClosingTags[e])b=true;return b},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(b){this.text=b};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(b){this.tpl=b;this.nodes=[]};Jaml.Template.prototype={render:function(b){b=
b||{};if(b.constructor.toString().indexOf("Array")==-1)b=[b];with(this)for(var e=0;e<b.length;e++)eval("("+this.tpl.toString()+")(data[i])");b=this.getRoots();var j="";for(e=0;e<b.length;e++)j+=b[e].render();return j},getRoots:function(){for(var b=[],e=0;e<this.nodes.length;e++){var j=this.nodes[e];j.parent==undefined&&b.push(j)}return b},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var b=Jaml.Template.prototype.tags,e=b.length-1;e>=0;e--){var j=b[e];Jaml.Template.prototype[j]=function(q){return function(f){var m=new Jaml.Node(q),n=typeof f=="object"&&!(f instanceof Jaml.Node)&&!(f instanceof Jaml.TextNode);n&&m.setAttributes(f);for(n=n?1:0;n<arguments.length;n++){var k=arguments[n];if(typeof k=="string"||k==undefined)k=new Jaml.TextNode(k||"");if(k instanceof Jaml.Node||k instanceof Jaml.TextNode)k.parent=
m;m.addChild(k)}this.nodes.push(m);return m}}(j)}})();$.View.register({suffix:"jaml",script:function(b,e){return"((function(){ Jaml.register("+b+", "+e+"); return function(data){return Jaml.render("+b+", data)} })())"},renderer:function(b,e){var j;eval("func = ("+e+")");Jaml.register(b,j);return function(q){return Jaml.render(b,q)}}})})(jQuery);
