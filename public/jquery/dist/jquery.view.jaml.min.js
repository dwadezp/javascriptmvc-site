(function(b){var d=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},k=1,f,n,l,m=function(a){return a&&b.isFunction(a.always)},o=function(a){var c=[];if(m(a))return[a];else for(var e in a)m(a[e])&&c.push(a[e]);return c},x=function(a){return b.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a};f=b.View=function(a,c,e,g){if(typeof e==="function"){g=e;e=undefined}var h=o(c);if(h.length){var i=b.Deferred();h.push(l(a,true));b.when.apply(b,h).then(function(p){var q=b.makeArray(arguments),
r=q.pop()[0];if(m(c))c=x(p);else for(var s in c)if(m(c[s]))c[s]=x(q.shift());q=r(c,e);i.resolve(q);g&&g(q)});return i.promise()}else{var j;h=typeof g==="function";i=l(a,h);if(h){j=i;i.done(function(p){g(p(c,e))})}else i.done(function(p){j=p(c,e)});return j}};n=function(a,c){if(!a.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+c;};l=function(a,c){return b.ajax({url:a,dataType:"view",async:c})};b.ajaxTransport("view",function(a,c){a=c.url;var e=a.match(/\.[\w\d]+$/),
g,h,i,j=a,p,q=function(r){r=g.renderer(i,r);if(f.cache)f.cached[i]=r;return{view:r}};if(h=document.getElementById(a))e=h.type.match(/\/[\d\w]+$/)[0].replace(/^\//,".");if(!e){e=f.ext;j+=f.ext}i=d(j);if(j.match(/^\/\//))j=typeof steal==="undefined"?"/"+j.substr(2):steal.root.mapJoin(j.substr(2));g=f.types[e];return{send:function(r,s){if(f.cached[i])return s(200,"success",{view:f.cached[i]});else if(h)s(200,"success",q(h.innerHTML));else p=b.ajax({async:c.async,url:j,dataType:"text",error:function(){n("",
j);s(404)},success:function(y){n(y,j);s(200,"success",q(y))}})},abort:function(){p&&p.abort()}}});b.extend(f,{hookups:{},hookup:function(a){var c=++k;f.hookups[c]=a;return c},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a;window.steal&&steal.type(a.suffix+" view js",function(c,e,g){e=f.types["."+c.type];var h=d(c.rootSrc);c.text=e.script(h,c.text);g()})},types:{},ext:".ejs",registerScript:function(a,c,e){return"$.View.preload('"+c+"',"+f.types["."+a].script(c,e)+");"},preload:function(a,
c){f.cached[a]=function(e,g){return c.call(e,e,g)}}});window.steal&&steal.type("view js",function(a,c,e){c=f.types["."+a.type];var g=d(a.rootSrc);a.text="steal('"+(c.plugin||"jquery/view/"+a.type)+"').then(function($){$.View.preload('"+g+"',"+a.text+");\n})";e()});var z,t,A,B,C,u,v;z=function(a){var c=b.fn[a];b.fn[a]=function(){var e=b.makeArray(arguments),g,h,i=this;if(m(e[0])){e[0].done(function(j){t.call(i,[j],c)});return this}else if(A(e)){if(g=C(e)){h=e[g];e[g]=function(j){t.call(i,[j],c);h.call(i,
j)};f.apply(f,e);return this}e=f.apply(f,e);if(m(e)){e.done(function(j){t.call(i,[j],c)});return this}else e=[e]}return t.call(this,e,c)}};t=function(a,c){var e;for(var g in f.hookups)break;if(g&&a[0]&&B(a[0])){e=f.hookups;f.hookups={};a[0]=b(a[0])}c=c.apply(this,a);e&&u(a[0],e);return c};A=function(a){var c=typeof a[1];return typeof a[0]=="string"&&(c=="object"||c=="function")&&!a[1].nodeType&&!a[1].jquery};B=function(a){if(a.jquery||a.nodeType===1)return true;else if(typeof a==="string"){a=b.trim(a);
return a.substr(0,1)==="<"&&a.substr(a.length-1,1)===">"&&a.length>=3}else return false};C=function(a){return typeof a[3]==="function"?3:typeof a[2]==="function"&&2};u=function(a,c){var e,g=0,h,i;a=a.filter(function(){return this.nodeType!=3});a=a.add("[data-view-id]",a);for(e=a.length;g<e;g++)if(a[g].getAttribute&&(h=a[g].getAttribute("data-view-id"))&&(i=c[h])){i(a[g],h);delete c[h];a[g].removeAttribute("data-view-id")}b.extend(f.hookups,c)};b.fn.hookup=function(){var a=f.hookups;f.hookups={};u(this,
a);return this};v=["prepend","append","after","before","text","html","replaceWith","val"];for(var w=0;w<v.length;w++)z(v[w])})(jQuery);
(function(){Jaml=function(){return{templates:{},helpers:{},register:function(b,d){this.templates[b]=d},render:function(b,d){return(new Jaml.Template(this.templates[b])).render(d)},registerHelper:function(b,d){this.helpers[b]=d}}}();Jaml.Node=function(b){this.tagName=b;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(b){for(var d in b)this.attributes[d=="cls"?"class":d]=b[d]},addChild:function(b){this.children.push(b)},render:function(b){b=b||0;var d=[],k=[],f=this instanceof
Jaml.TextNode,n=this.multiLineTag();for(var l in this.attributes)k.push(l+"="+this.attributes[l]);f||d.push(this.getPadding(b));d.push("<"+this.tagName);for(l in this.attributes)d.push(" "+l+'="'+this.attributes[l]+'"');if(this.isSelfClosing())d.push(" />\n");else{d.push(">");n&&d.push("\n");for(k=0;k<this.children.length;k++)d.push(this.children[k].render(b+2));n&&d.push(this.getPadding(b));d.push("</",this.tagName,">\n")}return d.join("")},multiLineTag:function(){var b=this.children.length,d=b>
0;if(b==1&&this.children[0]instanceof Jaml.TextNode)d=false;return d},getPadding:function(b){return(new Array(b+1)).join(" ")},isSelfClosing:function(){for(var b=false,d=this.selfClosingTags.length-1;d>=0;d--)if(this.tagName==this.selfClosingTags[d])b=true;return b},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(b){this.text=b};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(b){this.tpl=b;this.nodes=[]};Jaml.Template.prototype={render:function(b){b=
b||{};if(b.constructor.toString().indexOf("Array")==-1)b=[b];with(this)for(var d=0;d<b.length;d++)eval("("+this.tpl.toString()+")(data[i])");b=this.getRoots();var k="";for(d=0;d<b.length;d++)k+=b[d].render();return k},getRoots:function(){for(var b=[],d=0;d<this.nodes.length;d++){var k=this.nodes[d];k.parent==undefined&&b.push(k)}return b},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var b=Jaml.Template.prototype.tags,d=b.length-1;d>=0;d--){var k=b[d];Jaml.Template.prototype[k]=function(f){return function(n){var l=new Jaml.Node(f),m=typeof n=="object"&&!(n instanceof Jaml.Node)&&!(n instanceof Jaml.TextNode);m&&l.setAttributes(n);for(m=m?1:0;m<arguments.length;m++){var o=arguments[m];if(typeof o=="string"||o==undefined)o=new Jaml.TextNode(o||"");if(o instanceof Jaml.Node||o instanceof Jaml.TextNode)o.parent=
l;l.addChild(o)}this.nodes.push(l);return l}}(k)}})();$.View.register({suffix:"jaml",script:function(b,d){return"((function(){ Jaml.register("+b+", "+d+"); return function(data){return Jaml.render("+b+", data)} })())"},renderer:function(b,d){var k;eval("func = ("+d+")");Jaml.register(b,k);return function(f){return Jaml.render(b,f)}}})})(jQuery);
