<head>
	<title>JavaScriptMVC</title>
	<link rel="stylesheet" type="text/css" href="../documentjs/jmvcdoc/style.css">
	<link rel="shortcut icon" href="../documentjs/jmvcdoc/images/favicon.ico">
<link rel="stylesheet" href="file:////opt/local/share/java/tomcat6/webapps/jmvc31/jmvcdoc/style.css" type="text/css"></head><body>
<div id="documentation">
	<div id="top">
		<div class="topCorner">
			<div class="right"></div>
			<div class="left"></div>
		</div>
		<div class="content">
			<div id="searchRoundCorners">
				<input id="search" type="input" class="jmvcdoc_search">
			</div>
			<div id="defaults">
				<ul id="menu" class="ui-menu">
					<li class="ui-menu-item">
						<a class="menuLink" href="#&amp;search=core"><span class="menuSpan">Core</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="#favorites"><span class="menuSpan">Favorites</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../follow.html" title="Follow"><span class="menuSpan red">Follow</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../contribute.html" title="Contribute"><span class="menuSpan red">Contribute</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../code.html" title="Code"><span class="menuSpan red">Code</span></a>
					</li>
				</ul>
			</div>
			<div class="logo-text"><a href="http://javascriptmvc.com"><img src="../documentjs/jmvcdoc/images/logo80x30.png" class="logo-image"></a></div>
		</div>
		<div class="bottomCorner">
			<div>&nbsp;</div>
		</div>
	</div>
	<div id="bottom">
		<div id="nav" class="jmvcdoc_nav">


	<div id="selected">
		    
				
		<div class="content">
			    <a href="#!" class="selected choice page" style="padding-left: 20px">
			    	
					JavaScriptMVC
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!tutorials" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					Tutorials and Guides
					
				</a>
				
		</div>
			
			
	</div>

<div id="results" style="display: block">
	<div class="content">
	    
			
		    <a href="#!installing" class="result choice page" style="padding-left: 20px">
		    	Installing JavaScriptMVC
			</a>
			
		
			
		    <a href="#!getstarted" class="result choice page" style="padding-left: 20px">
		    	Getting Started
			</a>
			
		
			
		    <a href="#!mvc" class="result choice page" style="padding-left: 20px">
		    	The MVC in JavaScriptMVC
			</a>
			
		
			
		    <a href="#!ajaxy" class="result choice page open" style="padding-left: 20px">
		    	Searchable Ajax Apps
			</a>
			
		
			
		    <a href="#!organizing" class="result choice page" style="padding-left: 20px">
		    	Organizing Your App
			</a>
			
		
			
		    <a href="#!funcunit.getstarted" class="result choice page" style="padding-left: 20px">
		    	Get Started with FuncUnit
			</a>
			
		
			
		    <a href="#!services" class="result choice page" style="padding-left: 20px">
		    	Ajax Service Guidelines
			</a>
			
		
	</div>
</div>


</div>
		<div id="doc_container">
			<div id="doc" class="jmvcdoc_content">
<div class="top">
	<div class="content">
	    <h1>Searchable Ajax Apps&nbsp;
	    	<span class="page type"><span class="typeEnd">page</span></span>&nbsp;
	    	<span class="favorite favoriteoff">&nbsp;&nbsp;&nbsp;</span></h1>
	    
	    
	    
		
		
	</div>
</div>


<p>This tutorial walks you through building a simple widget
that listens for changes in the browser location hash
and updates the content of the page.  It demonstrates how to make
a site Google crawlable and searchable.</p>

<h2>The App</h2>

<p>We'll make a mini app that updates the contents of page with an
Ajax request when a user clicks on a navigation link. Then, we'll make this searchable
with the <code>ajaxy/scripts/crawl.js</code> script.</p>

<div class="demo_wrapper demo" data-demo-src="tutorials/ajaxy/ajaxy.html"><div class="demo">
  <h3 class="demo_header header reset">
    <span class="ui-icon ui-icon-triangle-1-s"></span>
    <a href="javascript://">Demo</a>
  </h3>
  <div class="demo_content content" style="padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; height: 109px; ">
    <iframe height="100%" frameborder="0" src="file:////opt/local/share/java/tomcat6/webapps/jmvc31/tutorials/ajaxy/ajaxy.html" style="height: 104px; "></iframe>
  </div>
  <h3 class="html_header header reset">
    <span class="ui-icon ui-icon-triangle-1-e"></span>
    <a href="javascript://">HTML</a>
  </h3>
  <div class="html_content content" style="display: none"><pre><code class="html"></code></pre></div>
  <h3 class="source_header header reset">
    <span class="ui-icon ui-icon-triangle-1-e"></span>
    <a href="javascript://">Source</a>
  </h3>
  <div class="source_content content" style="display: none"><pre><code class="javascript"></code></pre></div>
</div>

</div>

<p>The crawl script generates html pages that Google can use as a representation
of the content of an Ajax application.  Read Google's documentation on its
<a href="http://code.google.com/web/ajaxcrawling/docs/getting-started.html">Ajax crawling API</a>
 before continuing this tutorial.</p>

<h2>Setup</h2>

<p><a href="#!installing">Download and install</a> the latest version of JavaScriptMVC.</p>

<p>After installing JavaScriptMVC, open a command line to 
the <a href="#!steal.static.root">steal.root</a> folder (where you unzipped 
JavaScriptMVC).  </p>

<p>We'll use the application generator to generate an application
skeleton folder.  Run:</p>

<pre><code class=" javascript">js jquery/generate/app ajaxy
</code></pre>

<h2>The Code</h2>

<p>In the generated ajaxy folder, you'll find <code>ajaxy.html</code>
and <code>ajaxy.js</code>.  We'll add a content area
and few links to 
<code>ajaxy.html</code>.  When we click on  links,
we'll make <code>ajaxy.js</code> load content into
the content area.</p>

<p>Change <code>ajaxy.html</code> so it looks like:</p>

<pre><code class="xml"><span class="tag">&lt;!DOCTYPE HTML&gt;</span>
<span class="tag">&lt;<span class="title">html</span><span class="attribute"> lang=<span class="value">"en"</span></span>&gt;</span>
    <span class="tag">&lt;<span class="title">head</span>&gt;</span>
        <span class="tag">&lt;<span class="title">title</span>&gt;</span>Ajaxy<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span><span class="attribute"> name=<span class="value">"fragment"</span></span><span class="attribute"> content=<span class="value">"!"</span></span>&gt;</span>
    <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">body</span>&gt;</span>
        <span class="tag">&lt;a<span class="attribute"> href=<span class="value">'#!videos'</span></span>&gt;</span>Videos<span class="tag">&lt;/a&gt;</span>
        <span class="tag">&lt;a<span class="attribute"> href=<span class="value">'#!articles'</span></span>&gt;</span>Articles<span class="tag">&lt;/a&gt;</span>
        <span class="tag">&lt;a<span class="attribute"> href=<span class="value">'#!images'</span></span>&gt;</span>Images<span class="tag">&lt;/a&gt;</span>
        <span class="tag">&lt;<span class="title">div</span><span class="attribute"> id=<span class="value">'content'</span></span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span><span class="attribute"> type=<span class="value">'text/javascript'</span></span> 
           <span class="attribute"> src=<span class="value">'../steal/steal.js?ajaxy,development'</span></span>&gt;</span>     
        <span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>

<p>Notice that the page includes a <code>&lt;meta name="fragment" content="!"&gt;</code>
tag.  This tells to Google to process <code>ajaxy.html</code> as having Ajax content.</p>

<p>Next, add some content to show when these links are clicked.  Put the following content
in each file:</p>

<p><strong>ajaxy/fixtures/articles.html</strong></p>

<pre><code class="xml"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Articles<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
<span class="tag">&lt;p&gt;</span>Some articles.<span class="tag">&lt;/p&gt;</span></code></pre>

<p><strong>ajaxy/fixtures/images.html</strong></p>

<pre><code class="xml"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Images<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
<span class="tag">&lt;p&gt;</span>Some images.<span class="tag">&lt;/p&gt;</span></code></pre>

<p><strong>ajaxy/fixtures/videos.html</strong></p>

<pre><code class="xml"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Videos<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
<span class="tag">&lt;p&gt;</span>Some videos.<span class="tag">&lt;/p&gt;</span></code></pre>

<p>Finally, change <code>ajaxy.js</code> to look like:</p>

<pre><code class=" javascript">$.Controller(<span class="string">'Ajaxy'</span>,{
    init : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        <span class="keyword">this</span>.updateContent()
    },
    <span class="string">"{window} hashchange"</span> : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        <span class="keyword">this</span>.updateContent();
    },
    updateContent : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        <span class="keyword">var</span> hash = window.location.hash.substr(<span class="number">2</span>),
            url = <span class="string">"fixtures/"</span>+(hash || <span class="string">"videos"</span>)+<span class="string">".html"</span>;

        <span class="comment">// postpone reading the html </span>
        steal.html.wait();

        $.get(url, {}, <span class="keyword">this</span>.callback(<span class="string">'replaceContent'</span>),<span class="string">"text"</span> )
    },
    replaceContent : <span class="function"><span class="keyword">function</span><span class="params">(html)</span>{</span>
        <span class="keyword">this</span>.element.html(html);

        <span class="comment">// indicate the html is ready to be crawled</span>
        steal.html.ready();
    }
})

$(<span class="string">'#content'</span>).ajaxy()
</code></pre>

<p>When a hashchange (<code>"{window} hashchange"</code>) event occurs, Ajaxy
uses the <code>window.location.hash</code> value to make a 
request (<code>$.get</code>)
for content in the<code>fixtures</code> folder.  </p>

<p>When the content is retrieved, it replaces the element's 
html (<code>this.element.html(...)</code>).</p>

<p>Ajaxy also calls <code>updateContent</code> to load content when
the page loads initially. </p>

<h2>Crawling and scraping</h2>

<p>To crawl your site and generate google-searchable html, run:</p>

<pre><code class="none javascript">js ajaxify/scripts/crawl.js</code></pre>

<p>This script peforms the following actions:</p>

<ol>
<li>Opens a page in a headless browser.</li>
<li>Waits until its content is ready.</li>
<li>Scrapes its contents.</li>
<li>Writes the contents to a file.</li>
<li>Adds any links in the page that start with #! to be indexed</li>
<li>Changes <code>window.location.hash</code> to the next index-able page</li>
<li>Goto #2 and repeats until all pages have been loaded</li>
</ol>

<h2>Pausing the html scraping.</h2>

<p>By default, the contents are scraped immediately after the page's scripts have loaded or
the window.location.hash has changed.  The Ajax request for content
happens asynchronously so we have to tell <a href="#!steal.html">steal.html</a> to wait to scrape the content.</p>

<p>To do this, Ajaxy calls:</p>

<pre><code class=" javascript">steal.html.wait();
</code></pre>

<p>before the Ajax request.  And when the page is ready, Ajaxy calls:</p>

<pre><code class=" javascript">steal.html.ready();
</code></pre>

<h2>Getting Google To Crawl Your Site</h2>

<p>If you haven't already, read up on 
Google's <a href="http://code.google.com/web/ajaxcrawling/docs/getting-started.html">Ajax crawling API</a>.</p>

<p>When google wants to crawl your site, it will send a 
request to your page with <code><em>escaped</em>fragment_=<code>.  When this happens, redirect
google to the generated html page.  Yes, it's that easy!</code></code></p><code><code></code></code></div>
			<div id="disqus_thread"></div>
		</div>
	</div>
</div>
<div id="low">
	<a href="http://jupiterit.com">� Jupiter IT - JavaScriptMVC Training and Support</a>
	<a class="api_links" href="http://javascriptmvc.com/docs/api.html#&amp;who=api"></a>
</div>
<script src="http://www.google-analytics.com/ga.js" type="text/javascript"></script>
<script type="text/javascript">
	GOOGLE_ANALYTICS_TRACKER_ID = "UA-xxxxxxxx-x";
</script>
<script type="text/javascript">
	DOCS_LOCATION = "docs/" //adds searchData to this
	JMVCDOC_TIMESTAMP = 263436055
</script>
<script type="text/javascript" src="../steal/steal.js?jmvcdoc">
</script>
	

</body>