<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<head>
	<title>JavaScriptMVC</title>
	<link rel="stylesheet" type="text/css" href="../documentjs/jmvcdoc/style.css">
	<link rel="shortcut icon" href="../documentjs/jmvcdoc/images/favicon.ico">
<link rel="stylesheet" href="file:////opt/local/share/java/tomcat6/webapps/jmvc31/jmvcdoc/style.css" type="text/css"></head><body>
<div id="documentation">
	<div id="top">
		<div class="topCorner">
			<div class="right"></div>
			<div class="left"></div>
		</div>
		<div class="content">
			<div id="searchRoundCorners">
				<input id="search" type="input" class="jmvcdoc_search">
			</div>
			<div id="defaults">
				<ul id="menu" class="ui-menu">
					<li class="ui-menu-item">
						<a class="menuLink" href="#&amp;search=core"><span class="menuSpan">Core</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="#favorites"><span class="menuSpan">Favorites</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../follow.html" title="Follow"><span class="menuSpan red">Follow</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../contribute.html" title="Contribute"><span class="menuSpan red">Contribute</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../code.html" title="Code"><span class="menuSpan red">Code</span></a>
					</li>
				</ul>
			</div>
			<div class="logo-text"><a href="http://javascriptmvc.com"><img src="../documentjs/jmvcdoc/images/logo80x30.png" class="logo-image"></a></div>
		</div>
		<div class="bottomCorner">
			<div>&nbsp;</div>
		</div>
	</div>
	<div id="bottom">
		<div id="nav" class="jmvcdoc_nav">


	<div id="selected">
		    
				
		<div class="content">
			    <a href="#!" class="selected choice page" style="padding-left: 20px">
			    	
					JavaScriptMVC
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!jquerymx" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					jQueryMX
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!jQuery.Model" class="selected choice class" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					$.Model
					
				</a>
				
		</div>
			
			
	</div>

<div id="results" style="display: block">
	<div class="content">
	    
			
		    <a href="#!jquery.model.deferreds" class="result choice page" style="padding-left: 20px">
		    	Deferreds
			</a>
			
		
			
		    <a href="#!jquery.model.encapsulate" class="result choice page" style="padding-left: 20px">
		    	Service Encapsulation
			</a>
			
		
			
		    <a href="#!jquery.model.events" class="result choice page" style="padding-left: 20px">
		    	Events
			</a>
			
		
			
		    <a href="#!jQuery.Model.List" class="result choice class" style="padding-left: 20px">
		    	$.Model.List
			</a>
			
		
			
		    <a href="#!jquery.model.services" class="result choice page" style="padding-left: 20px">
		    	Service APIs
			</a>
			
		
			
		    <a href="#!jquery.model.typeconversion" class="result choice page" style="padding-left: 20px">
		    	Type Conversion
			</a>
			
		
			
		    <a href="#!jquery.model.validations" class="result choice page" style="padding-left: 20px">
		    	Validations
			</a>
			
		
			
		    <a href="javascript://" class="result choice prototype" style="padding-left: 20px">
		    	$.Model.prototype
			</a>
			
		
			
			
			
		    <a href="#!jQuery.Model.prototype.attr" class="result choice function" style="padding-left: 60px">
		    	attr
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.attrs" class="result choice function" style="padding-left: 60px">
		    	attrs
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.bind" class="result choice attribute" style="padding-left: 60px">
		    	bind
			</a>
			
		
			
			
		    <a href="#!jQuery.Model.prototype.destroy" class="result choice function" style="padding-left: 60px">
		    	destroy
			</a>
			
		
			
			
		    <a href="#!jQuery.Model.prototype.elements" class="result choice function" style="padding-left: 60px">
		    	elements
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.errors" class="result choice function" style="padding-left: 60px">
		    	errors
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.identity" class="result choice function" style="padding-left: 60px">
		    	identity
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.isNew" class="result choice function" style="padding-left: 60px">
		    	isNew
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.publish" class="result choice function" style="padding-left: 60px">
		    	publish
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.removeAttr" class="result choice function" style="padding-left: 60px">
		    	removeAttr
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.save" class="result choice function" style="padding-left: 60px">
		    	save
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.setup" class="result choice function" style="padding-left: 60px">
		    	setup
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.unbind" class="result choice attribute" style="padding-left: 60px">
		    	unbind
			</a>
			
		
			
		    <a href="#!jQuery.Model.prototype.update" class="result choice function" style="padding-left: 60px">
		    	update
			</a>
			
		
			
			
		    <a href="javascript://" class="result choice static" style="padding-left: 40px">
		    	static
			</a>
			
		
			
			
		    <a href="#!jQuery.Model.static.attributes" class="result choice attribute" style="padding-left: 60px">
		    	attributes
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.convert" class="result choice attribute" style="padding-left: 60px">
		    	convert
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.create" class="result choice function" style="padding-left: 60px">
		    	create
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.destroy" class="result choice function" style="padding-left: 60px">
		    	destroy
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.findAll" class="result choice function" style="padding-left: 60px">
		    	findAll
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.findOne" class="result choice function" style="padding-left: 60px">
		    	findOne
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.id" class="result choice attribute" style="padding-left: 60px">
		    	id
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.model" class="result choice function" style="padding-left: 60px">
		    	model
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.models" class="result choice function" style="padding-left: 60px">
		    	models
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.publish" class="result choice function" style="padding-left: 60px">
		    	publish
			</a>
			
		
			
		    <a href="#!jQuery.Model.static.update" class="result choice function" style="padding-left: 60px">
		    	update
			</a>
			
		
			
		    <a href="#!jquerymx.model.backup" class="result choice page" style="padding-left: 20px">
		    	Backup / Restore
			</a>
			
		
	</div>
</div>


</div>
		<div id="doc_container">
			<div id="doc" class="jmvcdoc_content"><div class="top">
	<div class="content">
	    <h1>jQuery.Model&nbsp;
	    	<span class="class type"><span class="typeEnd">class</span></span>&nbsp;
	    	<span class="favorite favoriteoff">&nbsp;&nbsp;&nbsp;</span></h1>
	    
	    
	    
	    <div class="plugin">
	        plugin: jquery/model
	    </div>
	    
		
	    <div class="download">
	        download: <a href="http://jmvcsite.heroku.com/pluginify?plugins[]=jquery/model/model.js"> jQuery.Model</a>
	    </div>
	    
		
	    <div class="test">
	        test: <a href="file:////opt/local/share/java/tomcat6/webapps/jmvc31/jquery/model/qunit.html">qunit.html</a>
	    </div>
	    
	</div>
</div>


<p>Models super-charge an application's
data layer, making it easy to:</p>

<ul>
<li>Get and modify data from the server</li>
<li>Listen to changes in data</li>
<li>Setting and retrieving models on elements</li>
<li>Deal with lists of data</li>
<li>Do other good stuff</li>
</ul>

<p>Model inherits from <a href="#!jQuery.Class">$.Class</a> and make use
of REST services and <a href="http://api.jquery.com/category/deferred-object/">deferreds</a>
so these concepts are worth exploring.  Also, 
the <a href="#!mvc.model">MVC in JavaScriptMVC</a> has a good walkthrough of $.Model.</p>

<h2>Get and modify data from the server</h2>

<p>$.Model makes connecting to a JSON REST service 
really easy.  The following models <code>todos</code> by
describing the services that can create, retrieve,
update, and delete todos. </p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>,{
  findAll: <span class="string">'GET /todos.json'</span>,
  findOne: <span class="string">'GET /todos/{id}.json'</span>,
  create:  <span class="string">'POST /todos.json'</span>,
  update:  <span class="string">'PUT /todos/{id}.json'</span>,
  destroy: <span class="string">'DELETE /todos/{id}.json'</span> 
},{});
</code></pre>

<p>This lets you create, retrieve, update, and delete
todos programatically:</p>

<p><strong>Create</strong></p>

<p>Create a todo instance and 
call <a href="#!jQuery.Model.prototype.save">save</a><code>( success, error )</code>
to create the todo on the server.</p>

<pre><code class=" javascript"><span class="comment">// create a todo instance</span>
<span class="keyword">var</span> todo = <span class="keyword">new</span> Todo({name: <span class="string">"do the dishes"</span>})

<span class="comment">// save it on the server</span>
todo.save();
</code></pre>

<p><strong>Retrieve</strong></p>

<p>Retrieve a list of todos from the server with
<code>findAll( params, callback( items ) )</code>: </p>

<pre><code class=" javascript">Todo.findAll({}, <span class="function"><span class="keyword">function</span><span class="params">( todos )</span>{</span>

  <span class="comment">// print out the todo names</span>
  $.each(todos, <span class="function"><span class="keyword">function</span><span class="params">(i, todo)</span>{</span>
    console.log( todo.name );
  });
});
</code></pre>

<p>Retrieve a single todo from the server with
<code>findOne( params, callback( item ) )</code>:</p>

<pre><code class=" javascript">Todo.findOne({id: <span class="number">5</span>}, <span class="function"><span class="keyword">function</span><span class="params">( todo )</span>{</span>

  <span class="comment">// print out the todo name</span>
  console.log( todo.name );
});
</code></pre>

<p><strong>Update</strong></p>

<p>Once an item has been created on the server,
you can change its properties and call
<code>save</code> to update it on the server.</p>

<pre><code class=" javascript"><span class="comment">// update the todos' name</span>
todo.attr(<span class="string">'name'</span>,<span class="string">'Take out the trash'</span>)

<span class="comment">// update it on the server</span>
todo.save()
</code></pre>

<p><strong>Destroy</strong></p>

<p>Call <a href="#!jQuery.Model.prototype.destroy">destroy</a><code>( success, error )</code>
to delete an item on the server.</p>

<pre><code class=" javascript">todo.destroy()
</code></pre>

<h2>Listen to changes in data</h2>

<p>Listening to changes in data is a critical part of 
the <a href="http://en.wikipedia.org/wiki/Model�??view�??controller">Model-View-Controller</a>
architecture.  $.Model lets you listen to when an item is created, updated, destroyed
and its properties are changed by creating <a href="#!jquery.model.events">events</a>
on the Model and on instances of the model.</p>

<p><strong>Create</strong></p>

<pre><code class=" javascript"><span class="comment">// listen for when any todo is created</span>
Todo.bind(<span class="string">'created'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev, todo )</span> {</span>...})

<span class="comment">// listen for when a specific todo is created</span>
<span class="keyword">var</span> todo = <span class="keyword">new</span> Todo({name: <span class="string">'do dishes'</span>})
todo.bind(<span class="string">'created'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev )</span> {</span>...})
</code></pre>

<p><strong>Update</strong></p>

<pre><code class=" javascript"><span class="comment">// listen for when any todo is updated</span>
Todo.bind(<span class="string">'updated'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev, todo )</span> {</span>...})

<span class="comment">// listen for when a specific todo is created</span>
Todo.findOne({id: <span class="number">6</span>}, <span class="function"><span class="keyword">function</span><span class="params">( todo )</span> {</span>
  todo.bind(<span class="string">'updated'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev )</span> {</span>...})
})
</code></pre>

<p><strong>Destroy</strong></p>

<pre><code class=" javascript"><span class="comment">// listen for when any todo is destroyed</span>
Todo.bind(<span class="string">'destroyed'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev, todo )</span> {</span>...})

<span class="comment">// listen for when a specific todo is destroyed</span>
todo.bind(<span class="string">'destroyed'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev )</span> {</span>...})
</code></pre>

<p><strong>Property Changes</strong></p>

<pre><code class=" javascript"><span class="comment">// listen for when the name property changes</span>
todo.bind(<span class="string">'name'</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev)</span>{</span>  })
</code></pre>

<p><strong>Listening with Controller</strong></p>

<p>You should be using controller to listen to model changes like:</p>

<pre><code class=" javascript">$.Controller(<span class="string">'Todos'</span>,{
  <span class="string">"{Todo} updated"</span> : <span class="function"><span class="keyword">function</span><span class="params">(Todo, ev, todo)</span> {</span>...}
})
</code></pre>

<h2>Setting and retrieving data on elements</h2>

<p>Almost always, we use HTMLElements to represent
data to the user.  When that data changes, we update those
elements to reflect the new data.</p>

<p>$.Model has helper methods that make this easy.  They
let you "add" a model to an element and also find
all elements that have had a model "added" to them.</p>

<p>Consider a todo list widget
that lists each todo in the page and when a todo is
deleted, removes it.  </p>

<p><a href="#!jQuery.fn.model">$.fn.model</a><code>( item )</code> lets you set or read a model 
instance from an element:</p>

<pre><code class=" javascript">Todo.findAll({}, <span class="function"><span class="keyword">function</span><span class="params">( todos )</span> {</span>

  $.each(todos, <span class="function"><span class="keyword">function</span><span class="params">(todo)</span> {</span>
    $(<span class="string">'&lt;li&gt;'</span>).model(todo)
             .text(todo.name)
             .appendTo(<span class="string">'#todos'</span>)
  });
});
</code></pre>

<p>When a todo is deleted, get its element with
<code>item.</code><a href="#!jQuery.Model.prototype.elements">elements</a><code>( context )</code>
and remove it from the page.</p>

<pre><code class=" javascript">Todo.bind(<span class="string">'destroyed'</span>, <span class="function"><span class="keyword">function</span><span class="params">( ev, todo )</span> {</span> 
  todo.elements( $(<span class="string">'#todos'</span>) ).remove()
})
</code></pre>

<p><strong>Using EJS and $.Controller</strong></p>

<p><a href="#!jQuery.View">$.View</a> and <a href="#!jQuery.EJS">EJS</a> makes adding model data 
to elements easy.  We can implement the todos widget like the following:</p>

<pre><code class=" javascript">$.Controller(<span class="string">'Todos'</span>,{
  init: <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">this</span>.element.html(<span class="string">'//todos/views/todos.ejs'</span>, Todo.findAll({}) ); 
  },
  <span class="string">"{Todo} destroyed"</span>: <span class="function"><span class="keyword">function</span><span class="params">(Todo, ev, todo)</span> {</span>
    todo.elements( <span class="keyword">this</span>.element ).remove()
  }
})
</code></pre>

<p>In todos.ejs</p>

<pre><code class="html"><span class="vbscript">&lt;% for(var i =0; i &lt; todos.length; i++){ %&gt;</span>
  <span class="tag">&lt;<span class="keyword">li</span> &lt;%=<span class="attribute"> todos</span>[<span class="keyword">i</span>] %&gt;</span>&gt;<span class="vbscript">&lt;%= todos[i].name %&gt;</span><span class="tag">&lt;/<span class="keyword">li</span>&gt;</span>
<span class="vbscript">&lt;% } %&gt;</span></code></pre>

<p>Notice how you can add a model to an element with <code>&lt;%= model %&gt;</code></p>

<h2>Lists</h2>

<p><a href="#!jQuery.Model.List">$.Model.List</a> lets you handle multiple model instances
with ease.  A List acts just like an <code>Array</code>, but you can add special properties 
to it and listen to events on it.  </p>

<p><code>$.Model.List</code> has become its own plugin, read about it
<a href="#!jQuery.Model.List">here</a>.</p>

<h2>Other Good Stuff</h2>

<p>Model can make a lot of other common tasks much easier.</p>

<h3>Type Conversion</h3>

<p>Data from the server often needs massaging to make it more useful 
for JavaScript.  A typical example is date data which is 
commonly passed as
a number representing the Julian date like:</p>

<pre><code class=" javascript">{ name: <span class="string">'take out trash'</span>, 
  id: <span class="number">1</span>,
  dueDate: <span class="number">1303173531164</span> }
</code></pre>

<p>But instead, you want a JavaScript date object:</p>

<pre><code class=" javascript">date.attr(<span class="string">'dueDate'</span>) <span class="comment">//-&gt; new Date(1303173531164)</span>
</code></pre>

<p>By defining property-type pairs in <a href="#!jQuery.Model.static.attributes">attributes</a>,
you can have model auto-convert values from the server into more useful types:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>,{
  attributes : {
    dueDate: <span class="string">'date'</span>
  }
},{})
</code></pre>

<h3>Associations</h3>

<p>The <a href="#!jQuery.Model.static.attributes">attributes</a> property also 
supports associations. For example, todo data might come back with
User data as an owner property like:</p>

<pre><code class=" javascript">{ name: <span class="string">'take out trash'</span>, 
  id: <span class="number">1</span>, 
  owner: { name: <span class="string">'Justin'</span>, id: <span class="number">3</span>} }
</code></pre>

<p>To convert owner into a User model, set the owner type as the User's
<a href="#!jQuery.Model.static.model">model</a><code>( data )</code> method:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>,{
  attributes : {
    owner: <span class="string">'User.model'</span>
  }
},{})
</code></pre>

<h3>Helper Functions</h3>

<p>Often, you need to perform repeated calculations 
with a model's data.  You can create methods in the model's 
prototype and they will be available on 
all model instances.  </p>

<p>The following creates a <code>timeRemaining</code> method that
returns the number of seconds left to complete the todo:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>,{
},{
   timeRemaining : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     <span class="keyword">return</span> <span class="keyword">new</span> Date() - <span class="keyword">new</span> Date(<span class="keyword">this</span>.dueDate)
   }
})

<span class="comment">// create a todo</span>
<span class="keyword">var</span> todo = <span class="keyword">new</span> Todo({dueDate: <span class="keyword">new</span> Date()});

<span class="comment">// show off timeRemaining</span>
todo.timeRemaining() <span class="comment">//-&gt; Number</span>
</code></pre>

<h3>Deferreds</h3>

<p>Model methods that make requests to the server such as:
<a href="#!jQuery.Model.static.findAll">findAll</a>, <a href="#!jQuery.Model.static.findOne">findOne</a>, 
<a href="#!jQuery.Model.prototype.save">save</a>, and <a href="#!jQuery.Model.prototype.destroy">destroy</a> return a
<a href="#!jquery.model.deferreds">deferred</a> that resolves to the item(s)
being retrieved or modified.  </p>

<p>Deferreds can make a lot of asynchronous code much easier.  For example, the following
waits for all users and tasks before continuing :</p>

<pre><code class=" javascript">$.when(Task.findAll(), User.findAll())
  .then(<span class="function"><span class="keyword">function</span><span class="params">( tasksRes, usersRes )</span>{</span> ... })
</code></pre>

<h3>Validations</h3>

<p><a href="#!jquery.model.validations">Validate</a> your model's attributes.</p>

<pre><code class=" javascript">$.Model(<span class="string">"Contact"</span>,{
init : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">this</span>.validate(<span class="string">"birthday"</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        <span class="keyword">if</span>(<span class="keyword">this</span>.birthday &gt; <span class="keyword">new</span> Date){
            <span class="keyword">return</span> <span class="string">"your birthday needs to be in the past"</span>
        }
    })
}
,{});
</code></pre>



  <div class="params">
  
    
 
 </div>

</div>
			<div id="disqus_thread"></div>
		</div>
	</div>
</div>
<div id="low">
	<a href="http://jupiterit.com">� Jupiter IT - JavaScriptMVC Training and Support</a>
	<a class="api_links" href="http://javascriptmvc.com/docs/api.html#&amp;who=api"></a>
</div>
<script src="http://www.google-analytics.com/ga.js" type="text/javascript"></script>
<script type="text/javascript">
	GOOGLE_ANALYTICS_TRACKER_ID = "UA-xxxxxxxx-x";
</script>
<script type="text/javascript">
	DOCS_LOCATION = "docs/" //adds searchData to this
	JMVCDOC_TIMESTAMP = 263436055
</script>
<script type="text/javascript" src="../steal/steal.js?jmvcdoc">
</script>
	

</body>