<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head><script type="text/javascript" src="http://localhost:5555?[]&amp;_=0.23637347435578704"></script>
	<title>Todo</title>

	<link rel="shortcut icon" href="../documentjs/jmvcdoc/images/favicon.ico">
	<script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxxx-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<style type="text/css">.floatLeft {
  float: left;
}
/* content types */
body {
  font-family: sans-serif, "Trebuchet MS", Verdana, Helvetica, Arial;
  margin: 20px 0px 0px 0px;
  background: #fcfcfc;
  font-size: 17px;
}
h1 {
  position: relative;
  margin: 0;
}
h1 span.subtitle {
  color: #888888;
  font-style: italic;
}
h2 {
  border-bottom: solid 1px	#C3E2EF;
  padding-bottom: 3px;
}
h3 {
  color: #96A84A;
  font-size: 1.3em;
  margin-bottom: 10px;
}
h5 {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
pre {
  background-color: #F9F7DF;
  border: solid 1px white;
  margin: 13px 0;
  padding: 13px;
}
dl {
  margin: 10px;
}
td {
  padding: 3px;
  vertical-align: top;
}
.error {
  border: solid 1px red;
}
.error_text {
  color: red;
  font-size: 10px;
}
/* LAYOUT =========================*/
#documentation {
  width: 1024px;
  margin: 0px auto;
}
#top {
  margin: 0 20px 20px 20px;
  padding: 10px 0;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  background: #004634;
  background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #004634), color-stop(1, #01654a));
  background: -ms-linear-gradient(bottom, #004634, #01654a);
  background: -moz-linear-gradient(center bottom, #004634 0%, #01654a 100%);
  background: -o-linear-gradient(bottom, #004634 0%, #01654a 100%);
  background: linear-gradient(bottom, #004634 0%, #01654a 100%);
  /*filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#01654a', endColorstr='#004634',GradientType=0 ); /* IE6-9 */

  -webkit-box-shadow: 0px 1px 0px #ffffff;
  -moz-box-shadow: 0px 1px 0px #ffffff;
  box-shadow: 0px 1px 0px #ffffff;
}
#top .content {
  /*height:34px;*/

  margin: 0 10px;
  overflow: auto;
}
#top #searchRoundCorners {
  float: left;
  width: 293px;
  height: 15px;
  padding: 0px;
  margin: 0px;
  zoom: 1;
  display: inline;
  padding-top: 5px;
}
#top #search {
  width: 273px;
  font-size: 14px;
  font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
  float: left;
  border: none;
  background: #FFFFFF;
  outline: none;
  margin-left: 10px;
  position: absolute;
  margin: 0 0 0 10px;
  padding: 3px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border: 1px solid #004634;
  -webkit-box-shadow: 0px 1px 0px #0f8563;
  -moz-box-shadow: 0px 1px 0px #0f8563;
  box-shadow: 0px 1px 0px #0f8563;
}
#top .logo-text a {
  color: white;
  float: right;
  left: -8px;
  position: relative;
  top: -4px;
  text-decoration: none;
  border: none;
}
#top .logo-image {
  left: 4px;
  position: relative;
  top: 8px;
  border: none;
}
/* TOP MENU STYLE ===== */
#defaults {
  float: left;
  font-weight: bold;
  width: 400px;
  margin-left: 10px;
  margin-bottom: 1px;
  height: 35px;
  line-height: 35px;
}
#defaults a {
  color: white;
  /*padding: 0px 10px;*/

  margin: 0 1px;
  text-decoration: none;
}
#defaults .ui-menu {
  height: 25px;
  line-height: 25px;
  margin: 7px 0px;
  padding: 0px;
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  position: absolute;
  z-index: 1000;
}
#defaults .ui-menu-item {
  float: left;
  /*padding:0.5em 1em;*/

  cursor: pointer;
}
#defaults .menuLink, #defaults .menuSpan {
  display: inline;
  height: 25px;
  float: left;
  cursor: pointer;
  font-size: 16px;
  text-shadow: 0px -1px #000000;
}
#defaults .menuSpan {
  padding-left: 10px;
  padding-right: 10px;
}
#defaults .menuLink:hover .menuSpan, #defaults .menuLink:hover span.red {
  background-color: #899d09;
  color: white;
  border-radius: 3px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  text-shadow: 0px 1px #333;
  -webkit-box-shadow: 0px 1px 0px #003f2f;
  -moz-box-shadow: 0px 1px 0px #003f2f;
  box-shadow: 0px 1px 0px #003f2f;
}
html*#searchRoundCorners {
  /* ie7 hack */

  padding: 7px;
}
.inside td {
  vertical-align: middle;
}
#bottom {
  margin: 0px 20px;
  clear: both;
}
#bottom p, #bottom ul, #bottom ol {
  color: #333;
  line-height: 24px;
}
#bottom a {
  color: #1f54c6;
}
#bottom p code {
  border: solid 1px #F9F7DF;
  white-space: nowrap;
  background-color: #eeeeee;
}
#bottom h2 code, #bottom h3 code {
  font-size: 17px;
  font-weight: normal;
  color: #333333;
  border: solid 1px #F9F7DF;
  background-color: #f9f9f9;
}
#nav {
  width: 300px;
  min-height: 10px;
  float: left;
  /*background-color: #2D2E26;*/
  /*#B8B495*/

  /*background-color:rgb(239,242,213);*/

  overflow: auto;
  margin-right: 20px;
  margin-bottom: 20px;
}
#nav a {
  display: block;
  padding: 5px;
  text-decoration: none;
  font-size: 14px;
  /*color: #F1F1C3;*/

  color: #404038;
  border: none;
  outline: none;
}
#nav #selected {
  margin: 0 0 10px 0;
}
#nav #selected .selected {
  font-size: 17px;
  font-weight: bold;
}
#nav #selected .spacer {
  height: 10px;
  background: #fcfcfc;
}
#nav #selected .content {
  margin: 0 0px;
  clear: both;
}
#nav #selected .content a {
  padding: 5px 10px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  background-color: #d2d988;
}
#nav #selected .content .highlight {
  background-color: #d7e1ad;
}
#nav #results {
  /*margin:10px 0 0 0;*/

  background-color: #e6f1ba;
  padding: 5px 0;
}
#nav #results .highlight {
  /*background-color: #3C3D32;*/

  background-color: #b6dceb;
}
#nav #results .open {
  /*the opened color*/

  background: #a0b348;
  color: white;
  font-weight: bold;
}
#nav .faded {
  color: gray;
}
#nav .prototype, #nav .static {
  color: gray;
}
#nav .class, #nav .constructor {
  font-weight: bold;
}
#nav .attribute {
  color: red;
}
#doc_container {
  margin-right: 0px;
  margin-left: 320px;
}
#doc {
  /*line-height:24px;*/

  /*padding: 0 20px 0 0;*/

  margin: 0;
}
#doc .type {
  color: gray;
  font-size: 0.8em;
}
#doc .content .type, #doc .typeEnd {
  text-shadow: none;
  display: inline-block;
  font-size: 0.7em;
  color: #FFFFFF;
  background: url("file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/type.png") no-repeat;
  background-position: 0 0;
  vertical-align: middle;
  margin-left: -9px;
  margin-bottom: 3px;
  *margin-bottom: 0px;
  /* ie7 */

}
#doc .typeEnd {
  display: block;
  line-height: 21px;
  background-position: 100% 0;
  margin-left: 11px;
  padding: 0 10px 0 5px;
  float: left;
}
#doc .top {
  margin: 0 0 20px;
  line-height: 38px;
  background-color: #c3e2ef;
  padding: 5px 0 1px 0;
  text-shadow: 0px 1px white;
  color: #222;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}
#doc .top .content {
  margin: 5px 20px 5px 20px;
}
#doc .favorite {
  float: right;
  cursor: pointer;
  background-repeat: no-repeat;
  /*background-position: left 16px;*/

  /* ie7 hacks */

  *position: absolute;
  top: 5px;
  right: 0;
}
#doc .favoriteon {
  background-image: url(file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/fav-on.png);
}
#doc .favoriteoff {
  background-image: url(file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/fav-off.png);
}
#disqus_thread {
  margin: 0;
}
.remove {
  float: right;
  display: block;
  width: 16px;
  text-align: center;
  height: 16px;
  background-image: url('file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/sidebar_top_close.png');
  margin: 1px -4px 0 0;
  opacity: 0.5;
}
.remove :hover {
  opacity: 1;
}
.jmvcdoc_search {
  position: relative;
}
.jmvcdoc_search .remove {
  display: none;
  position: absolute;
  top: 3px;
  right: 11px;
}
#low {
  font-size: 12px;
  margin: 10px auto;
  text-align: center;
  color: white;
  background: #e0e0e0;
  height: 30px;
  line-height: 30px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  clear: both;
  width: 1024px;
}
#low a {
  color: #666;
  text-decoration: none;
  font-weight: bold;
}
/* CONTENT FORMATTING ============= */
.param, .return {
  text-indent: -48px;
  margin-left: 48px;
}
.param *, .return * {
  text-indent: 0px;
}
.param label, .return label {
  color: #808080;
  font-size: 10pt;
  font-weight: bold;
  margin: 0;
}
.options {
  margin-left: 40px;
  margin-right: 40px;
  text-align: left;
}
.options th {
  border-bottom: 1px solid #EEEEEE;
  font-family: "Helvetica Neue", Arial, sans-serif;
  font-size: 0.8em;
}
.options td {
  border-bottom: 1px solid #EEEEEE;
  font-size: 10pt;
  line-height: 150%;
  padding: 3px;
  vertical-align: top;
}
.signiture {
  border-color: #9C6854;
  background: none;
  background-color: white;
}
.params {
  margin-left: 13px;
}
code .comment {
  color: #007000;
}
.string {
  color: Gray;
}
.keyword {
  color: #800080;
}
code .params {
  color: blue;
  margin: 0px;
}
.magic {
  background-color: #FFF7D7;
}
.console {
  color: blue;
}
.this {
  color: #0000C0;
}
table pre {
  margin: 0px;
}
.floatLeft {
  float: left;
}
h2.spaced {
  clear: left;
  padding-top: 18px;
}
.warn {
  margin: 13px;
  padding: 13px;
  font-size: 11px;
  border: 1px solid #9C6854;
  background-color: #eeeeee;
}
.tip {
  font-size: 0.8em;
  font-family: verdana;
  padding-left: 13px;
}
.noborder {
  border: none;
}
.floatLeft .noborder {
  padding-right: 10px;
}
iframe {
  display: block;
  clear: right;
  width: 100%;
  border: 1px solid #cccccc;
  padding: 0 0 10px 10px;
  margin: 10px 0 10px 0;
  background-color: #eeeeee;
}
.iframe_wrapper {
  border: 1px solid #ffffff;
}
.iframe_menu_button {
  display: block;
  float: right;
  width: 100px;
  background-color: #cccccc;
  border-top: 1px solid #999999;
  border-left: 1px solid #999999;
  border-right: 1px solid #999999;
  cursor: pointer;
}
.iframe_menu {
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  font-size: 0.7em;
  background-color: #ffffff;
  border: 1px solid #999999;
  padding: 5px;
  margin: 0;
}
.iframe_menu_item {
  margin: 5px 2px 0px 2px;
}
/* @demo css
-------------*/
.demo .reset {
  padding: 0;
  margin: 0;
  border: 0;
  outline: 0;
  line-height: 1.3;
  text-decoration: none;
  font-size: 100%;
  list-style: none;
}
.demo .header a {
  font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
  font-size: 12px;
  /*background-color: #AABF54;*/

  background-color: #D2D988;
  display: block;
  padding: .5em .5em .5em 2.2em;
  margin: 0;
  color: #FFFFFF;
  cursor: pointer;
  position: relative;
  margin-top: 1px;
  zoom: 1;
  /*border: 1px solid #AABF54;*/

  border: 1px solid #D2D988;
  text-decoration: none;
}
.demo .header .ui-icon {
  position: absolute;
  left: .5em;
  top: 50%;
  margin-top: -8px;
}
.demo .content {
  border: 1px solid #AABF54;
}
.demo .content iframe {
  padding: 0;
  margin: 0;
  background-color: #FFFFFF;
  border: none;
}
.demo pre {
  padding: 10px;
  margin: 0px;
  background-image: none;
}
.demo pre code {
  font-family: "Courier New";
  border: none;
}
.component {
  margin-right: 12px;
  height: 80px;
  float: left;
}
.whisper {
  color: #96A84A;
}
/* menu items */
iframe.pluginify {
  border: none;
  background: none;
  margin: 0px;
  height: 2060px;
  padding: 0px;
}
#tooltip {
  background-color: #b6dceb;
  height: 16px;
  padding: 5px;
  border-top: solid 5px white;
  border-bottom: solid 5px white;
  border-right: solid 5px white;
}
</style></head><body>
<div id="documentation">
	<div id="top">
		<div class="content">
			<div id="searchRoundCorners">
				<div class="jmvcdoc_search"><input id="search" type="input"><span title="clear term" class="remove"></span></div>
			</div>
			<div id="defaults">
				<ul id="menu" class="ui-menu">
					<li class="ui-menu-item">
						<a class="menuLink" href="#favorites"><span class="menuSpan">Favorites</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../follow.html" title="Follow"><span class="menuSpan red">Follow</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../contribute.html" title="Contribute"><span class="menuSpan red">Contribute</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../code.html" title="Code"><span class="menuSpan red">Code</span></a>
					</li>
				</ul>
			</div>
			<div class="logo-text"><a href="http://javascriptmvc.com"><img src="../documentjs/jmvcdoc/images/logo80x30.png" class="logo-image"></a></div>
		</div>
	</div>
	<div id="bottom">
		<div id="nav" class="jmvcdoc_nav">


	<div id="selected">
		    
				
		<div class="content">
			    <a href="#!" class="selected choice page" style="padding-left: 20px">
			    	
					JavaScriptMVC
					
				</a>
				
		</div>
			
				<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!examples" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					Examples
					
				</a>
				
		</div>
			
			
	</div>

<div id="results" style="display: block">
	<div class="content">
	    
			
		    <a href="#!srchr" class="result choice page" style="padding-left: 20px" data-name="srchr">
		    	
					<span class="faded"></span>Srchr
				
			</a>
			
		
			
		    <a href="#!contacts" class="result choice page" style="padding-left: 20px" data-name="contacts">
		    	
					<span class="faded"></span>Contacts
				
			</a>
			
		
			
		    <a href="#!playermx" class="result choice page" style="padding-left: 20px" data-name="playermx">
		    	
					<span class="faded"></span>PlayerMX
				
			</a>
			
		
			
		    <a href="#!todo" class="result choice page open" style="padding-left: 20px" data-name="todo">
		    	
					<span class="faded"></span>Todo
				
			</a>
			
		
	</div>
</div>


</div>
		<div id="doc_container">
			<div id="doc" class="jmvcdoc_content">
<div class="top">
	<div class="content">
	    <h1>Todo&nbsp;
	    	<span class="page type"><span class="typeEnd">page</span></span>&nbsp;
	    	<span class="favorite favoriteoff">&nbsp;&nbsp;&nbsp;</span></h1>
	    
	    
	    
		
		
		
	</div>	
</div>


<h2>Introduction</h2>

<p>In this article we will be learning the basics of <a href="http://javascriptmvc.com/">JavaScriptMVC</a> and the <a href="http://en.wikipedia.org/wiki/Model�??view�??controller">Model-View-Controller pattern</a> by installing and walking through a simple To-do list manager. The separation of the application's core logic from its user interface behavior is the hallmark of MVC. By working through this exercise you will understand how JavaScriptMVC's particular flavor of this pattern enables you to create more flexible and maintainable browser-based applications.</p>

<p>Let's get started!</p>

<h2>Setup</h2>

<p>First, clone the application from our <a href="http://github.com/jupiterjs/todo">repository</a> at GitHub, and initialize all the necessary submodules. The following commands will get you up and running:</p>

<pre><code class=" javascript">$ git clone https:<span class="comment">//github.com/jupiterjs/todo</span>
$ cd todo
$ git submodule update --init
</code></pre>

<p>This bundle now contains everything you need to run the application locally. Since there is no server-side dependency, you can now open the <code>todo/todo.html</code> file in your browser and see it in action.</p>

<p><img class="image_tag" src="file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/tutorials/images/todos.png"></p>

<h2>Structure</h2>

<p>Now let's take a look at the anatomy of our application:</p>

<pre><code class=" javascript">/todo [top-level, the GitHub repository]
  /jquery
  /steal
  /funcunit
  /todo
    /scripts
    /test
    funcunit.html
    qunit.html
    todo.css
    todo.html
    todo.js
    ...
</code></pre>

<p>Breaking it down:</p>

<ul>
<li>The <code>jquery</code> folder is where the <a href="http://github.com/jupiterjs/jquerymx">jQueryMX</a> library lives. JavaScriptMVC consists of powerful abstractions like <a href="#!jQuery.Class">Class</a>, <a href="#!jQuery.Model">Model</a>, <a href="#!jQuery.Controller">Controller</a>, and <a href="#!jQuery.View">View</a>, as well as numerous helpful jQuery plugins like <code>resize</code>, <code>destroyed</code>, <code>closest</code>, <code>curStyles</code>, and <code>route</code> -- all designed to enhance your life as a JavaScript developer.</li>
<li>The <code>steal</code> folder houses the <a href="http://github.com/jupiterjs/steal">Steal</a> dependency management system, which is what makes it possible to keep your project organized during development, and compact and fast in production. Steal has two main responsibilities: As a JavaScript library, it facilitates on-demand loading of any resources (scripts, stylesheets, templates, or even user-defined content) your application requires. As a command line utility, it takes care of bundling, compressing, and optimizing your application for deployment.</li>
<li>The <a href="http://github.com/jupiterjs/funcunit">FuncUnit</a> testing framework lives in the <code>funcunit</code> folder -- think jQuery's excellent Qunit framework plus Selenium and headless (Env.js) support. Basically, qUnit on steroids.</li>
<li>Lastly, our application files will live in the <code>todo</code> folder.</li>
</ul>

<h2>MVC in JavaScript</h2>

<p>MVC is a well-established architectural pattern in software engineering. Without going into too much detail, it states that there should be a clear separation of concerns between the part of the system that represents the application's core logic and state (Model), the part that renders the user interface (View), and the part that coordinates between the two (Controller). Since our application consists of only one model, one controller, and a handful of templates, we're going to keep all our code in the <code>todo.js</code> and <code>todo.html</code> files. (Ordinarily in a JavaScriptMVC application, we'd keep a single component in each file for ease of navigation, but you'll forgive us this time for keeping it simple.)</p>

<p>The diagram below shows how we've broken our application out into model, view, and controller layers:</p>

<p><img class="image_tag" src="file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/tutorials/images/todo_arch.png"></p>

<h3>Dependencies</h3>

<p>If you look at <code>todo.js</code> the first thing you'll notice is that all the code is wrapped in a call to the <code>steal</code> function:</p>

<pre><code class=" javascript">steal(<span class="string">'jquery/model/list'</span>,
      <span class="string">'jquery/controller'</span>,
      <span class="string">'jquery/view/ejs'</span>,
      <span class="string">'jquery/lang/json'</span>,
      <span class="string">'./todo.css'</span>,
      <span class="function"><span class="keyword">function</span><span class="params">($)</span>{</span> ... })
</code></pre>

<p>In fact, this is true of every JavaScript file in a JavaScriptMVC application: we use <code>steal</code> to state our dependencies up-front, which tells the framework what libraries, plugins, stylesheets, etc. we need to load before we can begin. Typically, the final argument to <code>steal</code> will be a callback function, which will be executed when all the other dependencies (and <em>their</em> dependencies, and so on...) have been loaded and executed as well. No more worrying whether you forgot any <code>&lt;script&gt;</code> tags, or whether you've got them in the right order!</p>

<blockquote>
  <p>For our application, we can see that our script requires the <a href="#!jQuery.Model.List">Model.List</a> class (which itself requires the <a href="#!jQuery.Model">Model</a> class), the <a href="#!jQuery.Controller">Controller</a> class, a jQuery JSON helper, and our application's stylesheet.</p>
</blockquote>

<h3>Model</h3>

<p>All models in JavaScriptMVC extend the <a href="#!jQuery.Model">Model</a> class:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>, { <span class="comment">/* static properties */</span> }, { <span class="comment">/* instance/prototype properties */</span> })
</code></pre>

<blockquote>
  <p>If you need a quick refresher on how to use JVMC's classes, see <a href="#!jQuery.Class">Class</a>.</p>
</blockquote>

<p>In the case of our application, the <code>Todo</code> model represents a single To-do item. Its job is simply to know about the name and completed state of the item, how to persist that information, and how to notify the rest of the application when the item is created, updated, or destroyed.</p>

<p>Since we want our To-do list manager to function without a server, we need some form of persistence in the browser. Sure, cookies are nice, but we're looking to the future -- so lets take advantage of HTML5's LocalStorage! We'll define a <code>Todo</code> model class with a static (i.e. shared across all instances), state-of-the-art HTML5 storage mechanism (don't worry too much about what this does). The <code>localStore</code> method accepts a callback function which will be invoked with an array of <code>Todo</code> object <em>properties</em>. All of our CRUD operations will use this helper in order to persist <code>Todo</code> items in the system:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Todo'</span>, {
  <span class="comment">/**
   * Gets JSON data from localStorage.  Any changes that 
   * get made in cb get written back to localStorage.
   * 
   * This is unimportant for understanding JavaScriptMVC!
   */</span>
  localStore: <span class="function"><span class="keyword">function</span><span class="params">(cb)</span>{</span>
    <span class="keyword">var</span> name = <span class="keyword">this</span>.shortName,
      data = $.evalJSON(window.localStorage[name] || (window.localStorage[name] = <span class="string">"{}"</span>)),
      res = cb.call(<span class="keyword">this</span>, data);
    <span class="keyword">if</span>(res !== <span class="literal">false</span>){
      window.localStorage[name] = $.toJSON(data);
    }
  }
</code></pre>

<p>Given the <code>localStorage</code> helper we've created, we can now define a finder method that returns all <code>Todos</code> that the application knows about. Inside the callback, we just iterate over those objects, and create <code>Todo</code> models out of them:</p>

<pre><code>  findAll: function(params, success){
    this.localStore(function(todos){
      var instances = [];
      for(var id in todos){
        instances.push(new this(todos<a href="#!id">id</a>))
      }
      success &amp;&amp; success(instances)
    })
  }
</code></pre>

<blockquote>
  <p><em>Tip</em>: Don't let that <code>new this( ... )</code> trip you up. Since we're in the static (class) context, <code>this</code> simply refers to the <code>Todo</code> class itself. Writing <code>new Todo( ... )</code> would have the same effect, but this way our code won't break if we ever decide to rename the class to something else.</p>
</blockquote>

<p>The static <code>create</code> and <code>update</code> methods may be called directly, but are most often invoked automatically by the model layer when an instance is saved. The <code>create</code> method expects an <code>attrs</code> argument to describe the properties of the To-do item we want to create:</p>

<pre><code class=" javascript">create: <span class="function"><span class="keyword">function</span><span class="params">(attrs, success)</span>{</span>
  <span class="keyword">this</span>.localStore(<span class="function"><span class="keyword">function</span><span class="params">(todos)</span>{</span>
    attrs.id = attrs.id || parseInt(<span class="number">100000</span> * Math.random());
    todos[attrs.id] = attrs;
  });
  success({id: attrs.id})
}
</code></pre>

<p><code>Update</code> is similar to <code>create</code>, but rather than adding a new object to local storage, an existing object is looked up and modified in place with <code>jQuery.extend</code>:</p>

<pre><code>update: function(id, attrs, success){
  this.localStore(function(todos){
    var todo = todos<a href="#!id">id</a>;
    $.extend(todo, attrs);
  });
  success({});
}
</code></pre>

<h3>Model Lists</h3>

<p>One of the really great features of JavaScriptMVC is the <a href="#!jQuery.Model.List">Model.List</a>. A Model.List gives us a way to manage a collection of models as an aggregate, and (the cool part) be able to respond to and trigger events at the collection level. For our present purposes, we'd like to have a list of <code>Todo</code> items that can tell us which ones have been marked as completed:</p>

<pre><code class=" javascript">$.Model.List(<span class="string">'Todo.List'</span>, {
  <span class="comment">/**
   * Return a new Todo.List of only complete items
   */</span>
  completed : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.grep(<span class="function"><span class="keyword">function</span><span class="params">(item)</span>{</span>
      <span class="keyword">return</span> item.complete === <span class="literal">true</span>;
    })
  }
})
</code></pre>

<blockquote>
  <p>The <code>grep</code> method is similar to <code>jQuery.grep</code> in that it applies a filter to the list and returns a new list of all items for which the filter is true.</p>
</blockquote>

<p>We'll see how lists really make our lives easier when it comes time to do our view rendering below.</p>

<h3>Controller and View</h3>

<p>Controllers in JavaScriptMVC get their mojo from the <a href="#!jQuery.Controller">Controller</a> class. Basically, you can think of Controller as a <a href="http://jupiterjs.com/news/organize-jquery-widgets-with-jquery-controller">factory for building jQuery plugins</a>: its job is to attach itself to a DOM element, and organize event handlers using event delegation.</p>

<p>Unlike models, controllers and views are inherently tied to the application's user interface, so before we dive into the JavaScript code, let's take a quick look at the basic HTML structure of the application:</p>

<pre><code class=" javascript">&lt;div id=<span class="string">'todos'</span>&gt;
  &lt;h1&gt;Todos&lt;/h1&gt;
  &lt;input type=<span class="string">'text'</span> class=<span class="string">'create'</span> /&gt; 
  &lt;ul id=<span class="string">'list'</span>&gt;
  &lt;/ul&gt;
  &lt;div id=<span class="string">'todo-stats'</span>&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>Not much to it! One wrapper element -- that's the element we're eventually going to attach the controller to -- and inside that wrapper, the following items:</p>

<ul>
<li>A title ("Todos")</li>
<li>A text box where we're going to add new To-do items</li>
<li>A list where we'll see all current To-do items</li>
<li>Another container for "stats" where we'll show a count of what the user has selected, and give them a way to "finish"
items</li>
</ul>

<p>With this document structure in mind, let's create our controller:</p>

<pre><code class=" javascript">$.Controller(<span class="string">'Todos'</span>, {
  <span class="comment">// sets up the widget</span>
  init : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="comment">// empties the create input element</span>
    <span class="keyword">this</span>.find(<span class="string">".create"</span>).val(<span class="string">""</span>)[<span class="number">0</span>].focus();

    <span class="comment">// fills this list of items (creates add events on the list)</span>
    <span class="keyword">this</span>.options.list.findAll();
  }
</code></pre>

<p>The <code>init</code> method will be called when we initialize the controller with <code>$( ... ).todos()</code>. Upon initialization, we first want to clear the text box and then "focus" it (that is, place the mouse cursor in it). Nothing too unusual here.</p>

<blockquote>
  <p>In the context of a controller, the <code>find</code> method is like <code>jQuery.find</code> in that it searches for a selector underneath the element being managed by the controller.</p>
</blockquote>

<p>Next, we want to fetch the current collection of To-do items and display them to the user. Now, fetching and rendering data is something we do all the time, and it is very common practice in JavaScript and jQuery programming to perform both of these actions in one place. If we had some helpers lying around for fetching and rendering To-dos, we might do something like this, for example:</p>

<pre><code class=" javascript">findAllTodos(<span class="function"><span class="keyword">function</span><span class="params">(todos)</span>{</span>
  $(<span class="string">'#list'</span>).html(renderTodosHTML(todos))
})
</code></pre>

<p>What's wrong with this kind of approach? Well, nothing is <em>wrong</em> with it, per se. In a simple example like this one, we could probably get away with it. The problem comes as the application scales up in complexity, and there become more and more scenarios that can trigger a refresh of this list. The user may be allowed to create new To-do items manually, or import them from another source -- or even synchronize with another application running in the cloud. If we use this approach, we duplicate this hard-wiring of fetching and rendering all over the application, and make it more brittle and difficult to change in the future.</p>

<p>JavaScriptMVC Controller takes a more scalable approach to this problem through its event mechanism. Rather than rendering the list explicitly in the fetch callback, we simply ask the <code>Todo.List</code> to perform a <code>findAll</code> on itself. When the fetch completes, the list fires its own "add" event, which we listen for in the Controller. Conveniently, the "add" event tells us everything we need to know: the list that published the event, the jQuery event that triggered the add, and the To-do items which were added:</p>

<pre><code class=" javascript"><span class="comment">// adds existing and created to the list</span>
<span class="string">"{list} add"</span>: <span class="function"><span class="keyword">function</span><span class="params">(list, ev, items)</span> {</span>

  <span class="comment">// uses the todosEJS template (in todo.html) to render a list of items</span>
  <span class="comment">// then adds those items to #list</span>
  <span class="keyword">this</span>.find(<span class="string">'#list'</span>).append(<span class="string">"todosEJS"</span>, items)

  <span class="comment">// calls a helper to update the stats info</span>
  <span class="keyword">this</span>.updateStats();
}
</code></pre>

<p>The list template ("todosEJS") we're using to perform the render looks like this:</p>

<pre><code class=" javascript">&lt;% <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++){ %&gt;
  &lt;li &lt;%= <span class="keyword">this</span>[i]%&gt;&gt;
    &lt;%== $.View(<span class="string">'todoEJS'</span>, <span class="keyword">this</span>[i]) %&gt;
  &lt;/li&gt;
&lt;% } %&gt;
</code></pre>

<p>You may be wondering what that strange syntax is doing on the second line: <code>&lt;li &lt;%= this[i]%&gt;&gt;</code>. This little bit of magic is what is known as a hookup. What's happening here is that each Todo model is being bound to its respective list item HTML element. This little binding provides some very important functionality. First, it allows you to easily retrieve one or more models given a jQuery object, by using the <code>.model()</code> or <code>.models()</code> methods. Secondly, it creates an automatic listener that will update or remove the element when its associated model changes!</p>

<p>A little note on templated event handlers: the <code>{list}</code> which appears in the event descriptor is the same as the <code>this.options.list</code> which we saw earlier in our <code>init</code> method. When we bind our controller to its DOM element, we tell it about the <a href="#!jQuery.Model.List">Model.List</a> that we want it to manage:</p>

<pre><code class=" javascript"><span class="comment">// create a todos widget with a list</span>
$(<span class="string">"#todos"</span>).todos({ list: <span class="keyword">new</span> Todo.List() })
</code></pre>

<blockquote>
  <p>Any parameters passed into the controller's initialization object become available on the <code>options</code> property of the controller, and also via the {} syntax in event descriptors.</p>
</blockquote>

<p>In a similar way, we will listen for the list's "remove" and "update" events. Upon removal of any To-do items, we want to remove it from the list also. Once again, the event gives us all the information we need to know:</p>

<pre><code class=" javascript"><span class="comment">// when an item is removed from the list ...</span>
<span class="string">"{list} remove"</span>: <span class="function"><span class="keyword">function</span><span class="params">(list, ev, items)</span> {</span>

  <span class="comment">// get the elements in the list and remove them</span>
  items.elements(<span class="keyword">this</span>.element).slideUp(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    $(<span class="keyword">this</span>).remove();
  });

  <span class="keyword">this</span>.updateStats();
}
</code></pre>

<p>The "updated" event is fired both on individual items and on the list as a whole. In this case, we want to render the single item template ("todoEJS") to replace the HTML of the item which was changed:</p>

<pre><code class=" javascript"><span class="comment">// when an item is updated</span>
<span class="string">"{list} updated"</span>: <span class="function"><span class="keyword">function</span><span class="params">(list, ev, item)</span> {</span>
  item.elements().html(<span class="string">"todoEJS"</span>, item);
  <span class="keyword">this</span>.updateStats();
}
</code></pre>

<p>Now, let's look at how new To-do items are created. In a modern web interface, we no longer want to depend on fat forms and submit buttons -- we want to do small bits of work anytime the user performs an appropriate action. Rather than making the user constantly move between the keyboard and mouse, we listen for a press of the Enter key to trigger a save:</p>

<pre><code class=" javascript"><span class="comment">// listens for key events and creates a new todo</span>
<span class="string">".create keyup"</span>: <span class="function"><span class="keyword">function</span><span class="params">(el, ev)</span> {</span>
  <span class="keyword">if</span>(ev.keyCode == <span class="number">13</span>){
    <span class="keyword">new</span> Todo({
      text: el.val(),
      complete: <span class="literal">false</span>
    }).save(<span class="keyword">this</span>.callback(<span class="string">'created'</span>));

    el.val(<span class="string">""</span>);
  }
}
</code></pre>

<p>Remember our discussion above about decoupling fetching from rendering? It applies here, too: rather than simply rendering the newly created To-do item when the save completes, we call our <code>created</code> method, which adds the item to the <code>Todo.List</code>:</p>

<pre><code class=" javascript"><span class="comment">// When a todo is created, add it to this list</span>
<span class="string">"created"</span>: <span class="function"><span class="keyword">function</span><span class="params">(todo)</span> {</span>
  <span class="keyword">this</span>.options.list.push(todo); <span class="comment">//triggers 'add' on the list</span>
}
</code></pre>

<p>This causes the "add" event to fire, which in turn triggers our <code>"{list} add"</code> handler above. We don't have to write any new code to handle this render: it's already happening automatically! Nowhere in the application have we explicitly bound any model callbacks to changes in the view: everything happens through events.</p>

<h2>That's It!</h2>

<p>JavaScriptMVC enables you to write even the simplest application <strong>the right way</strong> from the start. With a Model that's completely independent from any knowledge of user interface behavior, and a Controller that's all ready to scale up to the complexities of modern Web experiences, you won't find yourself rewriting your app over and over again to deliver the goods.</p></div>
			<div id="disqus_thread" style="display: none; "></div>
		</div>
	</div>
</div>
<div id="low">
	<a href="http://jupiterit.com">� Jupiter Consulting - JavaScriptMVC Training and Support</a>
	<a class="api_links" href="http://javascriptmvc.com/docs/api.html#&amp;who=api"></a>
</div>
<script type="text/javascript">
	DOCS_SRC_MAP = {
		'funcunit' : 'https://github.com/jupiterjs/funcunit',
		'jquery' : 'https://github.com/jupiterjs/jquerymx',
		'steal' : 'https://github.com/jupiterjs/steal',
		'documentjs' : 'https://github.com/jupiterjs/documentjs',
		mxui : 'https://github.com/jupiterjs/mxui'
	};
	DOCS_LOCATION = "docs/" //adds searchData to this
	JMVCDOC_TIMESTAMP = 265469885
	COMMENTS_LOCATION = 'http://jmvcs3.disqus.com/embed.js';
</script>
<script type="text/javascript" src="../steal/steal.js?documentjs/jmvcdoc">
</script>

<style type="text/css">
  body > iframe { width: 0;} 
  #dsq-content #dsq-form-area .dsq-attach-media-container iframe { height: 13px; padding: 0;}
</style>
	

</body>
</html>